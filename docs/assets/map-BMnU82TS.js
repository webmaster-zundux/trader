import{a as m,q as a,z as dn}from"./chunk-PVWAREVJ-D1PIyzeh.js";import{S as hn}from"./SearchFormAndTableContainer-Dn0g8KWe.js";import{x as mn,y as pn,z as _n,A as fn,u as Oe,D as yn,a as gn,b as Sn,T as En,c as bn,d as de,U as bt,e as Pt,f as Mt,g as At,B as Tt,h as $,j as q,k as J,o as Ie,l as Lt,p as Ct,i as Qe,N as Pn,C as je,E as we,F as De,q as Mn,r as An,m as Tn,G as Ln,H as $e,S as Cn}from"./useTableSearch-Ui5oQRZ2.js";import{b as k}from"./ClassNames-CdIKlwZs.js";import{V as A,l as Rt,C as Rn,m as X,T as Z,Q as Le,S as qe,n as x,R as Nn,o as Nt,q as vn,r as vt,s as le,t as xn,v as On,w as In,x as jn,y as wn,z as Dn,A as Fn,B as Un,D as Hn,F as Bn,G as Wn,H as kn,I as zn,J as Yn,K as Gn,N as Kn,O as Vn,U as Zn,W as Xn,X as Fe,Y as Qn,Z as $n,_ as qn,$ as Jn,a0 as Ue,a1 as He,a2 as fe,a3 as ye,a4 as es,a5 as xt,a6 as Ot,a7 as ts,a8 as ns,a9 as It,aa as Ce,ab as ss,ac as is,ad as os,ae as as,af as rs,ag as ls,ah as D,ai as z,p as Q,aj as cs,ak as Se,al as us,am as U,M as R,an as ds,ao as hs,ap as ms,u as Re,a as jt,b as ne,aq as he,d as Je,f as Ee,ar as ps,as as me,at as _s,c as fs}from"./getUrlToMapPageWithParams-gLmSAaLz.js";import{i as F}from"./MovingEntity-_XUTKdrK.js";import{a5 as wt,ac as ys,w as B,K as W,O,L as Be,a as gs,u as Ss,F as Es,B as w,A as et,v as bs,ad as Ps,_ as Dt,$ as Ft,ae as Ms,c as tt,z as ce,af as Ut,y as We,I as T,p as As,ag as H,ah as Ht,ai as Bt,aj as Ne,ak as Ts,al as Ls,am as Cs,an as Wt,ao as kt,ap as zt,a3 as pe,a1 as Rs,aq as Ns}from"./useLoadingPersistStorages-BWX3nPU9.js";import{C as j,u as vs}from"./ColorTheme.store-Cona8foo.js";import{I as K}from"./InternalStaticLink-rDmjTW4d.js";import{i as nt,a as st,u as ve,s as xs,P as Os,F as Is,d as js,e as ws,L as Ds}from"./sortItemsByProductName-BGoQ9pgC.js";import{s as Fs,F as Us,a as Yt}from"./setMovingEntityOrLocationOrPlanetarySystemToUrlSearchParams-B36G2HfO.js";import{g as Hs}from"./getUrlToMovingEntitiesPageWithParams-CAB83Xnk.js";import{c as Bs}from"./createPageTitleWithAppName-C6bNgB-9.js";import"./getUrlToMarketPageWithParams-DdYQKoX-.js";import"./getUrlToProductsPageWithParams-CN44cusc.js";import"./App.const-Bym5gJCd.js";const it=!1,ot=!1,Ws="_TableWrapper_1us52_1",ks="_TableContainer_1us52_10",zs="_Table_1us52_1",Ys="_TableHeaderContainer_1us52_23",Gs="_TableHeaderLeftPart_1us52_37",Ks="_TableHeaderRightPart_1us52_44",Vs="_TableItemsQuantity_1us52_51",Zs="_TableTitle_1us52_58",Xs="_TableTitleActonButtons_1us52_67",Qs="_NoData_1us52_80",$s="_LoadingData_1us52_81",I={TableWrapper:Ws,TableContainer:ks,Table:zs,TableHeaderContainer:Ys,TableHeaderLeftPart:Gs,TableHeaderRightPart:Ks,TableItemsQuantity:Vs,TableTitle:Zs,TableTitleActonButtons:Xs,NoData:Qs,LoadingData:$s},qs=m.memo(function({item:e,columns:n,onSelectItem:s,isHighlightRow:i}){return a.jsx(mn,{isHighlightRow:i,isHighlightRowBlinking:!1,children:n.map((o,r)=>a.jsx(pn,{item:e,column:o,columnIndex:r,onSelectItem:s},o.name))})}),Js=m.memo(function({items:e,columns:n,onSelectItem:s=()=>{},selectedItemUuid:i}){const o=_n({items:e});return a.jsx(a.Fragment,{children:o.map(r=>a.jsx(qs,{item:r,columns:n,onSelectItem:s,isHighlightRow:i===r.uuid},r.uuid))})}),ei=m.memo(function({tableTitle:e="Table",items:n=[],noItemsLabel:s="no data",isLoading:i=!1,loadingLabel:o="loading data...",itemTypeName:r="item",itemTypeNamePlural:u="items",searchFieldValue:d,filterValue:c,children:l}){const h=m.useRef(null),{vertical:p}=fn(h,n),E=k([I.TableContainer,p&&I.TableContainerWithVisibleScrollbar]);return a.jsxs("div",{className:I.TableWrapper,children:[a.jsxs("div",{className:I.TableHeaderContainer,children:[a.jsxs("div",{className:I.TableHeaderLeftPart,children:[a.jsx("h2",{className:I.TableTitle,children:e}),a.jsx("div",{className:I.TableTitleActonButtons})]}),a.jsx("div",{className:I.TableHeaderRightPart,children:a.jsxs("div",{className:I.TableItemsQuantity,children:[c||d?"found":"total"," ",n.length," ",n.length>1||n.length===0?u:r]})})]}),a.jsx("div",{ref:h,className:E,children:a.jsx("table",{className:I.Table,children:a.jsxs("tbody",{children:[i&&a.jsx("tr",{children:a.jsx("td",{colSpan:100,rowSpan:100,className:I.LoadingData,children:o})}),!i&&!n.length&&a.jsx("tr",{children:a.jsx("td",{colSpan:100,rowSpan:100,className:I.NoData,children:s})}),!i&&!!n.length&&l]})})})]})});function ti(t,e){const[n,s]=m.useState(0),[i,o]=m.useState(0),r=m.useCallback(function(c,l){s(c),o(l)},[s,o]),u=m.useCallback(function(){const c=t?.current;if(!c)return;const l=c.clientWidth,h=c.clientHeight;!Number.isFinite(l)||!Number.isFinite(h)||l<1||h<1?r(0,0):r(l,h),typeof e=="function"&&e(l,h)},[t,r,e]);return m.useEffect(function(){const c=t?.current;if(!c)return;const l=new ResizeObserver(u);return l.observe(c),function(){l.unobserve(c),l.disconnect()}},[t,u]),m.useEffect(function(){return document.addEventListener("load",u),function(){document.removeEventListener("load",u)}},[u]),{elementWidth:n,elementHeight:i}}const V=new A,at=new Rt,rt=new Rt,lt=new A,ct=new A;class ni{domElement;isUsingZOrder;getSize;render;setSize;constructor(e){const n=this;let s,i,o,r;const u={objects:new WeakMap},d=e.element;d.style.overflow="hidden",this.domElement=d,this.isUsingZOrder=!!e.isUsingZOrder,this.getSize=function(){return{width:s,height:i}},this.render=function(f,_){f.matrixWorldAutoUpdate===!0&&f.updateMatrixWorld(),_.parent===null&&_.matrixWorldAutoUpdate===!0&&_.updateMatrixWorld(),at.copy(_.matrixWorldInverse),rt.multiplyMatrices(_.projectionMatrix,at),l(f,f,_,this.isUsingZOrder),this.isUsingZOrder&&E(f)},this.setSize=function(f,_){s=f,i=_,o=s/2,r=i/2,d.style.width=f+"px",d.style.height=_+"px"};function c(y){y.isCSS2DObject&&(y.element.style.display="none");for(let f=0,_=y.children.length;f<_;f++)c(y.children[f])}function l(y,f,_,S){if(y.visible===!1){c(y);return}if(y.isCSS2DObject){V.setFromMatrixPosition(y.matrixWorld),V.applyMatrix4(rt);const g=V.z>=-1&&V.z<=1&&y.layers.test(_.layers)===!0,b=y.element;if(b.style.display=g===!0?"":"none",g===!0&&(y.onBeforeRender(n,f,_),b.style.transform="translate("+-100*y.center.x+"%,"+-100*y.center.y+"%)translate("+(V.x*o+o)+"px,"+(-V.y*r+r)+"px)",y.onAfterRender(n,f,_)),S){const L={distanceToCameraSquared:h(_,y)};u.objects.set(y,L)}}for(let g=0,b=y.children.length;g<b;g++)l(y.children[g],f,_,S)}function h(y,f){return lt.setFromMatrixPosition(y.matrixWorld),ct.setFromMatrixPosition(f.matrixWorld),lt.distanceToSquared(ct)}function p(y){const f=new Array;return y.traverseVisible(function(_){_.isCSS2DObject&&f.push(_)}),f}function E(y){const f=p(y).sort(function(S,g){if(S.renderOrder!==g.renderOrder)return g.renderOrder-S.renderOrder;const b=u.objects.get(S).distanceToCameraSquared,L=u.objects.get(g).distanceToCameraSquared;return b-L}),_=f.length;for(let S=0,g=f.length;S<g;S++)f[S].element.style.zIndex=`${_-S}`}}}const ut={type:"change"},ke={type:"start"},Gt={type:"end"},ie=new Nn,dt=new Nt,si=Math.cos(70*vn.DEG2RAD),C=new A,N=2*Math.PI,M={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},be=1e-6;class ii extends Rn{constructor(e,n=null){super(e,n),this.state=M.NONE,this.target=new A,this.cursor=new A,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:X.ROTATE,MIDDLE:X.DOLLY,RIGHT:X.PAN},this.touches={ONE:Z.ROTATE,TWO:Z.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new A,this._lastQuaternion=new Le,this._lastTargetPosition=new A,this._quat=new Le().setFromUnitVectors(e.up,new A(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new qe,this._sphericalDelta=new qe,this._scale=1,this._panOffset=new A,this._rotateStart=new x,this._rotateEnd=new x,this._rotateDelta=new x,this._panStart=new x,this._panEnd=new x,this._panDelta=new x,this._dollyStart=new x,this._dollyEnd=new x,this._dollyDelta=new x,this._dollyDirection=new A,this._mouse=new x,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=ai.bind(this),this._onPointerDown=oi.bind(this),this._onPointerUp=ri.bind(this),this._onContextMenu=pi.bind(this),this._onMouseWheel=ui.bind(this),this._onKeyDown=di.bind(this),this._onTouchStart=hi.bind(this),this._onTouchMove=mi.bind(this),this._onMouseDown=li.bind(this),this._onMouseMove=ci.bind(this),this._interceptControlDown=_i.bind(this),this._interceptControlUp=fi.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(ut),this.update(),this.state=M.NONE}update(e=null){const n=this.object.position;C.copy(n).sub(this.target),C.applyQuaternion(this._quat),this._spherical.setFromVector3(C),this.autoRotate&&this.state===M.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let s=this.minAzimuthAngle,i=this.maxAzimuthAngle;isFinite(s)&&isFinite(i)&&(s<-Math.PI?s+=N:s>Math.PI&&(s-=N),i<-Math.PI?i+=N:i>Math.PI&&(i-=N),s<=i?this._spherical.theta=Math.max(s,Math.min(i,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(s+i)/2?Math.max(s,this._spherical.theta):Math.min(i,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let o=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const r=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),o=r!=this._spherical.radius}if(C.setFromSpherical(this._spherical),C.applyQuaternion(this._quatInverse),n.copy(this.target).add(C),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let r=null;if(this.object.isPerspectiveCamera){const u=C.length();r=this._clampDistance(u*this._scale);const d=u-r;this.object.position.addScaledVector(this._dollyDirection,d),this.object.updateMatrixWorld(),o=!!d}else if(this.object.isOrthographicCamera){const u=new A(this._mouse.x,this._mouse.y,0);u.unproject(this.object);const d=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),o=d!==this.object.zoom;const c=new A(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(u),this.object.updateMatrixWorld(),r=C.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;r!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(r).add(this.object.position):(ie.origin.copy(this.object.position),ie.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(ie.direction))<si?this.object.lookAt(this.target):(dt.setFromNormalAndCoplanarPoint(this.object.up,this.target),ie.intersectPlane(dt,this.target))))}else if(this.object.isOrthographicCamera){const r=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),r!==this.object.zoom&&(this.object.updateProjectionMatrix(),o=!0)}return this._scale=1,this._performCursorZoom=!1,o||this._lastPosition.distanceToSquared(this.object.position)>be||8*(1-this._lastQuaternion.dot(this.object.quaternion))>be||this._lastTargetPosition.distanceToSquared(this.target)>be?(this.dispatchEvent(ut),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?N/60*this.autoRotateSpeed*e:N/60/60*this.autoRotateSpeed}_getZoomScale(e){const n=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*n)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,n){C.setFromMatrixColumn(n,0),C.multiplyScalar(-e),this._panOffset.add(C)}_panUp(e,n){this.screenSpacePanning===!0?C.setFromMatrixColumn(n,1):(C.setFromMatrixColumn(n,0),C.crossVectors(this.object.up,C)),C.multiplyScalar(e),this._panOffset.add(C)}_pan(e,n){const s=this.domElement;if(this.object.isPerspectiveCamera){const i=this.object.position;C.copy(i).sub(this.target);let o=C.length();o*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*o/s.clientHeight,this.object.matrix),this._panUp(2*n*o/s.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/s.clientWidth,this.object.matrix),this._panUp(n*(this.object.top-this.object.bottom)/this.object.zoom/s.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,n){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const s=this.domElement.getBoundingClientRect(),i=e-s.left,o=n-s.top,r=s.width,u=s.height;this._mouse.x=i/r*2-1,this._mouse.y=-(o/u)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const n=this.domElement;this._rotateLeft(N*this._rotateDelta.x/n.clientHeight),this._rotateUp(N*this._rotateDelta.y/n.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let n=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(N*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),n=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-N*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),n=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(N*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),n=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-N*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),n=!0;break}n&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),s=.5*(e.pageX+n.x),i=.5*(e.pageY+n.y);this._rotateStart.set(s,i)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),s=.5*(e.pageX+n.x),i=.5*(e.pageY+n.y);this._panStart.set(s,i)}}_handleTouchStartDolly(e){const n=this._getSecondPointerPosition(e),s=e.pageX-n.x,i=e.pageY-n.y,o=Math.sqrt(s*s+i*i);this._dollyStart.set(0,o)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const s=this._getSecondPointerPosition(e),i=.5*(e.pageX+s.x),o=.5*(e.pageY+s.y);this._rotateEnd.set(i,o)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const n=this.domElement;this._rotateLeft(N*this._rotateDelta.x/n.clientHeight),this._rotateUp(N*this._rotateDelta.y/n.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),s=.5*(e.pageX+n.x),i=.5*(e.pageY+n.y);this._panEnd.set(s,i)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const n=this._getSecondPointerPosition(e),s=e.pageX-n.x,i=e.pageY-n.y,o=Math.sqrt(s*s+i*i);this._dollyEnd.set(0,o),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const r=(e.pageX+n.x)*.5,u=(e.pageY+n.y)*.5;this._updateZoomParameters(r,u)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let n=0;n<this._pointers.length;n++)if(this._pointers[n]==e.pointerId){this._pointers.splice(n,1);return}}_isTrackingPointer(e){for(let n=0;n<this._pointers.length;n++)if(this._pointers[n]==e.pointerId)return!0;return!1}_trackPointer(e){let n=this._pointerPositions[e.pointerId];n===void 0&&(n=new x,this._pointerPositions[e.pointerId]=n),n.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const n=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[n]}_customWheelEvent(e){const n=e.deltaMode,s={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(n){case 1:s.deltaY*=16;break;case 2:s.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(s.deltaY*=10),s}}function oi(t){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(t.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(t)&&(this._addPointer(t),t.pointerType==="touch"?this._onTouchStart(t):this._onMouseDown(t)))}function ai(t){this.enabled!==!1&&(t.pointerType==="touch"?this._onTouchMove(t):this._onMouseMove(t))}function ri(t){switch(this._removePointer(t),this._pointers.length){case 0:this.domElement.releasePointerCapture(t.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(Gt),this.state=M.NONE;break;case 1:const e=this._pointers[0],n=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:n.x,pageY:n.y});break}}function li(t){let e;switch(t.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case X.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(t),this.state=M.DOLLY;break;case X.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(t),this.state=M.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(t),this.state=M.ROTATE}break;case X.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(t),this.state=M.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(t),this.state=M.PAN}break;default:this.state=M.NONE}this.state!==M.NONE&&this.dispatchEvent(ke)}function ci(t){switch(this.state){case M.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(t);break;case M.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(t);break;case M.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(t);break}}function ui(t){this.enabled===!1||this.enableZoom===!1||this.state!==M.NONE||(t.preventDefault(),this.dispatchEvent(ke),this._handleMouseWheel(this._customWheelEvent(t)),this.dispatchEvent(Gt))}function di(t){this.enabled!==!1&&this._handleKeyDown(t)}function hi(t){switch(this._trackPointer(t),this._pointers.length){case 1:switch(this.touches.ONE){case Z.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(t),this.state=M.TOUCH_ROTATE;break;case Z.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(t),this.state=M.TOUCH_PAN;break;default:this.state=M.NONE}break;case 2:switch(this.touches.TWO){case Z.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(t),this.state=M.TOUCH_DOLLY_PAN;break;case Z.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(t),this.state=M.TOUCH_DOLLY_ROTATE;break;default:this.state=M.NONE}break;default:this.state=M.NONE}this.state!==M.NONE&&this.dispatchEvent(ke)}function mi(t){switch(this._trackPointer(t),this.state){case M.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(t),this.update();break;case M.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(t),this.update();break;case M.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(t),this.update();break;case M.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(t),this.update();break;default:this.state=M.NONE}}function pi(t){this.enabled!==!1&&t.preventDefault()}function _i(t){t.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function fi(t){t.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function yi(t=vt,e=le){const n=window.innerWidth/window.innerHeight,s=new In(jn,n,wn,Dn);return s.position.copy(t),s.lookAt(e),s}function gi(t,e,n=xn,s=On){const i=new ii(e,t.domElement);return i.minDistance=n,i.maxDistance=s,i.screenSpacePanning=!0,i}class Si extends Fn{plane;size;constructor(e,n=1,s="black",i=.2,o="disk"){let r;o==="disk"?r=new Un(1,128):r=new Hn(1,1);const u=new Bn({color:s,opacity:i,transparent:!0,depthWrite:!1,toneMapped:!1,side:Wn});super(r,u),this.type="PlaneHelper",this.plane=e,this.size=n}setSize(e){this.size=e,this.updateMatrixWorld()}setColor(e){this.material.color=e}setOpacity(e){this.material.opacity=e}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function Ei({scene:t,normal:e=kn,constant:n=0,size:s=1,colorTheme:i,color:o,opacity:r=Gn}){const u=o||(i===j?zn:Yn),d=new Nt(e,n),c=new Si(d,s,u,r);return c.addEventListener("removed",function(){c.dispose()}),t.add(c),c}function bi(t){const e=t===j?Zn:Xn,n=new Kn;return n.background=new Vn(e),n}function Pi(t){const e=new Fe;return t.add(e),e.renderOrder=1/0,e}function Mi(t){const e=new Fe;return t.add(e),e}function Ai(t,e,n,s){const{width:i,height:o}=t.getBoundingClientRect();s.aspect=i/o,s.updateProjectionMatrix(),e.setSize(i,o),n.setSize(i,o)}function Ti(t,e,n,s,i,o,r,u,d,c){if(n.last){let S=c===j?fe:ye;n.last===s.last&&(S=c===j?Ue:He),n.last.material.color.set(S),n.last=null}const{top:l,left:h,width:p,height:E}=e.getBoundingClientRect(),y=t.clientX-h,f=t.clientY-l;d.style.transform=`translate( ${y}px, ${f}px )`,i.x=y/p*2-1,i.y=(f/E*2-1)*-1,o.setFromCamera(i,r);const _=o.intersectObject(u,!0);if(_.length>0){const S=_.filter(function(g){return g&&g.object})[0];if(S&&S.object){n.last=S.object;const g=c===j?qn:Jn;n.last.material.color.set(g)}}}function Li(t,e,n,s,i,o,r,u,d,c,l){if(s.last){const g=c===j?fe:ye;s.last.material.color.set(g),s.last=null}const{top:h,left:p,width:E,height:y}=e.getBoundingClientRect(),f=t.clientX-p,_=t.clientY-h;d.style.transform=`translate( ${f}px, ${_}px )`,i.x=f/E*2-1,i.y=(_/y*2-1)*-1,o.setFromCamera(i,r);const S=o.intersectObject(u,!0);if(S.length>0){const g=S.filter(function(b){return b&&b.object})[0];if(g&&g.object){s.last=g.object;const b=c===j?Ue:He;s.last.material.color.set(b),l(g.object.userData.item)}}}function Ci(t,e,n,s,i,o){t.render(s,i),e.render(s,i);const r=Ri(o);n.innerText=`zoom: ${r.toFixed(3)}x`}function Ri(t){return t.target.distanceTo(t.object.position)}function Ni({canvasElement:t,mapZoomLevelLabel:e,overlayElement:n,pointerDotElement:s,colorTheme:i,onSelectItem:o}){const r={last:null},u={last:null},{renderer:d,overlayRenderer:c}=vi(t,n),l=bi(i),h=Pi(l),p=Mi(l),E=yi(),y=gi(d,E),f=Ei({scene:l,colorTheme:i});function _(){Ci(d,c,e,l,E,y)}const S=new Qn,g=new x;function b(){Ai(t,d,c,E)}function L(te){Ti(te,t,r,u,g,S,E,h,s,i),_()}function v(te){Li(te,t,r,u,g,S,E,h,s,i,o),_()}window.addEventListener("resize",b),t.addEventListener("pointermove",L),t.addEventListener("click",v),y.addEventListener("change",_),b();function ee(){d.setAnimationLoop(null),window.removeEventListener("resize",b),t.removeEventListener("pointermove",L),t.removeEventListener("click",v),y.removeEventListener("change",_),y.dispose(),d.dispose()}return{renderer:d,overlayRenderer:c,scene:l,spritesGroup:h,spritesProjectionLinesGroup:p,planeHelper:f,camera:E,cameraControls:y,renderFrame:_,onWindowResize:b,destroyMapRenderer:ee}}function vi(t,e){const n=Oi(t),s=xi(e);return{renderer:n,overlayRenderer:s}}function xi(t){const e=new ni({element:t,isUsingZOrder:!1});return e.setSize(window.innerWidth,window.innerHeight),e}function Oi(t){const e=new $n({antialias:!0,canvas:t});return e.setPixelRatio(window.devicePixelRatio),e.setSize(window.innerWidth,window.innerHeight),e}function Kt(t){const e=new es;return t.traverse(function(s){e.expandByPoint(s.position)}),e}function ht(t=[new A,new A(1,1,1)],e){const n=new xt().setFromPoints(t),s=e===j?ts:ns,i=new Ot({color:s,toneMapped:!1}),o=new It(n,i);return o.addEventListener("removed",function(){o.material.dispose(),o.geometry.dispose()}),o}function Ii({position:t,parentQuaternion:e,group:n,size:s=1,colorTheme:i}){const o=new Fe,r=[new A(-.5,0,-.5),new A(.5,0,.5)],u=[new A(.5,0,-.5),new A(-.5,0,.5)],d=ht(r,i),c=ht(u,i);return o.add(d),o.add(c),o.position.copy(t),o.applyQuaternion(e),o.applyQuaternion(Ce),o.scale.copy(new A(s,s,s)),o.addEventListener("removed",function(){o.clear()}),n.add(o),o}function ji(t,e,n,s){const i=new Le;t.getWorldQuaternion(i),Ii({group:e,parentQuaternion:i,position:n,size:os,colorTheme:s})}function wi(t,e,n,s){const i=t.getWorldPosition(new A),o=new A;e.plane.projectPoint(i,o);const r=[i,o],u=new xt().setFromPoints(r),d=s===j?ss:is,c=new Ot({color:d,toneMapped:!1}),l=new It(u,c);return ji(e,l,o,s),l.addEventListener("removed",function(){l.clear(),l.material.dispose(),l.geometry.dispose()}),n.add(l),l}const Di="/images/textures";function Pe(t){return`/trader/${Di}/${t}.png`}let Me;function Fi(){return Me||(Me=new as),Me}function Ae({textureAsString:t,name:e,position:n,materialColor:s}){const i=Fi().load(t),o=new rs({map:i,color:s,transparent:!0,depthTest:!1}),r=new ls(o);return r.name=e,r.position.copy(n),r.addEventListener("removed",function(){r.material.dispose(),r.geometry.dispose()}),r}const Ui=1/1e6,Hi=1/1e6;function Bi(t,e){const n=ki(t.position);if(!n)return;const s=e===j?fe:ye;let i;if(D(t)){n.multiplyScalar(Ui),n.applyQuaternion(Ce);const o=t.locationTypeUuid?wt(t.locationTypeUuid)?.image:void 0;i=Ae({name:t.uuid,textureAsString:o||Pe(Se.structureUnknown),position:n,materialColor:s});const r=Wi(t,.25);i.scale.set(r,r,r)}else if(F(t)){n.multiplyScalar(Hi),n.applyQuaternion(Ce);const o=t.movingEntityClassUuid?ys(t.movingEntityClassUuid)?.image:void 0;i=Ae({name:t.uuid,textureAsString:o||Pe(Se.shipUnknown),position:n,materialColor:s}),i.scale.set(.35,.35,.35)}else if(z(t))i=Ae({name:t.uuid,textureAsString:Pe(Se.circle),position:n,materialColor:s}),i.scale.set(.1,.1,.1);else return;return i.userData.item=t,i}function Wi(t,e=1){const n=t.locationTypeUuid,s=n?wt(n)?.name:void 0;return s&&cs[s]||e}function ki(t){const e=Q(t);if(!e)return;const n=new A;return n.fromArray(e),n}class zi extends us{isCSS2DObjectForReactComponent;isCSS2DObject;element;center;constructor(e){super(),this.isCSS2DObjectForReactComponent=!0,this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="none",this.element.style.userSelect="none",this.element.setAttribute("draggable","false"),this.center=new x(.5,.5)}copy(e,n){return super.copy(e,n),this.element=e.element,this.center=e.center,this}}function mt(t){return t?.isCSS2DObjectForReactComponent}function Yi(t,e){return e.querySelector(`[data-item-uuid="${t}"]`)||void 0}function pt(t,e,n,s=!1){const i=Yi(t.uuid,n);if(!i)return;const o=new zi(i);o.position.set(0,0,0),o.visible=s,e.add(o)}function Gi({spritesGroupRef:t,spritesProjectionLinesGroupRef:e,sceneRef:n,planeHelperRef:s,mapOverlayContainerRef:i,items:o,colorTheme:r,mode:u,setNoDataToDisplay:d,resetCamera:c,renderFrame:l}){m.useEffect(function(){const p=t.current;if(!p)return;const E=e.current;if(!E||!n.current)return;const f=s.current;if(!f)return;const _=i.current;if(!_)return;p.clear(),E.clear(),o.forEach(g=>{const b=Bi(g,r);b&&(u===U&&wi(b,f,E,r),u===U?pt(g,b,_,!1):pt(g,b,_,!0),p.add(b))});const S=!p.children.length;if(S)f.visible=!1;else if(u===R)f.visible=!1;else if(u===U){f.visible=!0;const g=Kt(p),L=Math.max.apply(void 0,new Array().concat(g.min.toArray(),g.max.toArray()).map(Math.abs))*(1+ds)*2;f.setSize(L)}d(S),c(u,S),l()},[o,n,t,e,s,i,d,l,c,u,r])}function Ki(t){return t?.isSprite}function Vi({selectedItemUuid:t,spritesGroupRef:e,items:n,colorTheme:s,mode:i,renderFrame:o}){m.useEffect(function(){if(!n.length)return;const u=e.current;u&&(u.children.forEach(d=>{if(Ki(d)){const c=d;if(c.userData.item?.uuid===t){const l=s===j?Ue:He;if(c.material.color.set(l),i===U){const h=c.children.find(p=>mt(p));h&&(h.visible=!0)}}else{const l=s===j?fe:ye;if(c.material.color.set(l),i===U){const h=c.children.find(p=>mt(p));h&&(h.visible=!1)}}}}),o())},[n,e,o,t,s,i])}const Zi=1.5,Xi=2;function _t({group:t,camera:e,cameraPos:n,cameraTarget:s,defaultCameraPos:i,defaultCameraTarget:o,cameraControls:r,maxCoordinateMultiplier:u}){(i||o)&&(i&&e.position.copy(i),o&&e.lookAt(o));const d=Kt(t),c=Math.max.apply(void 0,new Array().concat(d.min.toArray(),d.max.toArray()).map(Math.abs)),l=s||new A,p=c*u/(2*Math.atan(Math.PI*e.fov/360)),E=p/e.aspect,y=Math.max(p,E),f=n||new A().copy(e.position),_=l.clone().sub(f).normalize().multiplyScalar(y),S=new A().copy(l).sub(_),g=new A().copy(l);e.position.copy(S),e.lookAt(g),r.update()}function Qi({spritesGroupRef:t,cameraControlsRef:e,cameraRef:n}){return m.useCallback(function(o,r){const u=n.current;if(!u)return;const d=e.current;if(!d)return;const c=t.current;c&&(d.reset(),!r&&(o===R?(_t({group:c,camera:u,cameraControls:d,defaultCameraPos:vt,defaultCameraTarget:le,maxCoordinateMultiplier:Zi}),d.screenSpacePanning=!0):o===U&&(_t({group:c,camera:u,cameraControls:d,cameraTarget:le,defaultCameraPos:hs,defaultCameraTarget:le,maxCoordinateMultiplier:Xi}),d.screenSpacePanning=!1)))},[n,e,t])}function $i({mode:t,items:e,onSelectItem:n,selectedItemUuid:s}){const i=vs(se=>se.colorTheme),o=m.useRef(null),r=m.useRef(null),u=m.useRef(null),d=m.useRef(null),c=m.useRef(null),l=m.useRef(null),h=m.useRef(null),p=m.useRef(null),[E,y]=m.useState(!1),f=m.useRef(null),_=m.useRef(null),S=m.useRef(null),g=m.useRef(null),[b,L]=m.useState(void 0),v=m.useCallback(function(){typeof b=="function"&&window.setTimeout(function(){typeof b=="function"&&b()},ms)},[b]),[ee,te]=m.useState(void 0),Jt=m.useCallback(function(){typeof ee=="function"&&ee()},[ee]);m.useEffect(function(){const ge=f.current;if(!ge){console.error("Error. Map canvas as html element does not exist");return}const Ge=S.current;if(!Ge){console.error("Error. Map overlay as html element does not exist");return}const Ke=g.current;if(!Ke){console.error("Error. Map zoom level label as html element does not exist");return}const Ve=_.current;if(!Ve){console.error("Error. Map pointer dot as html element does not exist");return}const{renderer:tn,overlayRenderer:nn,scene:sn,spritesGroup:on,spritesProjectionLinesGroup:an,planeHelper:rn,camera:ln,cameraControls:cn,renderFrame:Ze,onWindowResize:Xe,destroyMapRenderer:un}=Ni({canvasElement:ge,overlayElement:Ge,mapZoomLevelLabel:Ke,pointerDotElement:Ve,colorTheme:i,onSelectItem:n});return o.current=tn,r.current=nn,u.current=sn,d.current=on,c.current=an,l.current=rn,p.current=ln,h.current=cn,L(()=>Ze),te(()=>Xe),Xe(),Ze(),function(){o.current=null,r.current=null,u.current=null,d.current=null,h.current=null,l.current=null,p.current=null,h.current=null,L(void 0),un()}},[o,r,f,S,g,_,d,c,l,p,h,L,i,n]);const en=Qi({cameraControlsRef:h,cameraRef:p,spritesGroupRef:d});return Gi({spritesGroupRef:d,spritesProjectionLinesGroupRef:c,sceneRef:u,planeHelperRef:l,mapOverlayContainerRef:S,items:e,colorTheme:i,mode:t,setNoDataToDisplay:y,resetCamera:en,renderFrame:v}),Vi({selectedItemUuid:s,spritesGroupRef:d,items:e,colorTheme:i,mode:t,renderFrame:v}),{noDataToDisplay:E,mapCanvasRef:f,mapOverlayContainerRef:S,mapZoomLevelLabelRef:g,pointerDotRef:_,renderFrame:v,onWindowResize:Jt}}const qi="_MapStatusLabel_h103l_1",Ji="_CanvasContainer_h103l_13",eo="_PointerDot_h103l_28",oe={MapStatusLabel:qi,CanvasContainer:Ji,PointerDot:eo},to="_MapDynamicOverlayContainer_1rg5l_1",no={MapDynamicOverlayContainer:to},so="_SpriteLabelAnchor_1c40x_1",io="_SpriteLabel_1c40x_1",oo="_GroupItemId_1c40x_26",ao="_GroupItemName_1c40x_30",Y={SpriteLabelAnchor:so,SpriteLabel:io,GroupItemId:oo,GroupItemName:ao},ro=m.memo(function({item:e}){const n=m.useMemo(function(){let u=[];return D(e)?u=[Y.LocationLabel]:F(e)?u=[Y.MovingEntityLabel]:z(e)&&(u=[Y.PlanetarySystemLabel]),k([Y.SpriteLabelAnchor].concat(u))},[e]);if(!e||!Q(e.position))return;let i;const o=e.name||"unknown name";return D(e)||F(e)?i=e.id:z(e),a.jsx("div",{"data-item-uuid":e.uuid,className:n,children:a.jsxs("div",{className:Y.SpriteLabel,children:[i&&a.jsx("div",{className:Y.GroupItemId,children:i}),a.jsx("div",{className:Y.GroupItemName,children:o})]})})}),lo=m.memo(function({items:e}){return a.jsx(a.Fragment,{children:e.map(n=>a.jsx(ro,{item:n},n.uuid))})}),co="_SpriteHighlightAnchor_1ptxo_1",ae={SpriteHighlightAnchor:co},uo=m.memo(function({item:e}){const n=m.useMemo(function(){let o=[];return D(e)?o=[ae.LocationHighlight]:F(e)?o=[ae.MovingEntityHighlight]:z(e)&&(o=[ae.PlanetarySystemHighlight]),k([ae.SpriteHighlightAnchor].concat(o))},[e]);if(!(!e||!Q(e.position)))return a.jsx("div",{"data-item-uuid":e.uuid,className:n})}),ho=m.memo(function({items:e}){return a.jsx(a.Fragment,{children:e.map(n=>a.jsx(uo,{item:n},n.uuid))})}),mo=m.memo(function({ref:e,items:n,mapMode:s}){return a.jsxs("div",{ref:e,className:no.MapDynamicOverlayContainer,children:[s===R&&a.jsx(lo,{items:n}),s===U&&a.jsx(ho,{items:n})]})}),po="_MapStaticOverlayContainer_11frx_1",_o="_LabelsContainer_11frx_13",fo="_LabelIcon_11frx_27",yo="_Small_11frx_33",go="_LabelContainer_11frx_37",So="_PlaceLabelsContainer_11frx_46",Eo="_SelectedItemLabelsContainer_11frx_55",bo="_LevelIndicationIconWrapper_11frx_65",Po="_IconWrapper_11frx_72",Mo="_IconAndLabelContainerWrapper_11frx_76",Ao="_PlanetarySystemNameLabel_11frx_83",To="_PlanetarySystemNameSubLabel_11frx_92",Lo="_MapZoomLevelLabel_11frx_96",P={MapStaticOverlayContainer:po,LabelsContainer:_o,LabelIcon:fo,Small:yo,LabelContainer:go,PlaceLabelsContainer:So,SelectedItemLabelsContainer:Eo,LevelIndicationIconWrapper:bo,IconWrapper:Po,IconAndLabelContainerWrapper:Mo,PlanetarySystemNameLabel:Ao,PlanetarySystemNameSubLabel:To,MapZoomLevelLabel:Lo},Co="_MapActionButtonsContainer_ans0n_1",Ro="_MapActionButtons_ans0n_1",No="_ActionPanelsContainer_ans0n_29",Te={MapActionButtonsContainer:Co,MapActionButtons:Ro,ActionPanelsContainer:No},vo="_DialogEditFormBody_4y502_1",xo="_Content_4y502_16",Oo="_ErrorMessageContainer_4y502_22",Io="_ErrorMessageText_4y502_32",jo="_ActionButtons_4y502_91",wo="_ActionButtonsGroup_4y502_97",G={DialogEditFormBody:vo,Content:xo,ErrorMessageContainer:Oo,ErrorMessageText:Io,ActionButtons:jo,ActionButtonsGroup:wo},xe=({productsAsSelectOptions:t})=>[{name:"locationUuid",label:"location",type:"hidden",filterPredicate:(e,n)=>e.locationUuid===n.locationUuid},{name:"productUuid",label:"product",type:"select",options:t,chooseOptionLabel:"choose a product",noOptionsLabel:"no products available",allowToSelectNoValueOption:!0,filterPredicate:(e,n)=>e.productUuid===n.productUuid},{type:"row-container",label:"quantity",labelForFieldName:"minQuantity",fields:[{name:"minQuantity",label:"min",type:"number",min:0,max:Number.MAX_SAFE_INTEGER,filterPredicate:(e,n)=>{const s=n.minQuantity;return s===void 0?!0:nt(e)?e.availableQuantity>=s:st(e)?e.desirableQuantity>=s:!0}},{name:"maxQuantity",label:"max",type:"number",min:0,max:Number.MAX_SAFE_INTEGER,filterPredicate:(e,n)=>{const s=n.maxQuantity;return s===void 0?!0:nt(e)?e.availableQuantity<=s:st(e)?e.desirableQuantity<=s:!0}}]},{type:"row-container",label:"price",labelForFieldName:"minPrice",fields:[{name:"minPrice",label:"min",type:"number",valueType:"float",pattern:"[0-9]+[.][0-9]{2}",min:0,max:Number.MAX_SAFE_INTEGER,step:"0.01",filterPredicate:(e,n)=>{const s=n.minPrice;return s===void 0?!0:e.price>=s}},{name:"maxPrice",label:"max",type:"number",valueType:"float",pattern:"[0-9]+[.][0-9]{2}",min:0,max:Number.MAX_SAFE_INTEGER,step:"0.01",filterPredicate:(e,n)=>{const s=n.maxPrice;return s===void 0?!0:e.price<=s}}]},{name:"minProfit",label:"min profit",type:"number",valueType:"float",pattern:"[0-9]+[.][0-9]{2}",min:0,max:Number.MAX_SAFE_INTEGER,step:"0.01",filterPredicate:void 0}],Do=t=>{if(!t)return;const{minPrice:e,maxPrice:n,minQuantity:s,maxQuantity:i}=t;if(typeof e=="number"&&Number.isFinite(e)&&typeof n=="number"&&Number.isFinite(n)&&e>n)return function(){return a.jsxs(a.Fragment,{children:[a.jsx("strong",{children:"Max price"})," ","should be equal or greater then"," ",a.jsx("strong",{children:"min price"}),"."]})};if(typeof s=="number"&&Number.isFinite(s)&&typeof i=="number"&&Number.isFinite(i)&&s>i)return function(){return a.jsxs(a.Fragment,{children:[a.jsx("strong",{children:"Max quantity"})," ","should be equal or greater then"," ",a.jsx("strong",{children:"min quantity"}),"."]})}};m.memo(function({filterValue:e,onSetFilterValue:n,onHide:s}){const i=m.useRef(null),o=B([W,O,Be]),r=Oe([Re,ve]),u=Re(b=>b.items),d=ve(b=>b.items),c=o||r,l=m.useMemo(function(){return xe(c?{productsAsSelectOptions:[]}:{productsAsSelectOptions:d})},[c,u,d]),h=m.useCallback(function(){s()},[s]),p=m.useCallback(function(L){n(L),h()},[h,n]),{handleSubmit:E,formValidationErrorMessage:y}=gs({formRef:i,onSubmit:p,formFields:l,validateFormData:Do,showErrorWhenAllVisibleFieldsEmpty:!1}),f=m.useCallback(function(){E()},[E]);return Ss(i,l,f),a.jsx(a.Fragment,{children:a.jsx(yn,{title:"filter orders",onHide:h,children:a.jsxs("form",{ref:i,className:G.DialogEditFormBody,onSubmit:E,children:[a.jsxs("div",{className:G.Content,children:[a.jsx(Es,{formFields:l,item:e}),y!==void 0&&a.jsx("div",{className:G.ErrorMessageContainer,children:a.jsx("span",{className:G.ErrorMessageText,children:typeof y=="function"?y():y})})]}),a.jsxs("div",{className:G.ActionButtons,children:[a.jsx("div",{className:G.ActionButtonsGroup,children:a.jsx(w,{type:"reset",children:"reset filter"})}),a.jsx("div",{className:G.ActionButtonsGroup,children:a.jsx(w,{type:"submit",primary:!0,children:"apply filter"})})]})]})})})});const Fo=["productUuid","availableQuantity","price","locationUuid"];function Uo(){return[{name:"uuid",isCheckbox:!0},{name:"productUuid",label:"product",asLinkToEditItem:!0,isSortable:!0,alignLabel:"left",formatValue:Is,actionButtons:Os,sortFn:xs},{name:"availableQuantity",label:"stock",type:"number",isSortable:!0,formatValue:js},{name:"price",type:"number",isSortable:!0,sort:"asc",formatValue:ws},{name:"locationUuid",label:"location",alignLabel:"right",isSortable:!0,formatValue:Us,actionButtons:Ds,sortFn:Fs}]}m.memo(function({sellOrderFilterValue:e}){const n=et(bs(p=>p.items())),s=B([et,Be,W,O]),i=Oe([jt]),o=s||i,r=m.useMemo(function(){const E=xe({productsAsSelectOptions:[]});return Ps(E)},[o]),u=gn(n,r,e),d=m.useMemo(function(){return Uo()},[o]),{sortedItems:c,columnsToSortBy:l,handleColumnSortClick:h}=Sn(u,d,Fo);return a.jsx(a.Fragment,{children:a.jsx(En,{tableTitle:"sell orders",tableColumns:d,items:c,noItemsLabel:"no sell orders",isLoading:o,columnsToSortBy:l,onColumnHeaderClick:h,filterValue:e,children:a.jsx(bn,{items:c,columns:d})})})});const ft=[bt,Pt,Mt,At,Tt],Ho=[$,q,J,Ie];function yt(t){const e={locationId:t.get($)||void 0,locationName:t.get(q)||void 0,planetarySystemName:t.get(J)||void 0,productName:t.get(Ie)||void 0,minPrice:+(t.get(bt)||0)||void 0,maxPrice:+(t.get(Pt)||0)||void 0,minQuantity:+(t.get(Mt)||0)||void 0,maxQuantity:+(t.get(At)||0)||void 0,minProfit:+(t.get(Tt)||0)||void 0};return Lt(e)}function Bo({filterValue:t}){if(!t)return;const{locationId:e,locationName:n,planetarySystemName:s,productName:i,...o}=t;let r;e||n?r=Dt({id:e,name:n,planetarySystemName:s})?.uuid:s&&(r=Ft(s)?.uuid);let u;return i&&(u=Ms(i)?.uuid),{...o,locationUuid:r,productUuid:u}}function Wo({urlSearchParams:t,setUrlSearchParams:e}){const n=B([W,O,Be]),s=Oe([Re,jt,ve]),i=n||s,o=m.useRef(void 0),r=m.useMemo(function(){const c=yt(t),l=Bo({filterValue:c}),h=o.current;return de(h,l)?(o.current=l,l):h},[t,o,i]),u=m.useCallback(function(c){let l;if(typeof c=="function")throw new Error("MapOrderPricesValue as setState(prev=>newState) function not supported");c&&Object.keys(c).length>0&&(l=c),e(h=>{const p=yt(h);if(de(p,l)){if(!l)return ft.forEach(_=>{h.delete(_)}),Ho.forEach(_=>{h.delete(_)}),h;ft.forEach(_=>{l[_]?h.set(_,`${l[_]}`):h.delete(_)});const y=l.locationUuid,f=l.productUuid;Yt({urlSearchParams:h,locationUuid:y,planetarySystemUuid:y,productUuid:f,locationIdUrlSearchParamsKeyName:$,locationNameUrlSearchParamsKeyName:q,planetarySystemNameUrlSearchParamsKeyName:J,productNameUrlSearchParamsKeyName:Ie})}return h})},[e]);return{mapOrderPricesFilterValue:r,setMapOrderPricesFilterValueToUrlSearchParams:u}}const ko=m.memo(function({mapMode:e}){const{urlSearchParams:n,setUrlSearchParams:s}=Ct();return Wo({urlSearchParams:n,setUrlSearchParams:s}),tt(!1),tt(!1),a.jsx(a.Fragment,{children:e===U&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:Te.MapActionButtonsContainer,children:a.jsxs("ul",{className:Te.MapActionButtons,children:[ot,it]})}),a.jsxs("div",{className:Te.ActionPanelsContainer,children:[ot,it]})]})})}),zo=m.memo(function({selectedPlanetarySystemUuid:e,selectedMovingEntityUuid:n,selectedLocationUuid:s,mapZoomLevelLabelRef:i,mapMode:o}){const r=m.useMemo(function(){if(o!==R)return e&&ce(e)?.name},[e,o]),u=m.useMemo(()=>n&&Ut(n),[n]),d=m.useMemo(()=>u&&Q(u.position),[u]),c=m.useMemo(function(){if(o!==R&&u)return!u.id&&!u.name?"(no data)":ne([u.id,u.name],!1,he)},[o,u]),l=m.useMemo(()=>s&&We(s),[s]),h=m.useMemo(()=>l&&Q(l.position),[l]),p=m.useMemo(function(){if(o!==R&&l)return!l.id&&!l.name?"(no data)":ne([l.id,l.name],!1,he)},[o,l]);return a.jsxs("div",{className:P.MapStaticOverlayContainer,children:[a.jsxs("div",{className:P.LabelsContainer,children:[a.jsxs("div",{className:P.PlaceLabelsContainer,children:[!r&&a.jsxs("div",{className:P.IconAndLabelContainerWrapper,children:[a.jsx(w,{noPadding:!0,noBorder:!0,transparent:!0,disabled:!0,asInitial:!0,children:a.jsx(T,{name:"graph_3"})}),a.jsxs("div",{className:P.LabelContainer,children:[a.jsx("div",{className:P.PlanetarySystemNameLabel,children:"Universe"}),a.jsx("div",{className:P.PlanetarySystemNameSubLabel,children:"(global map)"})]})]}),r&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:k([P.LabelContainer,P.IconWrapper]),children:a.jsx(K,{to:As,title:"global map",children:a.jsx(T,{name:"graph_3"})})}),a.jsx("div",{className:P.LevelIndicationIconWrapper,children:a.jsx(w,{noPadding:!0,noBorder:!0,transparent:!0,disabled:!0,children:a.jsx(T,{name:"chevron_right"})})}),a.jsxs("div",{className:P.IconAndLabelContainerWrapper,children:[a.jsx(T,{name:"planet_orbit",className:P.LabelIcon}),a.jsx("div",{className:P.LabelContainer,children:a.jsx("div",{className:P.PlanetarySystemNameLabel,children:r})})]})]})]}),c&&a.jsx("div",{className:P.SelectedItemLabelsContainer,children:a.jsxs("div",{className:P.IconAndLabelContainerWrapper,children:[d&&a.jsx(T,{name:"location_on",className:k([P.LabelIcon,P.Small]),title:"moving object"}),!d&&a.jsx(T,{name:"not_listed_location",className:k([P.LabelIcon,P.Small]),title:"moving object at unknown position"}),a.jsx("div",{className:P.LabelContainer,children:a.jsx("div",{className:P.PlanetarySystemNameLabel,children:c})})]})}),p&&a.jsx("div",{className:P.SelectedItemLabelsContainer,children:a.jsxs("div",{className:P.IconAndLabelContainerWrapper,children:[h&&a.jsx(T,{name:"location_on",className:k([P.LabelIcon,P.Small]),title:"location"}),!h&&a.jsx(T,{name:"not_listed_location",className:k([P.LabelIcon,P.Small]),title:"location at unknown position"}),a.jsx("div",{className:P.LabelContainer,children:a.jsx("div",{className:P.PlanetarySystemNameLabel,children:p})})]})}),a.jsx(ko,{mapMode:o})]}),a.jsx("div",{ref:i,className:P.MapZoomLevelLabel})]})}),Yo=m.memo(function({isLoading:e=!1,items:n=[],mapMode:s,selectedPlanetarySystemUuid:i,onSelectItem:o,selectedItemUuid:r,selectedMovingEntityUuid:u,selectedLocationUuid:d}){const{mapCanvasRef:c,mapOverlayContainerRef:l,mapZoomLevelLabelRef:h,pointerDotRef:p,noDataToDisplay:E,renderFrame:y,onWindowResize:f}=$i({mode:s,items:n,onSelectItem:o,selectedItemUuid:r}),_=m.useCallback(function(){f(),y()},[f,y]);return ti(c,_),a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:oe.CanvasContainer,children:[a.jsx("canvas",{ref:c}),a.jsx(mo,{ref:l,items:n,mapMode:s}),a.jsx(zo,{mapZoomLevelLabelRef:h,selectedPlanetarySystemUuid:i,selectedMovingEntityUuid:u,selectedLocationUuid:d,mapMode:s}),a.jsx("div",{ref:p,className:oe.PointerDot})]}),e&&a.jsx("div",{className:oe.MapStatusLabel,children:"data loading..."}),!e&&E&&a.jsx("div",{className:oe.MapStatusLabel,children:"no data available"})]})}),Go="_Container_1mnd6_1",Ko="_MapContainer_1mnd6_9",Vo="_SearchResults_1mnd6_18",Zo="_SearchResultName_1mnd6_33",ue={Container:Go,MapContainer:Ko,SearchResults:Vo,SearchResultName:Zo};function gt(t){let e;if(z(t))e=t;else if(D(t))e=!!t.planetarySystemUuid&&ce(t.planetarySystemUuid)||void 0;else if(F(t)){const n=!!t.locationUuid&&We(t.locationUuid)||void 0;n?e=!!n?.planetarySystemUuid&&ce(n.planetarySystemUuid)||void 0:e=!!t.locationUuid&&ce(t.locationUuid)||void 0}return e}function Xo(){return[{name:"name",asLinkToSelectItem:!0,alignLabel:"left",formatValue:function({item:e}){const s=B([O,W,H])?void 0:gt(e),i=D(e)||F(e)?ne([e.id,e.name,s?.name]):e.name;return a.jsx(a.Fragment,{children:typeof i=="string"?a.jsxs("div",{className:ue.SearchResultName,children:[F(e)&&a.jsxs(a.Fragment,{children:[a.jsx(T,{name:"location_on"})," "]}),D(e)&&a.jsxs(a.Fragment,{children:[a.jsx(T,{name:"location_on"})," "]}),z(e)&&a.jsxs(a.Fragment,{children:[a.jsx(T,{name:"planet_orbit"})," "]}),i]}):a.jsx(Pn,{children:"(nodata)"})})},actionButtons:function({item:e}){const n=B([O,W,H]),s=n?void 0:gt(e),i=F(e)&&(n||!Qe(e.uuid))?void 0:Ut(e.uuid),o=Hs({movingEntityName:i?.id||i?.name}),r=D(e)&&(n||!Qe(e.uuid))?void 0:We(e.uuid),u=r&&Je({locationName:r?.id||r?.name,planetarySystemName:s?.name}),d=s&&Je({planetarySystemName:s?.name}),c=Q(e.position),l=i&&c&&Ee({planetarySystemName:s?.name,movingEntityId:i.id,movingEntityName:i.name}),h=r&&c&&Ee({planetarySystemName:s?.name,locationId:r.id,locationName:r.name}),p=s&&c&&Ee({planetarySystemName:s?.name,mapMode:R});return a.jsxs(a.Fragment,{children:[F(e)&&a.jsxs(a.Fragment,{children:[l?a.jsx(K,{to:l,title:"show moving object on map",children:a.jsx(T,{name:"location_on"})}):a.jsx(w,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no position data",children:a.jsx(T,{name:"not_listed_location"})}),o?a.jsx(K,{to:o,title:"show moving object info",children:a.jsx(T,{name:"info"})}):a.jsx(w,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no moving object data",children:a.jsx(T,{name:"search_off"})})]}),D(e)&&a.jsxs(a.Fragment,{children:[h?a.jsx(K,{to:h,title:"show location on map",children:a.jsx(T,{name:"location_on"})}):a.jsx(w,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no position data",children:a.jsx(T,{name:"not_listed_location"})}),u?a.jsx(K,{to:u,title:"show location info",children:a.jsx(T,{name:"info"})}):a.jsx(w,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no location data",children:a.jsx(T,{name:"search_off"})})]}),z(e)&&a.jsxs(a.Fragment,{children:[p?a.jsx(K,{to:p,title:"show planetary system on map",children:a.jsx(T,{name:"location_on"})}):a.jsx(w,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no position data",children:a.jsx(T,{name:"not_listed_location"})}),d?a.jsx(K,{to:d,title:"show planetary system info",children:a.jsx(T,{name:"info"})}):a.jsx(w,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no planetary system data",children:a.jsx(T,{name:"search_off"})})]})]})}}]}function Qo(t,e){const s=B([O,W,H]),i=m.useMemo(function(){return e===R?[]:t?Ht(t):[]},[t,s,e]),o=m.useMemo(function(){return e===R?[]:t?Bt(t):[]},[t,s,e]),r=m.useMemo(function(){return e===R?Ne():[]},[s,e]);return m.useMemo(function(){return e===R?r:new Array().concat(i,o)},[r,i,o,s,e])}function St(t,e){return t.name.localeCompare(e.name)}function re(t,e){return t.id&&e.id?t.id.localeCompare(e.id):t.name.localeCompare(e.name)}function $o({searchFieldValue:t,selectedPlanetarySystemUuid:e,mapMode:n}){const i=B([O,W,H]),o=m.useMemo(function(){return t?Ne().filter(h=>h.name.includes(t)).sort(St):n===R?Ne().sort(St):[]},[t,i,n]),r=m.useMemo(function(){if(!t)return n===R?[]:e?Ht(e).sort(re):[];const l=t.toLocaleUpperCase();return Ts().filter(p=>p.id&&p.id.includes(l)?!0:p.name.includes(t)).sort(re)},[t,e,i,n]),u=m.useMemo(function(){if(!t)return n===R?[]:e?Bt(e).sort(re):[];const l=t.toLocaleUpperCase();return Ls().filter(p=>p.id&&p.id.includes(l)||p.originalId&&p.originalId.includes(l)?!0:p.name.includes(t)).sort(re)},[t,e,i,n]);return m.useMemo(function(){return new Array().concat(o,r,u)},[o,r,u])}const qo=[je,we,$,q,J,De];function _e(t){const e=t.get(De)||void 0,n=ps(e)?e:void 0,s={movingEntityId:t.get(je)||void 0,movingEntityName:t.get(we)||void 0,locationId:t.get($)||void 0,locationName:t.get(q)||void 0,planetarySystemName:t.get(J)||void 0,mapMode:n};return Lt(s)}function Jo({filterValue:t}){if(!t)return;const{movingEntityId:e,movingEntityName:n,locationId:s,locationName:i,planetarySystemName:o,mapMode:r,...u}=t,c=Cs({id:e,name:n,planetarySystemName:o})?.uuid,l=Dt({id:s,name:i,planetarySystemName:o}),h=l?.uuid,p=l?.planetarySystemUuid?l?.planetarySystemUuid:!!o&&Ft(o)?.uuid||void 0;return{...u,movingEntityUuid:c,locationUuid:h,planetarySystemUuid:p,mapMode:r}}function ea({urlSearchParams:t,setUrlSearchParams:e}){const s=B([H,W,O]),i=m.useRef(void 0),o=m.useMemo(function(){const d=_e(t),c=Jo({filterValue:d}),l=i.current;return de(l,c)?(i.current=c,c):l},[t,i,s]),r=m.useCallback(function(d){let c;if(typeof d=="function")throw new Error("MapFilterValue as setState(prev=>newState) function not supported");d&&Object.keys(d).length>0&&(c=d),e(l=>{const h=_e(l);if(de(h,c)){if(!c)return qo.forEach(S=>{l.delete(S)}),l;const E=c.movingEntityUuid,y=c.locationUuid,f=c.planetarySystemUuid,_=c.mapMode;Yt({urlSearchParams:l,movingEntityUuid:E,locationUuid:y,planetarySystemUuid:f,mapMode:_,movingEntityIdUrlSearchParamsKeyName:je,movingEntityNameUrlSearchParamsKeyName:we,locationIdUrlSearchParamsKeyName:$,locationNameUrlSearchParamsKeyName:q,planetarySystemNameUrlSearchParamsKeyName:J,mapModeUrlSearchParamsKeyName:De})}return l})},[e]);return{mapFilterValue:o,setMapFilterValueToUrlSearchParams:r}}const Vt=Mn();function ze(){const{isHydrating:t,isHydrated:e}=H.getState(),{isHydrating:n,isHydrated:s}=O.getState();if(t||!e||n||!s)return;const i=Wt(),o=kt(),r=zt();ta({movingEntitiesMap:i,locationsMap:o,planetarySystemsMap:r})}Vt.setState({prepareData:ze});H.subscribe(function(){ze()});O.subscribe(function(){ze()});function ta({movingEntitiesMap:t,locationsMap:e,planetarySystemsMap:n}){const s=Vt.getState();s.isProcessing||(s.setIsProcessing(!0),window.setTimeout(function(){const r=sa({movingEntitiesMap:t,locationsMap:e,planetarySystemsMap:n});s.replaceAll(r),s.setIsProcessing(!1)},0))}function Zt(t,e=!1,n){const s=t?.id??"",i=t?.name??"(movingEntity without name)",o=n??ne([s,i]),r=e?An(i,"name"):o;return{movingEntityNameWithId:o,movingEntityNameWithIdAsLabel:r}}function na({movingEntitiesMap:t,locationsMap:e,planetarySystemsMap:n,shouldAddSuffixLabel:s=!1}){const i=[],o=pe(n),r=pe(t);return o.forEach(function(d){const c=d?d.uuid:void 0,{planetarySystemName:l,planetarySystemNameAsLabel:h}=me(d,s);i.push({uuid:c,name:l,label:h,items:[]})}),r.forEach(function(d){const l=e.get(d.locationUuid)?.planetarySystemUuid,h=l?n.get(l):void 0,p=h?.uuid,{planetarySystemName:E,planetarySystemNameAsLabel:y}=me(h,s),f=d.uuid,{movingEntityNameWithId:_,movingEntityNameWithIdAsLabel:S}=Zt(d,s),g=i.find(b=>b.uuid===p);g?(g.items||(g.items=[]),g.items.find(L=>L.uuid===f)||g.items.push({uuid:f,name:_,label:S})):i.push({uuid:p,name:E,label:y,items:[{uuid:f,name:_,label:S}]})}),i}function Xt(t){t.sort((e,n)=>e.name.localeCompare(n.name)),t.forEach(({items:e})=>Xt(e??[]))}function Qt({items:t=[],level:e=0,disableOptionsWithoutUuid:n=!0,selectOptions:s=new Array}){return t.forEach(i=>{const{label:o,items:r}=i,u=i.uuid,d=u??"";s.push({value:d,label:o,level:e,disabled:n?!u:!1}),r?.length&&Qt({items:r,level:e+1,disableOptionsWithoutUuid:n,selectOptions:s})}),s}function sa({movingEntitiesMap:t,locationsMap:e,planetarySystemsMap:n,disableOptionsWithoutUuid:s}){const i=na({movingEntitiesMap:t,locationsMap:e,planetarySystemsMap:n,shouldAddSuffixLabel:!1});return Xt(i),Qt({items:i,disableOptionsWithoutUuid:s})??[]}const $t=_s();function Ye(){const{isHydrating:t,isHydrated:e}=H.getState(),{isHydrating:n,isHydrated:s}=O.getState();if(t||!e||n||!s)return;const i=Wt(),o=kt(),r=zt();ia({movingEntitiesMap:i,locationsMap:o,planetarySystemsMap:r})}$t.setState({prepareData:Ye});H.subscribe(function(){Ye()});O.subscribe(function(){Ye()});function ia({movingEntitiesMap:t,locationsMap:e,planetarySystemsMap:n}){const s=$t.getState();s.isProcessing||(s.setIsProcessing(!0),window.setTimeout(function(){const r=oa({movingEntitiesMap:t,locationsMap:e,planetarySystemsMap:n});s.replaceAll(r),s.setIsProcessing(!1)},0))}function oa({movingEntitiesMap:t,locationsMap:e,planetarySystemsMap:n}){return ra({movingEntitiesMap:t,locationsMap:e,planetarySystemsMap:n,shouldAddSuffixLabel:!1})}function qt({id:t,name:e,reverseOrder:n=!1,namePartSeparator:s=he}){let o=[ne([t,e],!1," ")].filter(r=>!!r);return n&&(o=o.reverse()),o.join(s)}function aa({movingEntity:t,locationsMap:e,planetarySystemsMap:n,isUsingNoDataTextForEmptyParts:s={},reverseOrder:i=!1,namePartSeparator:o=he}){const r=s.id?"(no-id)":"",u=t.locationUuid,c=(u?e.get(u):void 0)?.planetarySystemUuid,l=c?n.get(c):void 0,h=s.planetarySystem?"(no planetary system data)":"";return qt({id:t.id??r,name:t.name,planetarySystemName:l?.name??h,reverseOrder:i,namePartSeparator:o})}function ra({movingEntitiesMap:t,locationsMap:e,planetarySystemsMap:n,shouldAddSuffixLabel:s=!1}){const i=new Map,o=pe(n),r=pe(t);return o.forEach(function(d){const c=d.uuid,{planetarySystemName:l}=me(d,s);i.set(c,l)}),r.forEach(function(d){const c=d?.locationUuid,l=e.get(c),h=l?.planetarySystemUuid,p=h?n.get(h):void 0,E=p?p.uuid:void 0,{planetarySystemName:y}=me(p,s),f=d.uuid,_=l?aa({movingEntity:d,locationsMap:e,planetarySystemsMap:n,isUsingNoDataTextForEmptyParts:{planetarySystem:!0}}):void 0,{movingEntityNameWithId:S}=Zt(d,s,_);!(E?i.get(E):void 0)&&E&&i.set(E,y),i.set(f,S)}),i}const Et="Map";function la({movingEntityName:t,locationName:e}){const n=[t,!!e&&(t?`in ${e}`:`${e}`)].filter(s=>!!s);return n.length?`${n.join(" ")} - ${Et}`:`${Et}`}function ca(t){const e=m.useMemo(function(){const o=_e(t);return fs({id:o?.locationId,name:o?.locationName,planetarySystemName:o?.planetarySystemName})},[t]),n=m.useMemo(function(){const o=_e(t);return qt({id:o?.movingEntityId,name:o?.movingEntityName,planetarySystemName:o?.planetarySystemName})},[t]);return m.useMemo(function(){return Bs(la({movingEntityName:n,locationName:e}))},[n,e])}function ua({urlSearchParams:t,setUrlSearchParams:e}){return Tn({urlSearchParams:t,setUrlSearchParams:e,getSearchValueFromUrlSearchParams:Ln,searchValueKeyInUrlSearchParams:$e,searchFieldNameInSearchForm:$e,searchFieldPlaceholderTextInSearchForm:"Search by name or id..."})}const da=m.memo(function(){const{urlSearchParams:e,setUrlSearchParams:n}=Ct(),s=ca(e),{mapFilterValue:i,setMapFilterValueToUrlSearchParams:o}=ea({urlSearchParams:e,setUrlSearchParams:n}),{SearchForm:r,searchFieldValue:u}=ua({urlSearchParams:e,setUrlSearchParams:n}),c=B([O,W,Rs,H,Ns]),{movingEntityUuid:l,locationUuid:h,planetarySystemUuid:p,mapMode:E}=i||{},y=m.useMemo(function(){return Xo()},[c]),f=m.useCallback(function(v){z(v)?o({planetarySystemUuid:v.uuid}):D(v)?o({locationUuid:v.uuid}):F(v)&&o({movingEntityUuid:v.uuid})},[o]),_=m.useMemo(function(){return l||h?U:p?E?R:U:R},[E,l,h,p]),S=$o({searchFieldValue:u,selectedPlanetarySystemUuid:p,mapMode:_}),g=Qo(p,_),b=m.useMemo(function(){return l||h||p},[p,h,l]);return a.jsxs(a.Fragment,{children:[a.jsx("title",{children:s}),a.jsxs("div",{className:ue.Container,children:[a.jsx("div",{className:ue.SearchResults,children:a.jsxs(hn,{children:[a.jsx(Cn,{children:r}),a.jsx(ei,{tableTitle:"search results",items:S,noItemsLabel:"no results",isLoading:c,searchFieldValue:u,children:a.jsx(Js,{items:S,columns:y,onSelectItem:f,selectedItemUuid:b})})]})}),a.jsx("div",{className:ue.MapContainer,children:a.jsx(Yo,{isLoading:c,items:g,mapMode:_,selectedPlanetarySystemUuid:p,onSelectItem:f,selectedItemUuid:b,selectedMovingEntityUuid:l,selectedLocationUuid:h})})]})]})}),Na=dn(function(){return a.jsx(da,{})});export{Na as default};
