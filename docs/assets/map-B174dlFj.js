var Ie=Object.defineProperty;var je=(e,t,n)=>t in e?Ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var N=(e,t,n)=>je(e,typeof t!="symbol"?t+"":t,n);import{a as _,p as h,s as Ue}from"./chunk-NL6KNZEE-BTkWJe7M.js";import{S as He}from"./SearchFormAndTableContainer-DLdA1ywV.js";import{O as Fe,P as ke,Q as ze,R as We,i as Ft,S as lt,N as Ye,d as kt,V as bt,I as Pt,h as Mt,j as Tt,k as Lt,W as At,l as Be,c as Ge,a as Ke,p as Ze,u as Xe,X as Ve,Y as zt,o as qe}from"./useTableSearch-DPqT5ak_.js";import{n as ne,ae as se,an as $e,t as Q,o as B,J as v,z as G,ap as x,ay as Qe,q as ie,B as F,az as oe,aA as ae,aB as yt,aC as Je,aD as tn,aE as en,W as nn,X as sn,aF as re,aG as le,aH as ce,H as et,ab as on,am as an}from"./useLoadingPersistStorages-DZq79gEa.js";import{B as rn,V as M,n as he,o as ue,S as ln,q as cn,r as de,G as Rt,Q as gt,s as hn,t as un,v as St,w as dn,T as mn,x as pn,y as _n,z as w,A as U,p as Ct,C as fn,D as it,F as ot,H as ct,O as yn,I as R,J as I,M as C,K as gn,N as Nt,R as Ot,U as me,W as J,X as Sn,Y as pe,Z as En,_ as Y,$ as W,a0 as Wt,a1 as bn,a2 as _e,a3 as Pn,a4 as Mn,a5 as Tn,a6 as Ln,a7 as An,a8 as Rn,a9 as Cn,aa as Nn,ab as On,ac as vn,ad as xn,ae as wn,af as Dn,ag as In,ah as jn,ai as Un,aj as Hn,ak as Fn,al as kn,am as zn,an as Wn,ao as Yn,ap as Bn,aq as Gn,ar as Kn,b as Yt,d as ht,L as Z,c as vt,as as Zn,at as nt,au as Xn,av as fe,e as Vn}from"./getUrlToMapPageWithParams-DQTZNjgO.js";import{i as D}from"./MovingEntity-BiWlf-nQ.js";import{c as ye}from"./createPageTitleString-BzKRSWbw.js";import{u as qn}from"./useLocalStorage-C3FLdLLg.js";import{I as ut,s as $n}from"./setMovingEntityOrLocationOrPlanetarySystemToUrlSearchParams-BCaGFixb.js";import{N as dt,P as Qn}from"./PlanetOrbitIcon-BZk0WnUT.js";import{S as k}from"./StaticLink-BbBTYWDN.js";import{g as Jn}from"./getUrlToMovingEntitiesPageWithParams-CWbyf7s4.js";import"./middleware-XeL71aNN.js";import"./App.const-DNoFr9tQ.js";const ts="_TableWrapper_1bwb0_1",es="_TableContainer_1bwb0_10",ns="_Table_1bwb0_1",ss="_TableHeaderContainer_1bwb0_23",is="_TableHeaderLeftPart_1bwb0_37",os="_TableHeaderRightPart_1bwb0_45",as="_TableItemsQuantity_1bwb0_53",rs="_TableTitle_1bwb0_59",ls="_TableTitleActonButtons_1bwb0_68",cs="_NoData_1bwb0_98",hs="_LoadingData_1bwb0_99",O={TableWrapper:ts,TableContainer:es,Table:ns,TableHeaderContainer:ss,TableHeaderLeftPart:is,TableHeaderRightPart:os,TableItemsQuantity:as,TableTitle:rs,TableTitleActonButtons:ls,NoData:cs,LoadingData:hs},us=_.memo(function({item:t,columns:n,onSelectItem:s,isHighlightRow:i}){return h.jsx(Fe,{isHighlightRow:i,isHighlightRowBlinking:!1,children:n.map((o,a)=>h.jsx(ke,{item:t,column:o,columnIndex:a,onSelectItem:s},o.name))})}),ds=_.memo(function({items:t,columns:n,onSelectItem:s=()=>{},selectedItemUuid:i}){const o=ze({items:t});return h.jsx(h.Fragment,{children:o.map(a=>h.jsx(us,{item:a,columns:n,onSelectItem:s,isHighlightRow:i===a.uuid},a.uuid))})}),ms=_.memo(function({tableTitle:t="Table",items:n=[],noItemsLabel:s="no data",isLoading:i=!1,loadingLabel:o="loading data...",itemTypeName:a="item",itemTypeNamePlural:u="items",searchFieldValue:r,filterValue:c,children:l}){const d=_.useRef(null),{vertical:m}=We(d,n),E=ne([O.TableContainer,m&&O.TableContainerWithVisibleScrollbar]);return h.jsxs("div",{className:O.TableWrapper,children:[h.jsxs("div",{className:O.TableHeaderContainer,children:[h.jsxs("div",{className:O.TableHeaderLeftPart,children:[h.jsx("h2",{className:O.TableTitle,children:t}),h.jsx("div",{className:O.TableTitleActonButtons})]}),h.jsx("div",{className:O.TableHeaderRightPart,children:h.jsxs("div",{className:O.TableItemsQuantity,children:[c||r?"found":"total"," ",n.length," ",n.length>1||n.length===0?u:a]})})]}),h.jsx("div",{ref:d,className:E,children:h.jsx("table",{className:O.Table,children:h.jsxs("tbody",{children:[i&&h.jsx("tr",{children:h.jsx("td",{colSpan:100,rowSpan:100,className:O.LoadingData,children:o})}),!i&&!n.length&&h.jsx("tr",{children:h.jsx("td",{colSpan:100,rowSpan:100,className:O.NoData,children:s})}),!i&&!!n.length&&l]})})})]})});function ps(e,t){const[n,s]=_.useState(0),[i,o]=_.useState(0),a=_.useCallback(function(c,l){s(c),o(l)},[s,o]),u=_.useCallback(function(){const c=e==null?void 0:e.current;if(!c)return;const l=c.clientWidth,d=c.clientHeight;!Number.isFinite(l)||!Number.isFinite(d)||l<1||d<1?a(0,0):a(l,d),typeof t=="function"&&t(l,d)},[e,a,t]);return _.useEffect(function(){const c=e==null?void 0:e.current;if(!c)return;const l=new ResizeObserver(u);return l.observe(c),function(){l.unobserve(c),l.disconnect()}},[e,u]),_.useEffect(function(){return document.addEventListener("load",u),function(){document.removeEventListener("load",u)}},[u]),{elementWidth:n,elementHeight:i}}function ge(e){const t=new rn;return e.traverse(function(s){t.expandByPoint(s.position)}),t}function Bt(e=[new M,new M(1,1,1)],t){const n=new he().setFromPoints(e),s=t==="light"?ln:cn,i=new ue({color:s,toneMapped:!1}),o=new de(n,i);return o.addEventListener("removed",function(){o.material.dispose(),o.geometry.dispose()}),o}function _s({position:e,parentQuaternion:t,group:n,size:s=1,colorTheme:i}){const o=new Rt,a=[new M(-.5,0,-.5),new M(.5,0,.5)],u=[new M(.5,0,-.5),new M(-.5,0,.5)],r=Bt(a,i),c=Bt(u,i);return o.add(r),o.add(c),o.position.copy(e),o.applyQuaternion(t),o.applyQuaternion(gt),o.scale.copy(new M(s,s,s)),o.addEventListener("removed",function(){o.clear()}),n.add(o),o}function fs(e,t,n,s){const i=new St;e.getWorldQuaternion(i),_s({group:t,parentQuaternion:i,position:n,size:dn,colorTheme:s})}function ys(e,t,n,s){const i=e.getWorldPosition(new M),o=new M;t.plane.projectPoint(i,o);const a=[i,o],u=new he().setFromPoints(a),r=s==="light"?hn:un,c=new ue({color:r,toneMapped:!1}),l=new de(u,c);return fs(t,l,o,s),l.addEventListener("removed",function(){l.clear(),l.material.dispose(),l.geometry.dispose()}),n.add(l),l}const gs="/images/textures";function mt(e){return`${gs}/${e}.png`}let pt;function Ss(){return pt||(pt=new mn),pt}function _t({textureAsString:e,name:t,position:n,materialColor:s}){const i=Ss().load(e),o=new pn({map:i,color:s,transparent:!0,depthTest:!1}),a=new _n(o);return a.name=t,a.position.copy(n),a.addEventListener("removed",function(){a.material.dispose(),a.geometry.dispose()}),a}const Es=1/1e6,bs=1/1e6;function Ps(e,t){var o,a;const n=Ts(e.position);if(!n)return;const s=t==="light"?it:ot;let i;if(w(e)){n.multiplyScalar(Es),n.applyQuaternion(gt);const u=e.locationTypeUuid?(o=se(e.locationTypeUuid))==null?void 0:o.image:void 0;i=_t({name:e.uuid,textureAsString:u||mt(ct.structureUnknown),position:n,materialColor:s});const r=Ms(e,.25);i.scale.set(r,r,r)}else if(D(e)){n.multiplyScalar(bs),n.applyQuaternion(gt);const u=e.movingEntityClassUuid?(a=$e(e.movingEntityClassUuid))==null?void 0:a.image:void 0;i=_t({name:e.uuid,textureAsString:u||mt(ct.shipUnknown),position:n,materialColor:s}),i.scale.set(.35,.35,.35)}else if(U(e))i=_t({name:e.uuid,textureAsString:mt(ct.circle),position:n,materialColor:s}),i.scale.set(.1,.1,.1);else return;return i.userData.item=e,i}function Ms(e,t=1){var i;const n=e.locationTypeUuid,s=n?(i=se(n))==null?void 0:i.name:void 0;return s&&fn[s]||t}function Ts(e){const t=Ct(e);if(!t)return;const n=new M;return n.fromArray(t),n}class Ls extends yn{constructor(n){super();N(this,"isCSS2DObjectForReactComponent");N(this,"isCSS2DObject");N(this,"element");N(this,"center");this.isCSS2DObjectForReactComponent=!0,this.isCSS2DObject=!0,this.element=n,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable","false"),this.center=new R(.5,.5)}copy(n,s){return super.copy(n,s),this.element=n.element,this.center=n.center,this}}function Gt(e){return e==null?void 0:e.isCSS2DObjectForReactComponent}function As(e,t){return t.querySelector(`[data-item-uuid="${e}"]`)||void 0}function Kt(e,t,n,s=!1){const i=As(e.uuid,n);if(!i)return;const o=new Ls(i);o.position.set(0,0,0),o.visible=s,t.add(o)}function Rs({spritesGroupRef:e,spritesProjectionLinesGroupRef:t,sceneRef:n,planeHelperRef:s,mapOverlayContainerRef:i,items:o,colorTheme:a,mode:u,setNoDataToDisplay:r,resetCamera:c,renderFrame:l}){_.useEffect(function(){const m=e.current;if(!m)return;const E=t.current;if(!E||!n.current)return;const p=s.current;if(!p)return;const f=i.current;if(!f)return;m.clear(),E.clear(),o.forEach(g=>{const b=Ps(g,a);b&&(u===I&&ys(b,p,E,a),u===I?Kt(g,b,f,!1):Kt(g,b,f,!0),m.add(b))});const S=!m.children.length;if(S)p.visible=!1;else if(u===C)p.visible=!1;else if(u===I){p.visible=!0;const g=ge(m),T=Math.max.apply(void 0,new Array().concat(g.min.toArray(),g.max.toArray()).map(Math.abs))*(1+gn)*2;p.setSize(T)}r(S),c(u,S),l()},[o,n,e,t,s,i,r,l,c,u,a])}function Cs(e){return e==null?void 0:e.isSprite}function Ns({selectedItemUuid:e,spritesGroupRef:t,items:n,colorTheme:s,mode:i,renderFrame:o}){_.useEffect(function(){if(!n.length)return;const u=t.current;u&&(u.children.forEach(r=>{var c;if(Cs(r)){const l=r;if(((c=l.userData.item)==null?void 0:c.uuid)===e){const d=s==="light"?Nt:Ot;if(l.material.color.set(d),i===I){const m=l.children.find(E=>Gt(E));m&&(m.visible=!0)}}else{const d=s==="light"?it:ot;if(l.material.color.set(d),i===I){const m=l.children.find(E=>Gt(E));m&&(m.visible=!1)}}}}),o())},[n,t,o,e,s,i])}function Zt({group:e,camera:t,cameraPos:n,cameraTarget:s,defaultCameraPos:i,defaultCameraTarget:o,cameraControls:a}){(i||o)&&(i&&t.position.copy(i),o&&t.lookAt(o));const u=ge(e),r=Math.max.apply(void 0,new Array().concat(u.min.toArray(),u.max.toArray()).map(Math.abs)),c=s||new M,d=r*2/(2*Math.atan(Math.PI*t.fov/360)),m=d/t.aspect,E=Math.max(d,m),y=n||new M().copy(t.position),p=c.clone().sub(y).normalize().multiplyScalar(E),f=new M().copy(c).sub(p),S=new M().copy(c);t.position.copy(f),t.lookAt(S),a.update()}function Os({spritesGroupRef:e,cameraControlsRef:t,cameraRef:n}){return _.useCallback(function(o,a){const u=n.current;if(!u)return;const r=t.current;if(!r)return;const c=e.current;c&&(r.reset(),!a&&(o===C?Zt({group:c,camera:u,cameraControls:r,defaultCameraPos:me,defaultCameraTarget:J}):o===I&&Zt({group:c,camera:u,cameraControls:r,cameraTarget:J,defaultCameraPos:Sn,defaultCameraTarget:J})))},[n,t,e])}const z=new M,Xt=new pe,Vt=new pe,qt=new M,$t=new M;class vs{constructor(t){N(this,"domElement");N(this,"isUsingZOrder");N(this,"getSize");N(this,"render");N(this,"setSize");const n=this;let s,i,o,a;const u={objects:new WeakMap},r=t.element;r.style.overflow="hidden",this.domElement=r,this.isUsingZOrder=!!t.isUsingZOrder,this.getSize=function(){return{width:s,height:i}},this.render=function(p,f){p.matrixWorldAutoUpdate===!0&&p.updateMatrixWorld(),f.parent===null&&f.matrixWorldAutoUpdate===!0&&f.updateMatrixWorld(),Xt.copy(f.matrixWorldInverse),Vt.multiplyMatrices(f.projectionMatrix,Xt),l(p,p,f,this.isUsingZOrder),this.isUsingZOrder&&E(p)},this.setSize=function(p,f){s=p,i=f,o=s/2,a=i/2,r.style.width=p+"px",r.style.height=f+"px"};function c(y){y.isCSS2DObject&&(y.element.style.display="none");for(let p=0,f=y.children.length;p<f;p++)c(y.children[p])}function l(y,p,f,S){if(y.visible===!1){c(y);return}if(y.isCSS2DObject){z.setFromMatrixPosition(y.matrixWorld),z.applyMatrix4(Vt);const g=z.z>=-1&&z.z<=1&&y.layers.test(f.layers)===!0,b=y.element;if(b.style.display=g===!0?"":"none",g===!0&&(y.onBeforeRender(n,p,f),b.style.transform="translate("+-100*y.center.x+"%,"+-100*y.center.y+"%)translate("+(z.x*o+o)+"px,"+(-z.y*a+a)+"px)",y.onAfterRender(n,p,f)),S){const T={distanceToCameraSquared:d(f,y)};u.objects.set(y,T)}}for(let g=0,b=y.children.length;g<b;g++)l(y.children[g],p,f,S)}function d(y,p){return qt.setFromMatrixPosition(y.matrixWorld),$t.setFromMatrixPosition(p.matrixWorld),qt.distanceToSquared($t)}function m(y){const p=new Array;return y.traverseVisible(function(f){f.isCSS2DObject&&p.push(f)}),p}function E(y){const p=m(y).sort(function(S,g){if(S.renderOrder!==g.renderOrder)return g.renderOrder-S.renderOrder;const b=u.objects.get(S).distanceToCameraSquared,T=u.objects.get(g).distanceToCameraSquared;return b-T}),f=p.length;for(let S=0,g=p.length;S<g;S++)p[S].element.style.zIndex=`${f-S}`}}}const Qt={type:"change"},xt={type:"start"},Se={type:"end"},V=new bn,Jt=new _e,xs=Math.cos(70*Pn.DEG2RAD),L=new M,A=2*Math.PI,P={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},ft=1e-6;class ws extends En{constructor(t,n=null){super(t,n),this.state=P.NONE,this.target=new M,this.cursor=new M,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Y.ROTATE,MIDDLE:Y.DOLLY,RIGHT:Y.PAN},this.touches={ONE:W.ROTATE,TWO:W.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new M,this._lastQuaternion=new St,this._lastTargetPosition=new M,this._quat=new St().setFromUnitVectors(t.up,new M(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Wt,this._sphericalDelta=new Wt,this._scale=1,this._panOffset=new M,this._rotateStart=new R,this._rotateEnd=new R,this._rotateDelta=new R,this._panStart=new R,this._panEnd=new R,this._panDelta=new R,this._dollyStart=new R,this._dollyEnd=new R,this._dollyDelta=new R,this._dollyDirection=new M,this._mouse=new R,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Is.bind(this),this._onPointerDown=Ds.bind(this),this._onPointerUp=js.bind(this),this._onContextMenu=Ys.bind(this),this._onMouseWheel=Fs.bind(this),this._onKeyDown=ks.bind(this),this._onTouchStart=zs.bind(this),this._onTouchMove=Ws.bind(this),this._onMouseDown=Us.bind(this),this._onMouseMove=Hs.bind(this),this._interceptControlDown=Bs.bind(this),this._interceptControlUp=Gs.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(t){super.connect(t),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(t){t.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=t}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(Qt),this.update(),this.state=P.NONE}update(t=null){const n=this.object.position;L.copy(n).sub(this.target),L.applyQuaternion(this._quat),this._spherical.setFromVector3(L),this.autoRotate&&this.state===P.NONE&&this._rotateLeft(this._getAutoRotationAngle(t)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let s=this.minAzimuthAngle,i=this.maxAzimuthAngle;isFinite(s)&&isFinite(i)&&(s<-Math.PI?s+=A:s>Math.PI&&(s-=A),i<-Math.PI?i+=A:i>Math.PI&&(i-=A),s<=i?this._spherical.theta=Math.max(s,Math.min(i,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(s+i)/2?Math.max(s,this._spherical.theta):Math.min(i,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let o=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const a=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),o=a!=this._spherical.radius}if(L.setFromSpherical(this._spherical),L.applyQuaternion(this._quatInverse),n.copy(this.target).add(L),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let a=null;if(this.object.isPerspectiveCamera){const u=L.length();a=this._clampDistance(u*this._scale);const r=u-a;this.object.position.addScaledVector(this._dollyDirection,r),this.object.updateMatrixWorld(),o=!!r}else if(this.object.isOrthographicCamera){const u=new M(this._mouse.x,this._mouse.y,0);u.unproject(this.object);const r=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),o=r!==this.object.zoom;const c=new M(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(u),this.object.updateMatrixWorld(),a=L.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;a!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(a).add(this.object.position):(V.origin.copy(this.object.position),V.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(V.direction))<xs?this.object.lookAt(this.target):(Jt.setFromNormalAndCoplanarPoint(this.object.up,this.target),V.intersectPlane(Jt,this.target))))}else if(this.object.isOrthographicCamera){const a=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),a!==this.object.zoom&&(this.object.updateProjectionMatrix(),o=!0)}return this._scale=1,this._performCursorZoom=!1,o||this._lastPosition.distanceToSquared(this.object.position)>ft||8*(1-this._lastQuaternion.dot(this.object.quaternion))>ft||this._lastTargetPosition.distanceToSquared(this.target)>ft?(this.dispatchEvent(Qt),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(t){return t!==null?A/60*this.autoRotateSpeed*t:A/60/60*this.autoRotateSpeed}_getZoomScale(t){const n=Math.abs(t*.01);return Math.pow(.95,this.zoomSpeed*n)}_rotateLeft(t){this._sphericalDelta.theta-=t}_rotateUp(t){this._sphericalDelta.phi-=t}_panLeft(t,n){L.setFromMatrixColumn(n,0),L.multiplyScalar(-t),this._panOffset.add(L)}_panUp(t,n){this.screenSpacePanning===!0?L.setFromMatrixColumn(n,1):(L.setFromMatrixColumn(n,0),L.crossVectors(this.object.up,L)),L.multiplyScalar(t),this._panOffset.add(L)}_pan(t,n){const s=this.domElement;if(this.object.isPerspectiveCamera){const i=this.object.position;L.copy(i).sub(this.target);let o=L.length();o*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*t*o/s.clientHeight,this.object.matrix),this._panUp(2*n*o/s.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(t*(this.object.right-this.object.left)/this.object.zoom/s.clientWidth,this.object.matrix),this._panUp(n*(this.object.top-this.object.bottom)/this.object.zoom/s.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(t,n){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const s=this.domElement.getBoundingClientRect(),i=t-s.left,o=n-s.top,a=s.width,u=s.height;this._mouse.x=i/a*2-1,this._mouse.y=-(o/u)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(t){return Math.max(this.minDistance,Math.min(this.maxDistance,t))}_handleMouseDownRotate(t){this._rotateStart.set(t.clientX,t.clientY)}_handleMouseDownDolly(t){this._updateZoomParameters(t.clientX,t.clientX),this._dollyStart.set(t.clientX,t.clientY)}_handleMouseDownPan(t){this._panStart.set(t.clientX,t.clientY)}_handleMouseMoveRotate(t){this._rotateEnd.set(t.clientX,t.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const n=this.domElement;this._rotateLeft(A*this._rotateDelta.x/n.clientHeight),this._rotateUp(A*this._rotateDelta.y/n.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(t){this._dollyEnd.set(t.clientX,t.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(t){this._panEnd.set(t.clientX,t.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(t){this._updateZoomParameters(t.clientX,t.clientY),t.deltaY<0?this._dollyIn(this._getZoomScale(t.deltaY)):t.deltaY>0&&this._dollyOut(this._getZoomScale(t.deltaY)),this.update()}_handleKeyDown(t){let n=!1;switch(t.code){case this.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(A*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),n=!0;break;case this.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(-A*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),n=!0;break;case this.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(A*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),n=!0;break;case this.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(-A*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),n=!0;break}n&&(t.preventDefault(),this.update())}_handleTouchStartRotate(t){if(this._pointers.length===1)this._rotateStart.set(t.pageX,t.pageY);else{const n=this._getSecondPointerPosition(t),s=.5*(t.pageX+n.x),i=.5*(t.pageY+n.y);this._rotateStart.set(s,i)}}_handleTouchStartPan(t){if(this._pointers.length===1)this._panStart.set(t.pageX,t.pageY);else{const n=this._getSecondPointerPosition(t),s=.5*(t.pageX+n.x),i=.5*(t.pageY+n.y);this._panStart.set(s,i)}}_handleTouchStartDolly(t){const n=this._getSecondPointerPosition(t),s=t.pageX-n.x,i=t.pageY-n.y,o=Math.sqrt(s*s+i*i);this._dollyStart.set(0,o)}_handleTouchStartDollyPan(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enablePan&&this._handleTouchStartPan(t)}_handleTouchStartDollyRotate(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enableRotate&&this._handleTouchStartRotate(t)}_handleTouchMoveRotate(t){if(this._pointers.length==1)this._rotateEnd.set(t.pageX,t.pageY);else{const s=this._getSecondPointerPosition(t),i=.5*(t.pageX+s.x),o=.5*(t.pageY+s.y);this._rotateEnd.set(i,o)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const n=this.domElement;this._rotateLeft(A*this._rotateDelta.x/n.clientHeight),this._rotateUp(A*this._rotateDelta.y/n.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(t){if(this._pointers.length===1)this._panEnd.set(t.pageX,t.pageY);else{const n=this._getSecondPointerPosition(t),s=.5*(t.pageX+n.x),i=.5*(t.pageY+n.y);this._panEnd.set(s,i)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(t){const n=this._getSecondPointerPosition(t),s=t.pageX-n.x,i=t.pageY-n.y,o=Math.sqrt(s*s+i*i);this._dollyEnd.set(0,o),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const a=(t.pageX+n.x)*.5,u=(t.pageY+n.y)*.5;this._updateZoomParameters(a,u)}_handleTouchMoveDollyPan(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enablePan&&this._handleTouchMovePan(t)}_handleTouchMoveDollyRotate(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enableRotate&&this._handleTouchMoveRotate(t)}_addPointer(t){this._pointers.push(t.pointerId)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let n=0;n<this._pointers.length;n++)if(this._pointers[n]==t.pointerId){this._pointers.splice(n,1);return}}_isTrackingPointer(t){for(let n=0;n<this._pointers.length;n++)if(this._pointers[n]==t.pointerId)return!0;return!1}_trackPointer(t){let n=this._pointerPositions[t.pointerId];n===void 0&&(n=new R,this._pointerPositions[t.pointerId]=n),n.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const n=t.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[n]}_customWheelEvent(t){const n=t.deltaMode,s={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(n){case 1:s.deltaY*=16;break;case 2:s.deltaY*=100;break}return t.ctrlKey&&!this._controlActive&&(s.deltaY*=10),s}}function Ds(e){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(e)&&(this._addPointer(e),e.pointerType==="touch"?this._onTouchStart(e):this._onMouseDown(e)))}function Is(e){this.enabled!==!1&&(e.pointerType==="touch"?this._onTouchMove(e):this._onMouseMove(e))}function js(e){switch(this._removePointer(e),this._pointers.length){case 0:this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(Se),this.state=P.NONE;break;case 1:const t=this._pointers[0],n=this._pointerPositions[t];this._onTouchStart({pointerId:t,pageX:n.x,pageY:n.y});break}}function Us(e){let t;switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case Y.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(e),this.state=P.DOLLY;break;case Y.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(e),this.state=P.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(e),this.state=P.ROTATE}break;case Y.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(e),this.state=P.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(e),this.state=P.PAN}break;default:this.state=P.NONE}this.state!==P.NONE&&this.dispatchEvent(xt)}function Hs(e){switch(this.state){case P.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(e);break;case P.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(e);break;case P.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(e);break}}function Fs(e){this.enabled===!1||this.enableZoom===!1||this.state!==P.NONE||(e.preventDefault(),this.dispatchEvent(xt),this._handleMouseWheel(this._customWheelEvent(e)),this.dispatchEvent(Se))}function ks(e){this.enabled!==!1&&this._handleKeyDown(e)}function zs(e){switch(this._trackPointer(e),this._pointers.length){case 1:switch(this.touches.ONE){case W.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(e),this.state=P.TOUCH_ROTATE;break;case W.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(e),this.state=P.TOUCH_PAN;break;default:this.state=P.NONE}break;case 2:switch(this.touches.TWO){case W.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(e),this.state=P.TOUCH_DOLLY_PAN;break;case W.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(e),this.state=P.TOUCH_DOLLY_ROTATE;break;default:this.state=P.NONE}break;default:this.state=P.NONE}this.state!==P.NONE&&this.dispatchEvent(xt)}function Ws(e){switch(this._trackPointer(e),this.state){case P.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(e),this.update();break;case P.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(e),this.update();break;case P.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(e),this.update();break;case P.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(e),this.update();break;default:this.state=P.NONE}}function Ys(e){this.enabled!==!1&&e.preventDefault()}function Bs(e){e.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Gs(e){e.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Ks(e=me,t=J){const n=window.innerWidth/window.innerHeight,s=new Ln(An,n,Rn,Cn);return s.position.copy(e),s.lookAt(t),s}function Zs(e,t,n=Mn,s=Tn){const i=new ws(t,e.domElement);return i.minDistance=n,i.maxDistance=s,i}class Xs extends Nn{constructor(n,s=1,i="black",o=.2,a="disk"){let u;a==="disk"?u=new On(1,128):u=new vn(1,1);const r=new xn({color:i,opacity:o,transparent:!0,depthWrite:!1,toneMapped:!1,side:wn});super(u,r);N(this,"plane");N(this,"size");this.type="PlaneHelper",this.plane=n,this.size=s}setSize(n){this.size=n,this.updateMatrixWorld()}setColor(n){this.material.color=n}setOpacity(n){this.material.opacity=n}updateMatrixWorld(n){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(n)}dispose(){this.geometry.dispose(),this.material.dispose()}}function Vs({scene:e,normal:t=Dn,constant:n=0,size:s=1,colorTheme:i,color:o,opacity:a=Un}){const u=o||(i==="light"?In:jn),r=new _e(t,n),c=new Xs(r,s,u,a);return c.addEventListener("removed",function(){c.dispose()}),e.add(c),c}function qs(e){const t=e==="light"?kn:zn,n=new Hn;return n.background=new Fn(t),n}function $s(e){const t=new Rt;return e.add(t),t.renderOrder=1/0,t}function Qs(e){const t=new Rt;return e.add(t),t}function Js(e,t,n,s){const{width:i,height:o}=e.getBoundingClientRect();s.aspect=i/o,s.updateProjectionMatrix(),t.setSize(i,o),n.setSize(i,o)}function ti(e,t,n,s,i,o,a,u,r,c){if(n.last){let S=c==="light"?it:ot;n.last===s.last&&(S=c==="light"?Nt:Ot),n.last.material.color.set(S),n.last=null}const{top:l,left:d,width:m,height:E}=t.getBoundingClientRect(),y=e.clientX-d,p=e.clientY-l;r.style.transform=`translate( ${y}px, ${p}px )`,i.x=y/m*2-1,i.y=(p/E*2-1)*-1,o.setFromCamera(i,a);const f=o.intersectObject(u,!0);if(f.length>0){const S=f.filter(function(g){return g&&g.object})[0];if(S&&S.object){n.last=S.object;const g=c==="light"?Bn:Gn;n.last.material.color.set(g)}}}function ei(e,t,n,s,i,o,a,u,r,c,l){if(s.last){const g=c==="light"?it:ot;s.last.material.color.set(g),s.last=null}const{top:d,left:m,width:E,height:y}=t.getBoundingClientRect(),p=e.clientX-m,f=e.clientY-d;r.style.transform=`translate( ${p}px, ${f}px )`,i.x=p/E*2-1,i.y=(f/y*2-1)*-1,o.setFromCamera(i,a);const S=o.intersectObject(u,!0);if(S.length>0){const g=S.filter(function(b){return b&&b.object})[0];if(g&&g.object){s.last=g.object;const b=c==="light"?Nt:Ot;s.last.material.color.set(b),l(g.object.userData.item)}}}function ni(e,t,n,s,i,o){e.render(s,i),t.render(s,i);const a=si(o);n.innerText=`zoom: ${a.toFixed(3)}x`}function si(e){return e.target.distanceTo(e.object.position)}function ii({canvasElement:e,mapZoomLevelLabel:t,overlayElement:n,pointerDotElement:s,colorTheme:i,onSelectItem:o}){const a={last:null},u={last:null},{renderer:r,overlayRenderer:c}=oi(e,n),l=qs(i),d=$s(l),m=Qs(l),E=Ks(),y=Zs(r,E),p=Vs({scene:l,colorTheme:i});function f(){ni(r,c,t,l,E,y)}const S=new Wn,g=new R;function b(){Js(e,r,c,E)}function T(K){ti(K,e,a,u,g,S,E,d,s,i),f()}function H(K){ei(K,e,a,u,g,S,E,d,s,i,o),f()}window.addEventListener("resize",b),e.addEventListener("pointermove",T),e.addEventListener("click",H),y.addEventListener("change",f),b();function at(){r.setAnimationLoop(null),window.removeEventListener("resize",b),e.removeEventListener("pointermove",T),e.removeEventListener("click",H),y.removeEventListener("change",f),y.dispose(),r.dispose()}return{renderer:r,overlayRenderer:c,scene:l,spritesGroup:d,spritesProjectionLinesGroup:m,planeHelper:p,camera:E,cameraControls:y,renderFrame:f,destroyMapRenderer:at}}function oi(e,t){const n=ri(e),s=ai(t);return{renderer:n,overlayRenderer:s}}function ai(e){const t=new vs({element:e,isUsingZOrder:!1});return t.setSize(window.innerWidth,window.innerHeight),t}function ri(e){const t=new Yn({antialias:!0,canvas:e});return t.setPixelRatio(window.devicePixelRatio),t.setSize(window.innerWidth,window.innerHeight),t}function li({mode:e,items:t,onSelectItem:n,selectedItemUuid:s}){const[i]=qn("prefered-color-scheme",void 0),o=_.useRef(null),a=_.useRef(null),u=_.useRef(null),r=_.useRef(null),c=_.useRef(null),l=_.useRef(null),d=_.useRef(null),m=_.useRef(null),[E,y]=_.useState(!1),p=_.useRef(null),f=_.useRef(null),S=_.useRef(null),g=_.useRef(null),[b,T]=_.useState(void 0),H=_.useCallback(function(){typeof b=="function"&&window.setTimeout(function(){typeof b=="function"&&b()},Kn)},[b]);_.useEffect(function(){const rt=p.current;if(!rt){console.error("Error. Map canvas as html element does not exist");return}const It=S.current;if(!It){console.error("Error. Map overlay as html element does not exist");return}const jt=g.current;if(!jt){console.error("Error. Map zoom level label as html element does not exist");return}const Ut=f.current;if(!Ut){console.error("Error. Map pointer dot as html element does not exist");return}const{renderer:Ae,overlayRenderer:Re,scene:Ce,spritesGroup:Ne,spritesProjectionLinesGroup:Oe,planeHelper:ve,camera:xe,cameraControls:we,renderFrame:Ht,destroyMapRenderer:De}=ii({canvasElement:rt,overlayElement:It,mapZoomLevelLabel:jt,pointerDotElement:Ut,colorTheme:i,onSelectItem:n});return o.current=Ae,a.current=Re,u.current=Ce,r.current=Ne,c.current=Oe,l.current=ve,m.current=xe,d.current=we,T(()=>Ht),Ht(),function(){o.current=null,a.current=null,u.current=null,r.current=null,d.current=null,l.current=null,m.current=null,d.current=null,T(void 0),De()}},[o,a,p,S,g,f,r,c,l,m,d,T,i,n]);const at=Os({cameraControlsRef:d,cameraRef:m,spritesGroupRef:r});return Rs({spritesGroupRef:r,spritesProjectionLinesGroupRef:c,sceneRef:u,planeHelperRef:l,mapOverlayContainerRef:S,items:t,colorTheme:i,mode:e,setNoDataToDisplay:y,resetCamera:at,renderFrame:H}),Ns({selectedItemUuid:s,spritesGroupRef:r,items:t,colorTheme:i,mode:e,renderFrame:H}),{noDataToDisplay:E,mapCanvasRef:p,mapOverlayContainerRef:S,mapZoomLevelLabelRef:g,pointerDotRef:f,renderFrame:H}}const ci="_MapStatusLabel_h103l_1",hi="_CanvasContainer_h103l_13",ui="_PointerDot_h103l_28",q={MapStatusLabel:ci,CanvasContainer:hi,PointerDot:ui},di="_MapDynamicOverlayContainer_1rg5l_1",mi={MapDynamicOverlayContainer:di},pi="_SpriteLabelAnchor_190g4_1",_i="_SpriteLabel_190g4_1",fi="_GroupItemId_190g4_23",yi="_GroupItemName_190g4_27",j={SpriteLabelAnchor:pi,SpriteLabel:_i,GroupItemId:fi,GroupItemName:yi},gi=_.memo(function({item:t}){const n=_.useMemo(function(){let u=[];return w(t)?u=[j.LocationLabel]:D(t)?u=[j.MovingEntityLabel]:U(t)&&(u=[j.PlanetarySystemLabel]),ne([j.SpriteLabelAnchor].concat(u))},[t]);if(!t||!Ct(t.position))return;let i;const o=t.name||"unknown name";return w(t)||D(t)?i=t.id:U(t),h.jsx("div",{"data-item-uuid":t.uuid,className:n,children:h.jsxs("div",{className:j.SpriteLabel,children:[i&&h.jsx("div",{className:j.GroupItemId,children:i}),h.jsx("div",{className:j.GroupItemName,children:o})]})})}),Si=_.memo(function({items:t}){return h.jsx(h.Fragment,{children:t.map(n=>h.jsx(gi,{item:n},n.uuid))})}),Ei=_.memo(function({items:t,ref:n}){return h.jsx("div",{ref:n,className:mi.MapDynamicOverlayContainer,children:h.jsx(Si,{items:t})})}),bi="_MapStaticOverlayContainer_1k91g_1",Pi="_PlanetarySystemNameLabelContainer_1k91g_13",Mi="_PlanetarySystemNameLabel_1k91g_13",Ti="_PlanetarySystemNameSubLabel_1k91g_43",Li="_MapZoomLevelLabel_1k91g_47",X={MapStaticOverlayContainer:bi,PlanetarySystemNameLabelContainer:Pi,PlanetarySystemNameLabel:Mi,PlanetarySystemNameSubLabel:Ti,MapZoomLevelLabel:Li},Ai=_.memo(function({selectedPlanetarySystemUuid:t,mapZoomLevelLabelRef:n,mapMode:s}){const i=_.useMemo(function(){var a;if(s!==C)return t&&((a=Q(t))==null?void 0:a.name)},[t,s]);return h.jsxs("div",{className:X.MapStaticOverlayContainer,children:[i&&h.jsxs("div",{className:X.PlanetarySystemNameLabelContainer,children:[h.jsx("div",{className:X.PlanetarySystemNameLabel,children:i}),h.jsx("div",{className:X.PlanetarySystemNameSubLabel,children:"planetary system"})]}),h.jsx("div",{ref:n,className:X.MapZoomLevelLabel})]})}),Ri=_.memo(function({isLoading:t=!1,items:n=[],mapMode:s,selectedPlanetarySystemUuid:i,onSelectItem:o,selectedItemUuid:a}){const{mapCanvasRef:u,mapOverlayContainerRef:r,mapZoomLevelLabelRef:c,pointerDotRef:l,noDataToDisplay:d,renderFrame:m}=li({mode:s,items:n,onSelectItem:o,selectedItemUuid:a});return ps(u,m),h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:q.CanvasContainer,children:[h.jsx("canvas",{ref:u}),h.jsx(Ei,{ref:r,items:n}),h.jsx(Ai,{mapZoomLevelLabelRef:c,selectedPlanetarySystemUuid:i,mapMode:s}),h.jsx("div",{ref:l,className:q.PointerDot})]}),t&&h.jsx("div",{className:q.MapStatusLabel,children:"data loading..."}),!t&&d&&h.jsx("div",{className:q.MapStatusLabel,children:"no data available"})]})}),Et="Map";function Ci({movingEntityName:e,locationName:t}){const n=[e,!!t&&(e?`in ${t}`:`${t}`)].filter(s=>!!s);return n.length?`${n.join(" ")} - ${Et}`:`${Et}`}const Ni="_Container_lebq8_1",Oi="_MapContainer_lebq8_9",vi="_SearchResults_lebq8_18",xi="_SearchResultName_lebq8_28",tt={Container:Ni,MapContainer:Oi,SearchResults:vi,SearchResultName:xi};function te(e){let t;if(U(e))t=e;else if(w(e))t=!!e.planetarySystemUuid&&Q(e.planetarySystemUuid)||void 0;else if(D(e)){const n=!!e.locationUuid&&ie(e.locationUuid)||void 0;n?t=!!(n!=null&&n.planetarySystemUuid)&&Q(n.planetarySystemUuid)||void 0:t=!!e.locationUuid&&Q(e.locationUuid)||void 0}return t}function wi(){return[{name:"name",asLinkToSelectItem:!0,alignLabel:"left",formatValue:function({item:t}){const s=B([v,G,x])?void 0:te(t),i=w(t)||D(t)?vt([t.id,t.name,s==null?void 0:s.name]):t.name;return h.jsx(h.Fragment,{children:typeof i=="string"?h.jsxs("div",{className:tt.SearchResultName,children:[D(t)&&h.jsxs(h.Fragment,{children:[h.jsx(Z,{})," "]}),w(t)&&h.jsxs(h.Fragment,{children:[h.jsx(Z,{})," "]}),U(t)&&h.jsxs(h.Fragment,{children:[h.jsx(Qn,{})," "]}),i]}):h.jsx(Ye,{children:"(no data)"})})},actionButtons:function({item:t}){const n=B([v,G,x]),s=n?void 0:te(t),i=D(t)&&(n||!Ft(t.uuid))?void 0:Qe(t.uuid),o=Jn({movingEntityName:(i==null?void 0:i.id)||(i==null?void 0:i.name)}),a=w(t)&&(n||!Ft(t.uuid))?void 0:ie(t.uuid),u=a&&Yt({locationName:(a==null?void 0:a.id)||(a==null?void 0:a.name),planetarySystemName:s==null?void 0:s.name}),r=s&&Yt({planetarySystemName:s==null?void 0:s.name}),c=Ct(t.position),l=i&&c&&ht({planetarySystemName:s==null?void 0:s.name,movingEntityId:i.id,movingEntityName:i.name}),d=a&&c&&ht({planetarySystemName:s==null?void 0:s.name,locationId:a.id,locationName:a.name}),m=s&&c&&ht({planetarySystemName:s==null?void 0:s.name,mapMode:C});return h.jsxs(h.Fragment,{children:[D(t)&&h.jsxs(h.Fragment,{children:[l?h.jsx(k,{href:l,title:"show moving object on map",children:h.jsx(Z,{})}):h.jsx(F,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no position data",children:h.jsx(dt,{})}),o?h.jsx(k,{href:o,title:"show moving object info",children:h.jsx(ut,{})}):h.jsx(F,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no moving object data",children:h.jsx(lt,{})})]}),w(t)&&h.jsxs(h.Fragment,{children:[d?h.jsx(k,{href:d,title:"show location on map",children:h.jsx(Z,{})}):h.jsx(F,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no position data",children:h.jsx(dt,{})}),u?h.jsx(k,{href:u,title:"show location info",children:h.jsx(ut,{})}):h.jsx(F,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no location data",children:h.jsx(lt,{})})]}),U(t)&&h.jsxs(h.Fragment,{children:[m?h.jsx(k,{href:m,title:"show planetary system on map",children:h.jsx(Z,{})}):h.jsx(F,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no position data",children:h.jsx(dt,{})}),r?h.jsx(k,{href:r,title:"show planetary system info",children:h.jsx(ut,{})}):h.jsx(F,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no planetary system data",children:h.jsx(lt,{})})]})]})}}]}function Di(e,t){const s=B([v,G,x]),i=_.useMemo(function(){return t===C?[]:e?oe(e):[]},[e,s,t]),o=_.useMemo(function(){return t===C?[]:e?ae(e):[]},[e,s,t]),a=_.useMemo(function(){return t===C?yt():[]},[s,t]);return _.useMemo(function(){return t===C?a:new Array().concat(i,o)},[a,i,o,s,t])}function ee(e,t){return e.name.localeCompare(t.name)}function $(e,t){return e.id&&t.id?e.id.localeCompare(t.id):e.name.localeCompare(t.name)}function Ii({searchFieldValue:e,selectedPlanetarySystemUuid:t,mapMode:n}){const i=B([v,G,x]),o=_.useMemo(function(){return e?yt().filter(d=>d.name.includes(e)).sort(ee):n===C?yt().sort(ee):[]},[e,i,n]),a=_.useMemo(function(){if(!e)return n===C?[]:t?oe(t).sort($):[];const l=e.toLocaleUpperCase();return Je().filter(m=>m.id&&m.id.includes(l)?!0:m.name.includes(e)).sort($)},[e,t,i,n]),u=_.useMemo(function(){if(!e)return n===C?[]:t?ae(t).sort($):[];const l=e.toLocaleUpperCase();return tn().filter(m=>m.id&&m.id.includes(l)||m.originalId&&m.originalId.includes(l)?!0:m.name.includes(e)).sort($)},[e,t,i,n]);return _.useMemo(function(){return new Array().concat(o,a,u)},[o,a,u])}const ji=[bt,Pt,Mt,Tt,Lt,At];function st(e){const t=e.get(At)||void 0,n=Zn(t)?t:void 0,s={movingEntityId:e.get(bt)||void 0,movingEntityName:e.get(Pt)||void 0,locationId:e.get(Mt)||void 0,locationName:e.get(Tt)||void 0,planetarySystemName:e.get(Lt)||void 0,mapMode:n};return Be(s)}function Ui({filterValue:e}){var E;if(!e)return;const{movingEntityId:t,movingEntityName:n,locationId:s,locationName:i,planetarySystemName:o,mapMode:a,...u}=e,r=en({id:t,name:n,planetarySystemName:o}),c=r==null?void 0:r.uuid,l=nn({id:s,name:i,planetarySystemName:o}),d=l==null?void 0:l.uuid,m=l!=null&&l.planetarySystemUuid?l==null?void 0:l.planetarySystemUuid:!!o&&((E=sn(o))==null?void 0:E.uuid)||void 0;return{...u,movingEntityUuid:c,locationUuid:d,planetarySystemUuid:m,mapMode:a}}function Hi({urlSearchParams:e,setUrlSearchParams:t}){const s=B([x,G,v]),i=_.useRef(void 0),o=_.useMemo(function(){const r=st(e),c=Ui({filterValue:r}),l=i.current;return kt(l,c)?(i.current=c,c):l},[e,i,s]),a=_.useCallback(function(r){let c;if(typeof r=="function")throw new Error("MapFilterValue as setState(prev=>newState) function not supported");r&&Object.keys(r).length>0&&(c=r),t(l=>{const d=st(l);if(kt(d,c)){if(!c)return ji.forEach(S=>{l.delete(S)}),l;const E=c.movingEntityUuid,y=c.locationUuid,p=c.planetarySystemUuid,f=c.mapMode;$n({urlSearchParams:l,movingEntityUuid:E,locationUuid:y,planetarySystemUuid:p,mapMode:f,movingEntityIdUrlSearchParamsKeyName:bt,movingEntityNameUrlSearchParamsKeyName:Pt,locationIdUrlSearchParamsKeyName:Mt,locationNameUrlSearchParamsKeyName:Tt,planetarySystemNameUrlSearchParamsKeyName:Lt,mapModeUrlSearchParamsKeyName:At})}return l})},[t]);return{mapFilterValue:o,setMapFilterValueToUrlSearchParams:a}}const Ee=Ge();function wt(){const{isHydrating:e,isHydrated:t}=x.getState(),{isHydrating:n,isHydrated:s}=v.getState();if(e||!t||n||!s)return;const i=re(),o=le(),a=ce();Fi({movingEntitiesMap:i,locationsMap:o,planetarySystemsMap:a})}Ee.setState({prepareData:wt});x.subscribe(function(){wt()});v.subscribe(function(){wt()});function Fi({movingEntitiesMap:e,locationsMap:t,planetarySystemsMap:n}){const s=Ee.getState();s.isProcessing||(s.setIsProcessing(!0),window.setTimeout(function(){const a=zi({movingEntitiesMap:e,locationsMap:t,planetarySystemsMap:n});s.replaceAll(a),s.setIsProcessing(!1)},0))}function be(e,t=!1,n){const s=(e==null?void 0:e.id)??"",i=(e==null?void 0:e.name)??"(movingEntity without name)",o=n??vt([s,i]),a=t?Ke(i,"name"):o;return{movingEntityNameWithId:o,movingEntityNameWithIdAsLabel:a}}function ki({movingEntitiesMap:e,locationsMap:t,planetarySystemsMap:n,shouldAddSuffixLabel:s=!1}){const i=[],o=et(n),a=et(e);return o.forEach(function(r){const c=r?r.uuid:void 0,{planetarySystemName:l,planetarySystemNameAsLabel:d}=nt(r,s);i.push({uuid:c,name:l,label:d,items:[]})}),a.forEach(function(r){const c=t.get(r.locationUuid),l=c==null?void 0:c.planetarySystemUuid,d=l?n.get(l):void 0,m=d==null?void 0:d.uuid,{planetarySystemName:E,planetarySystemNameAsLabel:y}=nt(d,s),p=r.uuid,{movingEntityNameWithId:f,movingEntityNameWithIdAsLabel:S}=be(r,s),g=i.find(b=>b.uuid===m);g?(g.items||(g.items=[]),g.items.find(T=>T.uuid===p)||g.items.push({uuid:p,name:f,label:S})):i.push({uuid:m,name:E,label:y,items:[{uuid:p,name:f,label:S}]})}),i}function Pe(e){e.sort((t,n)=>t.name.localeCompare(n.name)),e.forEach(({items:t})=>Pe(t??[]))}function Me({items:e=[],level:t=0,disableOptionsWithoutUuid:n=!0,selectOptions:s=new Array}){return e.forEach(i=>{const{label:o,items:a}=i,u=i.uuid,r=u??"";s.push({value:r,label:o,level:t,disabled:n?!u:!1}),a!=null&&a.length&&Me({items:a,level:t+1,disableOptionsWithoutUuid:n,selectOptions:s})}),s}function zi({movingEntitiesMap:e,locationsMap:t,planetarySystemsMap:n,disableOptionsWithoutUuid:s}){const i=ki({movingEntitiesMap:e,locationsMap:t,planetarySystemsMap:n,shouldAddSuffixLabel:!1});return Pe(i),Me({items:i,disableOptionsWithoutUuid:s})??[]}const Te=Xn();function Dt(){const{isHydrating:e,isHydrated:t}=x.getState(),{isHydrating:n,isHydrated:s}=v.getState();if(e||!t||n||!s)return;const i=re(),o=le(),a=ce();Wi({movingEntitiesMap:i,locationsMap:o,planetarySystemsMap:a})}Te.setState({prepareData:Dt});x.subscribe(function(){Dt()});v.subscribe(function(){Dt()});function Wi({movingEntitiesMap:e,locationsMap:t,planetarySystemsMap:n}){const s=Te.getState();s.isProcessing||(s.setIsProcessing(!0),window.setTimeout(function(){const a=Yi({movingEntitiesMap:e,locationsMap:t,planetarySystemsMap:n});s.replaceAll(a),s.setIsProcessing(!1)},0))}function Yi({movingEntitiesMap:e,locationsMap:t,planetarySystemsMap:n}){return Gi({movingEntitiesMap:e,locationsMap:t,planetarySystemsMap:n,shouldAddSuffixLabel:!1})}function Le({id:e,name:t,reverseOrder:n=!1,namePartSeparator:s=fe}){let o=[vt([e,t],!1," ")].filter(a=>!!a);return n&&(o=o.reverse()),o.join(s)}function Bi({movingEntity:e,locationsMap:t,planetarySystemsMap:n,isUsingNoDataTextForEmptyParts:s={},reverseOrder:i=!1,namePartSeparator:o=fe}){const a=s.id?"(no-id)":"",u=e.locationUuid,r=u?t.get(u):void 0,c=r==null?void 0:r.planetarySystemUuid,l=c?n.get(c):void 0,d=s.planetarySystem?"(no planetary system data)":"";return Le({id:e.id??a,name:e.name,planetarySystemName:(l==null?void 0:l.name)??d,reverseOrder:i,namePartSeparator:o})}function Gi({movingEntitiesMap:e,locationsMap:t,planetarySystemsMap:n,shouldAddSuffixLabel:s=!1}){const i=new Map,o=et(n),a=et(e);return o.forEach(function(r){const c=r.uuid,{planetarySystemName:l}=nt(r,s);i.set(c,l)}),a.forEach(function(r){const c=r==null?void 0:r.locationUuid,l=t.get(c),d=l==null?void 0:l.planetarySystemUuid,m=d?n.get(d):void 0,E=m?m.uuid:void 0,{planetarySystemName:y}=nt(m,s),p=r.uuid,f=l?Bi({movingEntity:r,locationsMap:t,planetarySystemsMap:n,isUsingNoDataTextForEmptyParts:{planetarySystem:!0}}):void 0,{movingEntityNameWithId:S}=be(r,s,f);!(E?i.get(E):void 0)&&E&&i.set(E,y),i.set(p,S)}),i}function Ki(e){const t=_.useMemo(function(){const o=st(e);return Vn({id:o==null?void 0:o.locationId,name:o==null?void 0:o.locationName,planetarySystemName:o==null?void 0:o.planetarySystemName})},[e]),n=_.useMemo(function(){const o=st(e);return Le({id:o==null?void 0:o.movingEntityId,name:o==null?void 0:o.movingEntityName,planetarySystemName:o==null?void 0:o.planetarySystemName})},[e]),s=_.useMemo(function(){return ye(Ci({movingEntityName:n,locationName:t}))},[n,t]);Ze(s)}function Zi({urlSearchParams:e,setUrlSearchParams:t}){return Xe({urlSearchParams:e,setUrlSearchParams:t,getSearchValueFromUrlSearchParams:Ve,searchValueKeyInUrlSearchParams:zt,searchFieldNameInSearchForm:zt,searchFieldPlaceholderTextInSearchForm:"Search by name or id..."})}const Xi=ye(Et),Vi=_.memo(function(){const{urlSearchParams:t,setUrlSearchParams:n}=qe(),{mapFilterValue:s,setMapFilterValueToUrlSearchParams:i}=Hi({urlSearchParams:t,setUrlSearchParams:n}),{SearchForm:o,searchFieldValue:a}=Zi({urlSearchParams:t,setUrlSearchParams:n});Ki(t);const r=B([v,G,on,x,an]),{movingEntityUuid:c,locationUuid:l,planetarySystemUuid:d,mapMode:m}=s||{},E=_.useMemo(function(){return wi()},[r]),y=_.useCallback(function(T){U(T)?i({planetarySystemUuid:T.uuid}):w(T)?i({locationUuid:T.uuid}):D(T)&&i({movingEntityUuid:T.uuid})},[i]),p=_.useMemo(function(){return c||l?I:d?m?C:I:C},[m,c,l,d]),f=Ii({searchFieldValue:a,selectedPlanetarySystemUuid:d,mapMode:p}),S=Di(d,p),g=_.useMemo(function(){return c||l||d},[d,l,c]);return h.jsxs(h.Fragment,{children:[h.jsx("title",{children:Xi}),h.jsxs("div",{className:tt.Container,children:[h.jsx("div",{className:tt.SearchResults,children:h.jsxs(He,{children:[o,h.jsx(ms,{tableTitle:"search results",items:f,noItemsLabel:"no results",isLoading:r,searchFieldValue:a,children:h.jsx(ds,{items:f,columns:E,onSelectItem:y,selectedItemUuid:g})})]})}),h.jsx("div",{className:tt.MapContainer,children:h.jsx(Ri,{isLoading:r,items:S,mapMode:p,selectedPlanetarySystemUuid:d,onSelectItem:y,selectedItemUuid:g})})]})]})}),mo=Ue(function(){return h.jsx(Vi,{})});export{mo as default};
