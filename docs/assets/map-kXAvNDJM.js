var De=Object.defineProperty;var Ie=(e,t,n)=>t in e?De(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var O=(e,t,n)=>Ie(e,typeof t!="symbol"?t+"":t,n);import{a as f,p as c,s as je}from"./chunk-NL6KNZEE-BTkWJe7M.js";import{S as Ue}from"./SearchFormAndTableContainer-DLdA1ywV.js";import{O as He,P as Fe,Q as ke,R as ze,i as Ht,S as F,b as lt,N as We,e as Ft,V as Et,I as bt,j as Pt,k as Mt,l as Tt,W as Lt,m as Ye,c as Be,a as Ge,u as Ke,X as Ze,Y as kt,p as Xe}from"./useTableSearch-s1XeIKRD.js";import{n as ne,ae as se,an as Ve,t as Q,o as B,J as x,z as G,ap as w,aA as qe,q as ie,B as k,aB as oe,aC as ae,aD as yt,aE as $e,aF as Qe,aG as Je,W as tn,X as en,aH as re,aI as le,aJ as ce,H as et,ab as nn,am as sn}from"./useLoadingPersistStorages-B7kmesKM.js";import{B as on,V as M,n as he,o as ue,S as an,q as rn,r as de,G as At,Q as gt,s as ln,t as cn,v as St,w as hn,T as un,x as dn,y as mn,z as D,A as H,p as Rt,C as pn,D as it,F as ot,H as ct,O as _n,I as C,J as j,M as N,K as fn,N as Ct,R as Nt,U as me,W as J,X as yn,Y as pe,Z as gn,_ as Y,$ as W,a0 as zt,a1 as Sn,a2 as _e,a3 as En,a4 as bn,a5 as Pn,a6 as Mn,a7 as Tn,a8 as Ln,a9 as An,aa as Rn,ab as Cn,ac as Nn,ad as On,ae as vn,af as xn,ag as wn,ah as Dn,ai as In,aj as jn,ak as Un,al as Hn,am as Fn,an as kn,ao as zn,ap as Wn,aq as Yn,ar as Bn,b as Wt,d as ht,L as Z,c as Ot,as as Gn,at as nt,au as Kn,av as fe,e as Zn}from"./getUrlToMapPageWithParams-DE0Va9HU.js";import{i as I}from"./MovingEntity-CB3NXLs0.js";import{u as Xn}from"./useLocalStorage-C3FLdLLg.js";import{I as ut,s as Vn}from"./setMovingEntityOrLocationOrPlanetarySystemToUrlSearchParams-xwx_dBpR.js";import{N as dt,P as qn}from"./PlanetOrbitIcon-BZk0WnUT.js";import{g as $n}from"./getUrlToMovingEntitiesPageWithParams-esRg1Rw_.js";import{c as Qn}from"./createPageTitleString-BzKRSWbw.js";import"./App.const-DNoFr9tQ.js";const Jn="_TableWrapper_1bwb0_1",ts="_TableContainer_1bwb0_10",es="_Table_1bwb0_1",ns="_TableHeaderContainer_1bwb0_23",ss="_TableHeaderLeftPart_1bwb0_37",is="_TableHeaderRightPart_1bwb0_45",os="_TableItemsQuantity_1bwb0_53",as="_TableTitle_1bwb0_59",rs="_TableTitleActonButtons_1bwb0_68",ls="_NoData_1bwb0_98",cs="_LoadingData_1bwb0_99",v={TableWrapper:Jn,TableContainer:ts,Table:es,TableHeaderContainer:ns,TableHeaderLeftPart:ss,TableHeaderRightPart:is,TableItemsQuantity:os,TableTitle:as,TableTitleActonButtons:rs,NoData:ls,LoadingData:cs},hs=f.memo(function({item:t,columns:n,onSelectItem:s,isHighlightRow:i}){return c.jsx(He,{isHighlightRow:i,isHighlightRowBlinking:!1,children:n.map((o,a)=>c.jsx(Fe,{item:t,column:o,columnIndex:a,onSelectItem:s},o.name))})}),us=f.memo(function({items:t,columns:n,onSelectItem:s=()=>{},selectedItemUuid:i}){const o=ke({items:t});return c.jsx(c.Fragment,{children:o.map(a=>c.jsx(hs,{item:a,columns:n,onSelectItem:s,isHighlightRow:i===a.uuid},a.uuid))})}),ds=f.memo(function({tableTitle:t="Table",items:n=[],noItemsLabel:s="no data",isLoading:i=!1,loadingLabel:o="loading data...",itemTypeName:a="item",itemTypeNamePlural:u="items",searchFieldValue:r,filterValue:h,children:l}){const d=f.useRef(null),{vertical:m}=ze(d,n),E=ne([v.TableContainer,m&&v.TableContainerWithVisibleScrollbar]);return c.jsxs("div",{className:v.TableWrapper,children:[c.jsxs("div",{className:v.TableHeaderContainer,children:[c.jsxs("div",{className:v.TableHeaderLeftPart,children:[c.jsx("h2",{className:v.TableTitle,children:t}),c.jsx("div",{className:v.TableTitleActonButtons})]}),c.jsx("div",{className:v.TableHeaderRightPart,children:c.jsxs("div",{className:v.TableItemsQuantity,children:[h||r?"found":"total"," ",n.length," ",n.length>1||n.length===0?u:a]})})]}),c.jsx("div",{ref:d,className:E,children:c.jsx("table",{className:v.Table,children:c.jsxs("tbody",{children:[i&&c.jsx("tr",{children:c.jsx("td",{colSpan:100,rowSpan:100,className:v.LoadingData,children:o})}),!i&&!n.length&&c.jsx("tr",{children:c.jsx("td",{colSpan:100,rowSpan:100,className:v.NoData,children:s})}),!i&&!!n.length&&l]})})})]})});function ms(e,t){const[n,s]=f.useState(0),[i,o]=f.useState(0),a=f.useCallback(function(h,l){s(h),o(l)},[s,o]),u=f.useCallback(function(){const h=e==null?void 0:e.current;if(!h)return;const l=h.clientWidth,d=h.clientHeight;!Number.isFinite(l)||!Number.isFinite(d)||l<1||d<1?a(0,0):a(l,d),typeof t=="function"&&t(l,d)},[e,a,t]);return f.useEffect(function(){const h=e==null?void 0:e.current;if(!h)return;const l=new ResizeObserver(u);return l.observe(h),function(){l.unobserve(h),l.disconnect()}},[e,u]),f.useEffect(function(){return document.addEventListener("load",u),function(){document.removeEventListener("load",u)}},[u]),{elementWidth:n,elementHeight:i}}function ye(e){const t=new on;return e.traverse(function(s){t.expandByPoint(s.position)}),t}function Yt(e=[new M,new M(1,1,1)],t){const n=new he().setFromPoints(e),s=t==="light"?an:rn,i=new ue({color:s,toneMapped:!1}),o=new de(n,i);return o.addEventListener("removed",function(){o.material.dispose(),o.geometry.dispose()}),o}function ps({position:e,parentQuaternion:t,group:n,size:s=1,colorTheme:i}){const o=new At,a=[new M(-.5,0,-.5),new M(.5,0,.5)],u=[new M(.5,0,-.5),new M(-.5,0,.5)],r=Yt(a,i),h=Yt(u,i);return o.add(r),o.add(h),o.position.copy(e),o.applyQuaternion(t),o.applyQuaternion(gt),o.scale.copy(new M(s,s,s)),o.addEventListener("removed",function(){o.clear()}),n.add(o),o}function _s(e,t,n,s){const i=new St;e.getWorldQuaternion(i),ps({group:t,parentQuaternion:i,position:n,size:hn,colorTheme:s})}function fs(e,t,n,s){const i=e.getWorldPosition(new M),o=new M;t.plane.projectPoint(i,o);const a=[i,o],u=new he().setFromPoints(a),r=s==="light"?ln:cn,h=new ue({color:r,toneMapped:!1}),l=new de(u,h);return _s(t,l,o,s),l.addEventListener("removed",function(){l.clear(),l.material.dispose(),l.geometry.dispose()}),n.add(l),l}const ys="/images/textures";function mt(e){return`${ys}/${e}.png`}let pt;function gs(){return pt||(pt=new un),pt}function _t({textureAsString:e,name:t,position:n,materialColor:s}){const i=gs().load(e),o=new dn({map:i,color:s,transparent:!0,depthTest:!1}),a=new mn(o);return a.name=t,a.position.copy(n),a.addEventListener("removed",function(){a.material.dispose(),a.geometry.dispose()}),a}const Ss=1/1e6,Es=1/1e6;function bs(e,t){var o,a;const n=Ms(e.position);if(!n)return;const s=t==="light"?it:ot;let i;if(D(e)){n.multiplyScalar(Ss),n.applyQuaternion(gt);const u=e.locationTypeUuid?(o=se(e.locationTypeUuid))==null?void 0:o.image:void 0;i=_t({name:e.uuid,textureAsString:u||mt(ct.structureUnknown),position:n,materialColor:s});const r=Ps(e,.25);i.scale.set(r,r,r)}else if(I(e)){n.multiplyScalar(Es),n.applyQuaternion(gt);const u=e.movingEntityClassUuid?(a=Ve(e.movingEntityClassUuid))==null?void 0:a.image:void 0;i=_t({name:e.uuid,textureAsString:u||mt(ct.shipUnknown),position:n,materialColor:s}),i.scale.set(.35,.35,.35)}else if(H(e))i=_t({name:e.uuid,textureAsString:mt(ct.circle),position:n,materialColor:s}),i.scale.set(.1,.1,.1);else return;return i.userData.item=e,i}function Ps(e,t=1){var i;const n=e.locationTypeUuid,s=n?(i=se(n))==null?void 0:i.name:void 0;return s&&pn[s]||t}function Ms(e){const t=Rt(e);if(!t)return;const n=new M;return n.fromArray(t),n}class Ts extends _n{constructor(n){super();O(this,"isCSS2DObjectForReactComponent");O(this,"isCSS2DObject");O(this,"element");O(this,"center");this.isCSS2DObjectForReactComponent=!0,this.isCSS2DObject=!0,this.element=n,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable","false"),this.center=new C(.5,.5)}copy(n,s){return super.copy(n,s),this.element=n.element,this.center=n.center,this}}function Bt(e){return e==null?void 0:e.isCSS2DObjectForReactComponent}function Ls(e,t){return t.querySelector(`[data-item-uuid="${e}"]`)||void 0}function Gt(e,t,n,s=!1){const i=Ls(e.uuid,n);if(!i)return;const o=new Ts(i);o.position.set(0,0,0),o.visible=s,t.add(o)}function As({spritesGroupRef:e,spritesProjectionLinesGroupRef:t,sceneRef:n,planeHelperRef:s,mapOverlayContainerRef:i,items:o,colorTheme:a,mode:u,setNoDataToDisplay:r,resetCamera:h,renderFrame:l}){f.useEffect(function(){const m=e.current;if(!m)return;const E=t.current;if(!E||!n.current)return;const p=s.current;if(!p)return;const _=i.current;if(!_)return;m.clear(),E.clear(),o.forEach(g=>{const b=bs(g,a);b&&(u===j&&fs(b,p,E,a),u===j?Gt(g,b,_,!1):Gt(g,b,_,!0),m.add(b))});const S=!m.children.length;if(S)p.visible=!1;else if(u===N)p.visible=!1;else if(u===j){p.visible=!0;const g=ye(m),L=Math.max.apply(void 0,new Array().concat(g.min.toArray(),g.max.toArray()).map(Math.abs))*(1+fn)*2;p.setSize(L)}r(S),h(u,S),l()},[o,n,e,t,s,i,r,l,h,u,a])}function Rs(e){return e==null?void 0:e.isSprite}function Cs({selectedItemUuid:e,spritesGroupRef:t,items:n,colorTheme:s,mode:i,renderFrame:o}){f.useEffect(function(){if(!n.length)return;const u=t.current;u&&(u.children.forEach(r=>{var h;if(Rs(r)){const l=r;if(((h=l.userData.item)==null?void 0:h.uuid)===e){const d=s==="light"?Ct:Nt;if(l.material.color.set(d),i===j){const m=l.children.find(E=>Bt(E));m&&(m.visible=!0)}}else{const d=s==="light"?it:ot;if(l.material.color.set(d),i===j){const m=l.children.find(E=>Bt(E));m&&(m.visible=!1)}}}}),o())},[n,t,o,e,s,i])}function Kt({group:e,camera:t,cameraPos:n,cameraTarget:s,defaultCameraPos:i,defaultCameraTarget:o,cameraControls:a}){(i||o)&&(i&&t.position.copy(i),o&&t.lookAt(o));const u=ye(e),r=Math.max.apply(void 0,new Array().concat(u.min.toArray(),u.max.toArray()).map(Math.abs)),h=s||new M,d=r*2/(2*Math.atan(Math.PI*t.fov/360)),m=d/t.aspect,E=Math.max(d,m),y=n||new M().copy(t.position),p=h.clone().sub(y).normalize().multiplyScalar(E),_=new M().copy(h).sub(p),S=new M().copy(h);t.position.copy(_),t.lookAt(S),a.update()}function Ns({spritesGroupRef:e,cameraControlsRef:t,cameraRef:n}){return f.useCallback(function(o,a){const u=n.current;if(!u)return;const r=t.current;if(!r)return;const h=e.current;h&&(r.reset(),!a&&(o===N?Kt({group:h,camera:u,cameraControls:r,defaultCameraPos:me,defaultCameraTarget:J}):o===j&&Kt({group:h,camera:u,cameraControls:r,cameraTarget:J,defaultCameraPos:yn,defaultCameraTarget:J})))},[n,t,e])}const z=new M,Zt=new pe,Xt=new pe,Vt=new M,qt=new M;class Os{constructor(t){O(this,"domElement");O(this,"isUsingZOrder");O(this,"getSize");O(this,"render");O(this,"setSize");const n=this;let s,i,o,a;const u={objects:new WeakMap},r=t.element;r.style.overflow="hidden",this.domElement=r,this.isUsingZOrder=!!t.isUsingZOrder,this.getSize=function(){return{width:s,height:i}},this.render=function(p,_){p.matrixWorldAutoUpdate===!0&&p.updateMatrixWorld(),_.parent===null&&_.matrixWorldAutoUpdate===!0&&_.updateMatrixWorld(),Zt.copy(_.matrixWorldInverse),Xt.multiplyMatrices(_.projectionMatrix,Zt),l(p,p,_,this.isUsingZOrder),this.isUsingZOrder&&E(p)},this.setSize=function(p,_){s=p,i=_,o=s/2,a=i/2,r.style.width=p+"px",r.style.height=_+"px"};function h(y){y.isCSS2DObject&&(y.element.style.display="none");for(let p=0,_=y.children.length;p<_;p++)h(y.children[p])}function l(y,p,_,S){if(y.visible===!1){h(y);return}if(y.isCSS2DObject){z.setFromMatrixPosition(y.matrixWorld),z.applyMatrix4(Xt);const g=z.z>=-1&&z.z<=1&&y.layers.test(_.layers)===!0,b=y.element;if(b.style.display=g===!0?"":"none",g===!0&&(y.onBeforeRender(n,p,_),b.style.transform="translate("+-100*y.center.x+"%,"+-100*y.center.y+"%)translate("+(z.x*o+o)+"px,"+(-z.y*a+a)+"px)",y.onAfterRender(n,p,_)),S){const L={distanceToCameraSquared:d(_,y)};u.objects.set(y,L)}}for(let g=0,b=y.children.length;g<b;g++)l(y.children[g],p,_,S)}function d(y,p){return Vt.setFromMatrixPosition(y.matrixWorld),qt.setFromMatrixPosition(p.matrixWorld),Vt.distanceToSquared(qt)}function m(y){const p=new Array;return y.traverseVisible(function(_){_.isCSS2DObject&&p.push(_)}),p}function E(y){const p=m(y).sort(function(S,g){if(S.renderOrder!==g.renderOrder)return g.renderOrder-S.renderOrder;const b=u.objects.get(S).distanceToCameraSquared,L=u.objects.get(g).distanceToCameraSquared;return b-L}),_=p.length;for(let S=0,g=p.length;S<g;S++)p[S].element.style.zIndex=`${_-S}`}}}const $t={type:"change"},vt={type:"start"},ge={type:"end"},V=new Sn,Qt=new _e,vs=Math.cos(70*En.DEG2RAD),T=new M,A=2*Math.PI,P={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},ft=1e-6;class xs extends gn{constructor(t,n=null){super(t,n),this.state=P.NONE,this.target=new M,this.cursor=new M,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Y.ROTATE,MIDDLE:Y.DOLLY,RIGHT:Y.PAN},this.touches={ONE:W.ROTATE,TWO:W.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new M,this._lastQuaternion=new St,this._lastTargetPosition=new M,this._quat=new St().setFromUnitVectors(t.up,new M(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new zt,this._sphericalDelta=new zt,this._scale=1,this._panOffset=new M,this._rotateStart=new C,this._rotateEnd=new C,this._rotateDelta=new C,this._panStart=new C,this._panEnd=new C,this._panDelta=new C,this._dollyStart=new C,this._dollyEnd=new C,this._dollyDelta=new C,this._dollyDirection=new M,this._mouse=new C,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Ds.bind(this),this._onPointerDown=ws.bind(this),this._onPointerUp=Is.bind(this),this._onContextMenu=Ws.bind(this),this._onMouseWheel=Hs.bind(this),this._onKeyDown=Fs.bind(this),this._onTouchStart=ks.bind(this),this._onTouchMove=zs.bind(this),this._onMouseDown=js.bind(this),this._onMouseMove=Us.bind(this),this._interceptControlDown=Ys.bind(this),this._interceptControlUp=Bs.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(t){super.connect(t),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(t){t.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=t}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent($t),this.update(),this.state=P.NONE}update(t=null){const n=this.object.position;T.copy(n).sub(this.target),T.applyQuaternion(this._quat),this._spherical.setFromVector3(T),this.autoRotate&&this.state===P.NONE&&this._rotateLeft(this._getAutoRotationAngle(t)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let s=this.minAzimuthAngle,i=this.maxAzimuthAngle;isFinite(s)&&isFinite(i)&&(s<-Math.PI?s+=A:s>Math.PI&&(s-=A),i<-Math.PI?i+=A:i>Math.PI&&(i-=A),s<=i?this._spherical.theta=Math.max(s,Math.min(i,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(s+i)/2?Math.max(s,this._spherical.theta):Math.min(i,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let o=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const a=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),o=a!=this._spherical.radius}if(T.setFromSpherical(this._spherical),T.applyQuaternion(this._quatInverse),n.copy(this.target).add(T),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let a=null;if(this.object.isPerspectiveCamera){const u=T.length();a=this._clampDistance(u*this._scale);const r=u-a;this.object.position.addScaledVector(this._dollyDirection,r),this.object.updateMatrixWorld(),o=!!r}else if(this.object.isOrthographicCamera){const u=new M(this._mouse.x,this._mouse.y,0);u.unproject(this.object);const r=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),o=r!==this.object.zoom;const h=new M(this._mouse.x,this._mouse.y,0);h.unproject(this.object),this.object.position.sub(h).add(u),this.object.updateMatrixWorld(),a=T.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;a!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(a).add(this.object.position):(V.origin.copy(this.object.position),V.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(V.direction))<vs?this.object.lookAt(this.target):(Qt.setFromNormalAndCoplanarPoint(this.object.up,this.target),V.intersectPlane(Qt,this.target))))}else if(this.object.isOrthographicCamera){const a=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),a!==this.object.zoom&&(this.object.updateProjectionMatrix(),o=!0)}return this._scale=1,this._performCursorZoom=!1,o||this._lastPosition.distanceToSquared(this.object.position)>ft||8*(1-this._lastQuaternion.dot(this.object.quaternion))>ft||this._lastTargetPosition.distanceToSquared(this.target)>ft?(this.dispatchEvent($t),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(t){return t!==null?A/60*this.autoRotateSpeed*t:A/60/60*this.autoRotateSpeed}_getZoomScale(t){const n=Math.abs(t*.01);return Math.pow(.95,this.zoomSpeed*n)}_rotateLeft(t){this._sphericalDelta.theta-=t}_rotateUp(t){this._sphericalDelta.phi-=t}_panLeft(t,n){T.setFromMatrixColumn(n,0),T.multiplyScalar(-t),this._panOffset.add(T)}_panUp(t,n){this.screenSpacePanning===!0?T.setFromMatrixColumn(n,1):(T.setFromMatrixColumn(n,0),T.crossVectors(this.object.up,T)),T.multiplyScalar(t),this._panOffset.add(T)}_pan(t,n){const s=this.domElement;if(this.object.isPerspectiveCamera){const i=this.object.position;T.copy(i).sub(this.target);let o=T.length();o*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*t*o/s.clientHeight,this.object.matrix),this._panUp(2*n*o/s.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(t*(this.object.right-this.object.left)/this.object.zoom/s.clientWidth,this.object.matrix),this._panUp(n*(this.object.top-this.object.bottom)/this.object.zoom/s.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(t,n){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const s=this.domElement.getBoundingClientRect(),i=t-s.left,o=n-s.top,a=s.width,u=s.height;this._mouse.x=i/a*2-1,this._mouse.y=-(o/u)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(t){return Math.max(this.minDistance,Math.min(this.maxDistance,t))}_handleMouseDownRotate(t){this._rotateStart.set(t.clientX,t.clientY)}_handleMouseDownDolly(t){this._updateZoomParameters(t.clientX,t.clientX),this._dollyStart.set(t.clientX,t.clientY)}_handleMouseDownPan(t){this._panStart.set(t.clientX,t.clientY)}_handleMouseMoveRotate(t){this._rotateEnd.set(t.clientX,t.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const n=this.domElement;this._rotateLeft(A*this._rotateDelta.x/n.clientHeight),this._rotateUp(A*this._rotateDelta.y/n.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(t){this._dollyEnd.set(t.clientX,t.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(t){this._panEnd.set(t.clientX,t.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(t){this._updateZoomParameters(t.clientX,t.clientY),t.deltaY<0?this._dollyIn(this._getZoomScale(t.deltaY)):t.deltaY>0&&this._dollyOut(this._getZoomScale(t.deltaY)),this.update()}_handleKeyDown(t){let n=!1;switch(t.code){case this.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(A*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),n=!0;break;case this.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(-A*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),n=!0;break;case this.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(A*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),n=!0;break;case this.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(-A*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),n=!0;break}n&&(t.preventDefault(),this.update())}_handleTouchStartRotate(t){if(this._pointers.length===1)this._rotateStart.set(t.pageX,t.pageY);else{const n=this._getSecondPointerPosition(t),s=.5*(t.pageX+n.x),i=.5*(t.pageY+n.y);this._rotateStart.set(s,i)}}_handleTouchStartPan(t){if(this._pointers.length===1)this._panStart.set(t.pageX,t.pageY);else{const n=this._getSecondPointerPosition(t),s=.5*(t.pageX+n.x),i=.5*(t.pageY+n.y);this._panStart.set(s,i)}}_handleTouchStartDolly(t){const n=this._getSecondPointerPosition(t),s=t.pageX-n.x,i=t.pageY-n.y,o=Math.sqrt(s*s+i*i);this._dollyStart.set(0,o)}_handleTouchStartDollyPan(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enablePan&&this._handleTouchStartPan(t)}_handleTouchStartDollyRotate(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enableRotate&&this._handleTouchStartRotate(t)}_handleTouchMoveRotate(t){if(this._pointers.length==1)this._rotateEnd.set(t.pageX,t.pageY);else{const s=this._getSecondPointerPosition(t),i=.5*(t.pageX+s.x),o=.5*(t.pageY+s.y);this._rotateEnd.set(i,o)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const n=this.domElement;this._rotateLeft(A*this._rotateDelta.x/n.clientHeight),this._rotateUp(A*this._rotateDelta.y/n.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(t){if(this._pointers.length===1)this._panEnd.set(t.pageX,t.pageY);else{const n=this._getSecondPointerPosition(t),s=.5*(t.pageX+n.x),i=.5*(t.pageY+n.y);this._panEnd.set(s,i)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(t){const n=this._getSecondPointerPosition(t),s=t.pageX-n.x,i=t.pageY-n.y,o=Math.sqrt(s*s+i*i);this._dollyEnd.set(0,o),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const a=(t.pageX+n.x)*.5,u=(t.pageY+n.y)*.5;this._updateZoomParameters(a,u)}_handleTouchMoveDollyPan(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enablePan&&this._handleTouchMovePan(t)}_handleTouchMoveDollyRotate(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enableRotate&&this._handleTouchMoveRotate(t)}_addPointer(t){this._pointers.push(t.pointerId)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let n=0;n<this._pointers.length;n++)if(this._pointers[n]==t.pointerId){this._pointers.splice(n,1);return}}_isTrackingPointer(t){for(let n=0;n<this._pointers.length;n++)if(this._pointers[n]==t.pointerId)return!0;return!1}_trackPointer(t){let n=this._pointerPositions[t.pointerId];n===void 0&&(n=new C,this._pointerPositions[t.pointerId]=n),n.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const n=t.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[n]}_customWheelEvent(t){const n=t.deltaMode,s={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(n){case 1:s.deltaY*=16;break;case 2:s.deltaY*=100;break}return t.ctrlKey&&!this._controlActive&&(s.deltaY*=10),s}}function ws(e){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(e)&&(this._addPointer(e),e.pointerType==="touch"?this._onTouchStart(e):this._onMouseDown(e)))}function Ds(e){this.enabled!==!1&&(e.pointerType==="touch"?this._onTouchMove(e):this._onMouseMove(e))}function Is(e){switch(this._removePointer(e),this._pointers.length){case 0:this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(ge),this.state=P.NONE;break;case 1:const t=this._pointers[0],n=this._pointerPositions[t];this._onTouchStart({pointerId:t,pageX:n.x,pageY:n.y});break}}function js(e){let t;switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case Y.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(e),this.state=P.DOLLY;break;case Y.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(e),this.state=P.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(e),this.state=P.ROTATE}break;case Y.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(e),this.state=P.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(e),this.state=P.PAN}break;default:this.state=P.NONE}this.state!==P.NONE&&this.dispatchEvent(vt)}function Us(e){switch(this.state){case P.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(e);break;case P.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(e);break;case P.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(e);break}}function Hs(e){this.enabled===!1||this.enableZoom===!1||this.state!==P.NONE||(e.preventDefault(),this.dispatchEvent(vt),this._handleMouseWheel(this._customWheelEvent(e)),this.dispatchEvent(ge))}function Fs(e){this.enabled!==!1&&this._handleKeyDown(e)}function ks(e){switch(this._trackPointer(e),this._pointers.length){case 1:switch(this.touches.ONE){case W.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(e),this.state=P.TOUCH_ROTATE;break;case W.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(e),this.state=P.TOUCH_PAN;break;default:this.state=P.NONE}break;case 2:switch(this.touches.TWO){case W.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(e),this.state=P.TOUCH_DOLLY_PAN;break;case W.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(e),this.state=P.TOUCH_DOLLY_ROTATE;break;default:this.state=P.NONE}break;default:this.state=P.NONE}this.state!==P.NONE&&this.dispatchEvent(vt)}function zs(e){switch(this._trackPointer(e),this.state){case P.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(e),this.update();break;case P.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(e),this.update();break;case P.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(e),this.update();break;case P.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(e),this.update();break;default:this.state=P.NONE}}function Ws(e){this.enabled!==!1&&e.preventDefault()}function Ys(e){e.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Bs(e){e.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Gs(e=me,t=J){const n=window.innerWidth/window.innerHeight,s=new Mn(Tn,n,Ln,An);return s.position.copy(e),s.lookAt(t),s}function Ks(e,t,n=bn,s=Pn){const i=new xs(t,e.domElement);return i.minDistance=n,i.maxDistance=s,i}class Zs extends Rn{constructor(n,s=1,i="black",o=.2,a="disk"){let u;a==="disk"?u=new Cn(1,128):u=new Nn(1,1);const r=new On({color:i,opacity:o,transparent:!0,depthWrite:!1,toneMapped:!1,side:vn});super(u,r);O(this,"plane");O(this,"size");this.type="PlaneHelper",this.plane=n,this.size=s}setSize(n){this.size=n,this.updateMatrixWorld()}setColor(n){this.material.color=n}setOpacity(n){this.material.opacity=n}updateMatrixWorld(n){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(n)}dispose(){this.geometry.dispose(),this.material.dispose()}}function Xs({scene:e,normal:t=xn,constant:n=0,size:s=1,colorTheme:i,color:o,opacity:a=In}){const u=o||(i==="light"?wn:Dn),r=new _e(t,n),h=new Zs(r,s,u,a);return h.addEventListener("removed",function(){h.dispose()}),e.add(h),h}function Vs(e){const t=e==="light"?Hn:Fn,n=new jn;return n.background=new Un(t),n}function qs(e){const t=new At;return e.add(t),t.renderOrder=1/0,t}function $s(e){const t=new At;return e.add(t),t}function Qs(e,t,n,s){const{width:i,height:o}=e.getBoundingClientRect();s.aspect=i/o,s.updateProjectionMatrix(),t.setSize(i,o),n.setSize(i,o)}function Js(e,t,n,s,i,o,a,u,r,h){if(n.last){let S=h==="light"?it:ot;n.last===s.last&&(S=h==="light"?Ct:Nt),n.last.material.color.set(S),n.last=null}const{top:l,left:d,width:m,height:E}=t.getBoundingClientRect(),y=e.clientX-d,p=e.clientY-l;r.style.transform=`translate( ${y}px, ${p}px )`,i.x=y/m*2-1,i.y=(p/E*2-1)*-1,o.setFromCamera(i,a);const _=o.intersectObject(u,!0);if(_.length>0){const S=_.filter(function(g){return g&&g.object})[0];if(S&&S.object){n.last=S.object;const g=h==="light"?Wn:Yn;n.last.material.color.set(g)}}}function ti(e,t,n,s,i,o,a,u,r,h,l){if(s.last){const g=h==="light"?it:ot;s.last.material.color.set(g),s.last=null}const{top:d,left:m,width:E,height:y}=t.getBoundingClientRect(),p=e.clientX-m,_=e.clientY-d;r.style.transform=`translate( ${p}px, ${_}px )`,i.x=p/E*2-1,i.y=(_/y*2-1)*-1,o.setFromCamera(i,a);const S=o.intersectObject(u,!0);if(S.length>0){const g=S.filter(function(b){return b&&b.object})[0];if(g&&g.object){s.last=g.object;const b=h==="light"?Ct:Nt;s.last.material.color.set(b),l(g.object.userData.item)}}}function ei(e,t,n,s,i,o){e.render(s,i),t.render(s,i);const a=ni(o);n.innerText=`zoom: ${a.toFixed(3)}x`}function ni(e){return e.target.distanceTo(e.object.position)}function si({canvasElement:e,mapZoomLevelLabel:t,overlayElement:n,pointerDotElement:s,colorTheme:i,onSelectItem:o}){const a={last:null},u={last:null},{renderer:r,overlayRenderer:h}=ii(e,n),l=Vs(i),d=qs(l),m=$s(l),E=Gs(),y=Ks(r,E),p=Xs({scene:l,colorTheme:i});function _(){ei(r,h,t,l,E,y)}const S=new kn,g=new C;function b(){Qs(e,r,h,E)}function L(K){Js(K,e,a,u,g,S,E,d,s,i),_()}function R(K){ti(K,e,a,u,g,S,E,d,s,i,o),_()}window.addEventListener("resize",b),e.addEventListener("pointermove",L),e.addEventListener("click",R),y.addEventListener("change",_),b();function at(){r.setAnimationLoop(null),window.removeEventListener("resize",b),e.removeEventListener("pointermove",L),e.removeEventListener("click",R),y.removeEventListener("change",_),y.dispose(),r.dispose()}return{renderer:r,overlayRenderer:h,scene:l,spritesGroup:d,spritesProjectionLinesGroup:m,planeHelper:p,camera:E,cameraControls:y,renderFrame:_,destroyMapRenderer:at}}function ii(e,t){const n=ai(e),s=oi(t);return{renderer:n,overlayRenderer:s}}function oi(e){const t=new Os({element:e,isUsingZOrder:!1});return t.setSize(window.innerWidth,window.innerHeight),t}function ai(e){const t=new zn({antialias:!0,canvas:e});return t.setPixelRatio(window.devicePixelRatio),t.setSize(window.innerWidth,window.innerHeight),t}function ri({mode:e,items:t,onSelectItem:n,selectedItemUuid:s}){const[i]=Xn("prefered-color-scheme",void 0),o=f.useRef(null),a=f.useRef(null),u=f.useRef(null),r=f.useRef(null),h=f.useRef(null),l=f.useRef(null),d=f.useRef(null),m=f.useRef(null),[E,y]=f.useState(!1),p=f.useRef(null),_=f.useRef(null),S=f.useRef(null),g=f.useRef(null),[b,L]=f.useState(void 0),R=f.useCallback(function(){typeof b=="function"&&window.setTimeout(function(){typeof b=="function"&&b()},Bn)},[b]);f.useEffect(function(){const rt=p.current;if(!rt){console.error("Error. Map canvas as html element does not exist");return}const Dt=S.current;if(!Dt){console.error("Error. Map overlay as html element does not exist");return}const It=g.current;if(!It){console.error("Error. Map zoom level label as html element does not exist");return}const jt=_.current;if(!jt){console.error("Error. Map pointer dot as html element does not exist");return}const{renderer:Le,overlayRenderer:Ae,scene:Re,spritesGroup:Ce,spritesProjectionLinesGroup:Ne,planeHelper:Oe,camera:ve,cameraControls:xe,renderFrame:Ut,destroyMapRenderer:we}=si({canvasElement:rt,overlayElement:Dt,mapZoomLevelLabel:It,pointerDotElement:jt,colorTheme:i,onSelectItem:n});return o.current=Le,a.current=Ae,u.current=Re,r.current=Ce,h.current=Ne,l.current=Oe,m.current=ve,d.current=xe,L(()=>Ut),Ut(),function(){o.current=null,a.current=null,u.current=null,r.current=null,d.current=null,l.current=null,m.current=null,d.current=null,L(void 0),we()}},[o,a,p,S,g,_,r,h,l,m,d,L,i,n]);const at=Ns({cameraControlsRef:d,cameraRef:m,spritesGroupRef:r});return As({spritesGroupRef:r,spritesProjectionLinesGroupRef:h,sceneRef:u,planeHelperRef:l,mapOverlayContainerRef:S,items:t,colorTheme:i,mode:e,setNoDataToDisplay:y,resetCamera:at,renderFrame:R}),Cs({selectedItemUuid:s,spritesGroupRef:r,items:t,colorTheme:i,mode:e,renderFrame:R}),{noDataToDisplay:E,mapCanvasRef:p,mapOverlayContainerRef:S,mapZoomLevelLabelRef:g,pointerDotRef:_,renderFrame:R}}const li="_MapStatusLabel_h103l_1",ci="_CanvasContainer_h103l_13",hi="_PointerDot_h103l_28",q={MapStatusLabel:li,CanvasContainer:ci,PointerDot:hi},ui="_MapDynamicOverlayContainer_1rg5l_1",di={MapDynamicOverlayContainer:ui},mi="_SpriteLabelAnchor_190g4_1",pi="_SpriteLabel_190g4_1",_i="_GroupItemId_190g4_23",fi="_GroupItemName_190g4_27",U={SpriteLabelAnchor:mi,SpriteLabel:pi,GroupItemId:_i,GroupItemName:fi},yi=f.memo(function({item:t}){const n=f.useMemo(function(){let u=[];return D(t)?u=[U.LocationLabel]:I(t)?u=[U.MovingEntityLabel]:H(t)&&(u=[U.PlanetarySystemLabel]),ne([U.SpriteLabelAnchor].concat(u))},[t]);if(!t||!Rt(t.position))return;let i;const o=t.name||"unknown name";return D(t)||I(t)?i=t.id:H(t),c.jsx("div",{"data-item-uuid":t.uuid,className:n,children:c.jsxs("div",{className:U.SpriteLabel,children:[i&&c.jsx("div",{className:U.GroupItemId,children:i}),c.jsx("div",{className:U.GroupItemName,children:o})]})})}),gi=f.memo(function({items:t}){return c.jsx(c.Fragment,{children:t.map(n=>c.jsx(yi,{item:n},n.uuid))})}),Si=f.memo(function({items:t,ref:n}){return c.jsx("div",{ref:n,className:di.MapDynamicOverlayContainer,children:c.jsx(gi,{items:t})})}),Ei="_MapStaticOverlayContainer_1k91g_1",bi="_PlanetarySystemNameLabelContainer_1k91g_13",Pi="_PlanetarySystemNameLabel_1k91g_13",Mi="_PlanetarySystemNameSubLabel_1k91g_43",Ti="_MapZoomLevelLabel_1k91g_47",X={MapStaticOverlayContainer:Ei,PlanetarySystemNameLabelContainer:bi,PlanetarySystemNameLabel:Pi,PlanetarySystemNameSubLabel:Mi,MapZoomLevelLabel:Ti},Li=f.memo(function({selectedPlanetarySystemUuid:t,mapZoomLevelLabelRef:n,mapMode:s}){const i=f.useMemo(function(){var a;if(s!==N)return t&&((a=Q(t))==null?void 0:a.name)},[t,s]);return c.jsxs("div",{className:X.MapStaticOverlayContainer,children:[i&&c.jsxs("div",{className:X.PlanetarySystemNameLabelContainer,children:[c.jsx("div",{className:X.PlanetarySystemNameLabel,children:i}),c.jsx("div",{className:X.PlanetarySystemNameSubLabel,children:"planetary system"})]}),c.jsx("div",{ref:n,className:X.MapZoomLevelLabel})]})}),Ai=f.memo(function({isLoading:t=!1,items:n=[],mapMode:s,selectedPlanetarySystemUuid:i,onSelectItem:o,selectedItemUuid:a}){const{mapCanvasRef:u,mapOverlayContainerRef:r,mapZoomLevelLabelRef:h,pointerDotRef:l,noDataToDisplay:d,renderFrame:m}=ri({mode:s,items:n,onSelectItem:o,selectedItemUuid:a});return ms(u,m),c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:q.CanvasContainer,children:[c.jsx("canvas",{ref:u}),c.jsx(Si,{ref:r,items:n}),c.jsx(Li,{mapZoomLevelLabelRef:h,selectedPlanetarySystemUuid:i,mapMode:s}),c.jsx("div",{ref:l,className:q.PointerDot})]}),t&&c.jsx("div",{className:q.MapStatusLabel,children:"data loading..."}),!t&&d&&c.jsx("div",{className:q.MapStatusLabel,children:"no data available"})]})}),Ri="_Container_lebq8_1",Ci="_MapContainer_lebq8_9",Ni="_SearchResults_lebq8_18",Oi="_SearchResultName_lebq8_28",tt={Container:Ri,MapContainer:Ci,SearchResults:Ni,SearchResultName:Oi};function Jt(e){let t;if(H(e))t=e;else if(D(e))t=!!e.planetarySystemUuid&&Q(e.planetarySystemUuid)||void 0;else if(I(e)){const n=!!e.locationUuid&&ie(e.locationUuid)||void 0;n?t=!!(n!=null&&n.planetarySystemUuid)&&Q(n.planetarySystemUuid)||void 0:t=!!e.locationUuid&&Q(e.locationUuid)||void 0}return t}function vi(){return[{name:"name",asLinkToSelectItem:!0,alignLabel:"left",formatValue:function({item:t}){const s=B([x,G,w])?void 0:Jt(t),i=D(t)||I(t)?Ot([t.id,t.name,s==null?void 0:s.name]):t.name;return c.jsx(c.Fragment,{children:typeof i=="string"?c.jsxs("div",{className:tt.SearchResultName,children:[I(t)&&c.jsxs(c.Fragment,{children:[c.jsx(Z,{})," "]}),D(t)&&c.jsxs(c.Fragment,{children:[c.jsx(Z,{})," "]}),H(t)&&c.jsxs(c.Fragment,{children:[c.jsx(qn,{})," "]}),i]}):c.jsx(We,{children:"(no data)"})})},actionButtons:function({item:t}){const n=B([x,G,w]),s=n?void 0:Jt(t),i=I(t)&&(n||!Ht(t.uuid))?void 0:qe(t.uuid),o=$n({movingEntityName:(i==null?void 0:i.id)||(i==null?void 0:i.name)}),a=D(t)&&(n||!Ht(t.uuid))?void 0:ie(t.uuid),u=a&&Wt({locationName:(a==null?void 0:a.id)||(a==null?void 0:a.name),planetarySystemName:s==null?void 0:s.name}),r=s&&Wt({planetarySystemName:s==null?void 0:s.name}),h=Rt(t.position),l=i&&h&&ht({planetarySystemName:s==null?void 0:s.name,movingEntityId:i.id,movingEntityName:i.name}),d=a&&h&&ht({planetarySystemName:s==null?void 0:s.name,locationId:a.id,locationName:a.name}),m=s&&h&&ht({planetarySystemName:s==null?void 0:s.name,mapMode:N});return c.jsxs(c.Fragment,{children:[I(t)&&c.jsxs(c.Fragment,{children:[l?c.jsx(F,{href:l,title:"show moving object on map",children:c.jsx(Z,{})}):c.jsx(k,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no position data",children:c.jsx(dt,{})}),o?c.jsx(F,{href:o,title:"show moving object info",children:c.jsx(ut,{})}):c.jsx(k,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no moving object data",children:c.jsx(lt,{})})]}),D(t)&&c.jsxs(c.Fragment,{children:[d?c.jsx(F,{href:d,title:"show location on map",children:c.jsx(Z,{})}):c.jsx(k,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no position data",children:c.jsx(dt,{})}),u?c.jsx(F,{href:u,title:"show location info",children:c.jsx(ut,{})}):c.jsx(k,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no location data",children:c.jsx(lt,{})})]}),H(t)&&c.jsxs(c.Fragment,{children:[m?c.jsx(F,{href:m,title:"show planetary system on map",children:c.jsx(Z,{})}):c.jsx(k,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no position data",children:c.jsx(dt,{})}),r?c.jsx(F,{href:r,title:"show planetary system info",children:c.jsx(ut,{})}):c.jsx(k,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no planetary system data",children:c.jsx(lt,{})})]})]})}}]}function xi(e,t){const s=B([x,G,w]),i=f.useMemo(function(){return t===N?[]:e?oe(e):[]},[e,s,t]),o=f.useMemo(function(){return t===N?[]:e?ae(e):[]},[e,s,t]),a=f.useMemo(function(){return t===N?yt():[]},[s,t]);return f.useMemo(function(){return t===N?a:new Array().concat(i,o)},[a,i,o,s,t])}function te(e,t){return e.name.localeCompare(t.name)}function $(e,t){return e.id&&t.id?e.id.localeCompare(t.id):e.name.localeCompare(t.name)}function wi({searchFieldValue:e,selectedPlanetarySystemUuid:t,mapMode:n}){const i=B([x,G,w]),o=f.useMemo(function(){return e?yt().filter(d=>d.name.includes(e)).sort(te):n===N?yt().sort(te):[]},[e,i,n]),a=f.useMemo(function(){if(!e)return n===N?[]:t?oe(t).sort($):[];const l=e.toLocaleUpperCase();return $e().filter(m=>m.id&&m.id.includes(l)?!0:m.name.includes(e)).sort($)},[e,t,i,n]),u=f.useMemo(function(){if(!e)return n===N?[]:t?ae(t).sort($):[];const l=e.toLocaleUpperCase();return Qe().filter(m=>m.id&&m.id.includes(l)||m.originalId&&m.originalId.includes(l)?!0:m.name.includes(e)).sort($)},[e,t,i,n]);return f.useMemo(function(){return new Array().concat(o,a,u)},[o,a,u])}const Di=[Et,bt,Pt,Mt,Tt,Lt];function st(e){const t=e.get(Lt)||void 0,n=Gn(t)?t:void 0,s={movingEntityId:e.get(Et)||void 0,movingEntityName:e.get(bt)||void 0,locationId:e.get(Pt)||void 0,locationName:e.get(Mt)||void 0,planetarySystemName:e.get(Tt)||void 0,mapMode:n};return Ye(s)}function Ii({filterValue:e}){var E;if(!e)return;const{movingEntityId:t,movingEntityName:n,locationId:s,locationName:i,planetarySystemName:o,mapMode:a,...u}=e,r=Je({id:t,name:n,planetarySystemName:o}),h=r==null?void 0:r.uuid,l=tn({id:s,name:i,planetarySystemName:o}),d=l==null?void 0:l.uuid,m=l!=null&&l.planetarySystemUuid?l==null?void 0:l.planetarySystemUuid:!!o&&((E=en(o))==null?void 0:E.uuid)||void 0;return{...u,movingEntityUuid:h,locationUuid:d,planetarySystemUuid:m,mapMode:a}}function ji({urlSearchParams:e,setUrlSearchParams:t}){const s=B([w,G,x]),i=f.useRef(void 0),o=f.useMemo(function(){const r=st(e),h=Ii({filterValue:r}),l=i.current;return Ft(l,h)?(i.current=h,h):l},[e,i,s]),a=f.useCallback(function(r){let h;if(typeof r=="function")throw new Error("MapFilterValue as setState(prev=>newState) function not supported");r&&Object.keys(r).length>0&&(h=r),t(l=>{const d=st(l);if(Ft(d,h)){if(!h)return Di.forEach(S=>{l.delete(S)}),l;const E=h.movingEntityUuid,y=h.locationUuid,p=h.planetarySystemUuid,_=h.mapMode;Vn({urlSearchParams:l,movingEntityUuid:E,locationUuid:y,planetarySystemUuid:p,mapMode:_,movingEntityIdUrlSearchParamsKeyName:Et,movingEntityNameUrlSearchParamsKeyName:bt,locationIdUrlSearchParamsKeyName:Pt,locationNameUrlSearchParamsKeyName:Mt,planetarySystemNameUrlSearchParamsKeyName:Tt,mapModeUrlSearchParamsKeyName:Lt})}return l})},[t]);return{mapFilterValue:o,setMapFilterValueToUrlSearchParams:a}}const Se=Be();function xt(){const{isHydrating:e,isHydrated:t}=w.getState(),{isHydrating:n,isHydrated:s}=x.getState();if(e||!t||n||!s)return;const i=re(),o=le(),a=ce();Ui({movingEntitiesMap:i,locationsMap:o,planetarySystemsMap:a})}Se.setState({prepareData:xt});w.subscribe(function(){xt()});x.subscribe(function(){xt()});function Ui({movingEntitiesMap:e,locationsMap:t,planetarySystemsMap:n}){const s=Se.getState();s.isProcessing||(s.setIsProcessing(!0),window.setTimeout(function(){const a=Fi({movingEntitiesMap:e,locationsMap:t,planetarySystemsMap:n});s.replaceAll(a),s.setIsProcessing(!1)},0))}function Ee(e,t=!1,n){const s=(e==null?void 0:e.id)??"",i=(e==null?void 0:e.name)??"(movingEntity without name)",o=n??Ot([s,i]),a=t?Ge(i,"name"):o;return{movingEntityNameWithId:o,movingEntityNameWithIdAsLabel:a}}function Hi({movingEntitiesMap:e,locationsMap:t,planetarySystemsMap:n,shouldAddSuffixLabel:s=!1}){const i=[],o=et(n),a=et(e);return o.forEach(function(r){const h=r?r.uuid:void 0,{planetarySystemName:l,planetarySystemNameAsLabel:d}=nt(r,s);i.push({uuid:h,name:l,label:d,items:[]})}),a.forEach(function(r){const h=t.get(r.locationUuid),l=h==null?void 0:h.planetarySystemUuid,d=l?n.get(l):void 0,m=d==null?void 0:d.uuid,{planetarySystemName:E,planetarySystemNameAsLabel:y}=nt(d,s),p=r.uuid,{movingEntityNameWithId:_,movingEntityNameWithIdAsLabel:S}=Ee(r,s),g=i.find(b=>b.uuid===m);g?(g.items||(g.items=[]),g.items.find(L=>L.uuid===p)||g.items.push({uuid:p,name:_,label:S})):i.push({uuid:m,name:E,label:y,items:[{uuid:p,name:_,label:S}]})}),i}function be(e){e.sort((t,n)=>t.name.localeCompare(n.name)),e.forEach(({items:t})=>be(t??[]))}function Pe({items:e=[],level:t=0,disableOptionsWithoutUuid:n=!0,selectOptions:s=new Array}){return e.forEach(i=>{const{label:o,items:a}=i,u=i.uuid,r=u??"";s.push({value:r,label:o,level:t,disabled:n?!u:!1}),a!=null&&a.length&&Pe({items:a,level:t+1,disableOptionsWithoutUuid:n,selectOptions:s})}),s}function Fi({movingEntitiesMap:e,locationsMap:t,planetarySystemsMap:n,disableOptionsWithoutUuid:s}){const i=Hi({movingEntitiesMap:e,locationsMap:t,planetarySystemsMap:n,shouldAddSuffixLabel:!1});return be(i),Pe({items:i,disableOptionsWithoutUuid:s})??[]}const Me=Kn();function wt(){const{isHydrating:e,isHydrated:t}=w.getState(),{isHydrating:n,isHydrated:s}=x.getState();if(e||!t||n||!s)return;const i=re(),o=le(),a=ce();ki({movingEntitiesMap:i,locationsMap:o,planetarySystemsMap:a})}Me.setState({prepareData:wt});w.subscribe(function(){wt()});x.subscribe(function(){wt()});function ki({movingEntitiesMap:e,locationsMap:t,planetarySystemsMap:n}){const s=Me.getState();s.isProcessing||(s.setIsProcessing(!0),window.setTimeout(function(){const a=zi({movingEntitiesMap:e,locationsMap:t,planetarySystemsMap:n});s.replaceAll(a),s.setIsProcessing(!1)},0))}function zi({movingEntitiesMap:e,locationsMap:t,planetarySystemsMap:n}){return Yi({movingEntitiesMap:e,locationsMap:t,planetarySystemsMap:n,shouldAddSuffixLabel:!1})}function Te({id:e,name:t,reverseOrder:n=!1,namePartSeparator:s=fe}){let o=[Ot([e,t],!1," ")].filter(a=>!!a);return n&&(o=o.reverse()),o.join(s)}function Wi({movingEntity:e,locationsMap:t,planetarySystemsMap:n,isUsingNoDataTextForEmptyParts:s={},reverseOrder:i=!1,namePartSeparator:o=fe}){const a=s.id?"(no-id)":"",u=e.locationUuid,r=u?t.get(u):void 0,h=r==null?void 0:r.planetarySystemUuid,l=h?n.get(h):void 0,d=s.planetarySystem?"(no planetary system data)":"";return Te({id:e.id??a,name:e.name,planetarySystemName:(l==null?void 0:l.name)??d,reverseOrder:i,namePartSeparator:o})}function Yi({movingEntitiesMap:e,locationsMap:t,planetarySystemsMap:n,shouldAddSuffixLabel:s=!1}){const i=new Map,o=et(n),a=et(e);return o.forEach(function(r){const h=r.uuid,{planetarySystemName:l}=nt(r,s);i.set(h,l)}),a.forEach(function(r){const h=r==null?void 0:r.locationUuid,l=t.get(h),d=l==null?void 0:l.planetarySystemUuid,m=d?n.get(d):void 0,E=m?m.uuid:void 0,{planetarySystemName:y}=nt(m,s),p=r.uuid,_=l?Wi({movingEntity:r,locationsMap:t,planetarySystemsMap:n,isUsingNoDataTextForEmptyParts:{planetarySystem:!0}}):void 0,{movingEntityNameWithId:S}=Ee(r,s,_);!(E?i.get(E):void 0)&&E&&i.set(E,y),i.set(p,S)}),i}const ee="Map";function Bi({movingEntityName:e,locationName:t}){const n=[e,!!t&&(e?`in ${t}`:`${t}`)].filter(s=>!!s);return n.length?`${n.join(" ")} - ${ee}`:`${ee}`}function Gi(e){const t=f.useMemo(function(){const o=st(e);return Zn({id:o==null?void 0:o.locationId,name:o==null?void 0:o.locationName,planetarySystemName:o==null?void 0:o.planetarySystemName})},[e]),n=f.useMemo(function(){const o=st(e);return Te({id:o==null?void 0:o.movingEntityId,name:o==null?void 0:o.movingEntityName,planetarySystemName:o==null?void 0:o.planetarySystemName})},[e]);return f.useMemo(function(){return Qn(Bi({movingEntityName:n,locationName:t}))},[n,t])}function Ki({urlSearchParams:e,setUrlSearchParams:t}){return Ke({urlSearchParams:e,setUrlSearchParams:t,getSearchValueFromUrlSearchParams:Ze,searchValueKeyInUrlSearchParams:kt,searchFieldNameInSearchForm:kt,searchFieldPlaceholderTextInSearchForm:"Search by name or id..."})}const Zi=f.memo(function(){const{urlSearchParams:t,setUrlSearchParams:n}=Xe(),s=Gi(t),{mapFilterValue:i,setMapFilterValueToUrlSearchParams:o}=ji({urlSearchParams:t,setUrlSearchParams:n}),{SearchForm:a,searchFieldValue:u}=Ki({urlSearchParams:t,setUrlSearchParams:n}),h=B([x,G,nn,w,sn]),{movingEntityUuid:l,locationUuid:d,planetarySystemUuid:m,mapMode:E}=i||{},y=f.useMemo(function(){return vi()},[h]),p=f.useCallback(function(R){H(R)?o({planetarySystemUuid:R.uuid}):D(R)?o({locationUuid:R.uuid}):I(R)&&o({movingEntityUuid:R.uuid})},[o]),_=f.useMemo(function(){return l||d?j:m?E?N:j:N},[E,l,d,m]),S=wi({searchFieldValue:u,selectedPlanetarySystemUuid:m,mapMode:_}),g=xi(m,_),b=f.useMemo(function(){return l||d||m},[m,d,l]);return c.jsxs(c.Fragment,{children:[c.jsx("title",{children:s}),c.jsxs("div",{className:tt.Container,children:[c.jsx("div",{className:tt.SearchResults,children:c.jsxs(Ue,{children:[a,c.jsx(ds,{tableTitle:"search results",items:S,noItemsLabel:"no results",isLoading:h,searchFieldValue:u,children:c.jsx(us,{items:S,columns:y,onSelectItem:p,selectedItemUuid:b})})]})}),c.jsx("div",{className:tt.MapContainer,children:c.jsx(Ai,{isLoading:h,items:g,mapMode:_,selectedPlanetarySystemUuid:m,onSelectItem:p,selectedItemUuid:b})})]})]})}),lo=je(function(){return c.jsx(Zi,{})});export{lo as default};
