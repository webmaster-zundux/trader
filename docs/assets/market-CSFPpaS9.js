import{a as m,p as f,s as Ai}from"./chunk-NL6KNZEE-BTkWJe7M.js";import{o as ze,B as H,p as Zn,q as Jn,t as nt,v as rt,n as G,w as tr,x as K,y as ct,z as Z,A as it,F as Si,G as Mi,H as ht,J as Ke,K as Ci,m as er,L as dn,O as hn,M as Ni,N as Ti,Q as Ei,R as Fi,T as Pi,U as ki,V as Oi,W as Li}from"./useLoadingPersistStorages-2z21HOLf.js";import{u as st,D as Ii,h as nr,g as ae,a as rr,M as ir,b as or,c as sr,d as ar,e as lr,f as ur,T as $i}from"./hasUuid-DU12wTjt.js";import{a as cr,u as fr,e as $t,f as mn,M as dr,F as Bi,c as Ht,b as hr,d as mr}from"./shallow-dOq8ySJI.js";import{c as ji,a as Ri,D as Di,i as le,N as pr,S as Ie,T as yr,b as gr,d as pn,U as xr,e as _r,f as br,g as vr,h as Ze,j as Je,k as tn,l as Ui,u as Hi,m as wr,n as yn,o as Vi}from"./useTableSearch-8fNMuaJU.js";import{c as Xi}from"./createPageTitleWithAppName-CJkNTaXl.js";import{u as gt,a as ft,g as It,c as Qi,b as Yi,d as qi,L as Gi,e as Wi}from"./getUrlToMapPageWithParams-B-fxwgGd.js";import{M as zi}from"./Main-CgXj-WVg.js";import{M as gn}from"./ModalNotification-DyVyZpGh.js";import{s as Ar,F as Sr}from"./sortItemsByLocationFullNameForOrder-Y3QXlHg2.js";import{S as Vt}from"./StaticLink-BbBTYWDN.js";import{I as Mr,s as Ki}from"./setMovingEntityOrLocationOrPlanetarySystemToUrlSearchParams-Cnk-916A.js";import{L as Zi,a as Ji}from"./LocationOffIcon-BLDsxhkF.js";import{g as Cr,Q as Nr}from"./getUrlToMarketPageWithParams-ClE_Yemf.js";import{g as to}from"./getUrlToProductsPageWithParams-D0tQrk0-.js";import"./middleware-XeL71aNN.js";import"./index-D_ImYj8K.js";import"./App.const-DTwjj9QA.js";const xn="Market";function eo({productName:t,locationName:e}){const n=[t,!!e&&`in ${e}`].filter(r=>!!r);return n.length?`Search ${n.join(" ")} - ${xn}`:`${xn}`}const no="_Container_16hmi_1",ro="_SearchAndFilterFormContainer_16hmi_9",_n={Container:no,SearchAndFilterFormContainer:ro},qt="buy-order",Tr=["uuid","entityType","productUuid","locationUuid","price","desirableQuantity"],io=ze(Tr);function ue(t){return(t==null?void 0:t.entityType)===qt}const Gt="sell-order",Er=["uuid","entityType","productUuid","locationUuid","price","availableQuantity"],oo=ze(Er);function ce(t){return(t==null?void 0:t.entityType)===Gt}const bn=t=>[{name:"locationUuid",label:"location",type:"select",options:t,chooseOptionLabel:"choose a location",noOptionsLabel:"no location available",allowToSelectNoValueOption:!0,filterPredicate:(e,n)=>e.locationUuid===n.locationUuid},{name:"minQuantity",label:"min",type:"number",min:0,max:Number.MAX_SAFE_INTEGER,filterPredicate:(e,n)=>{const r=n.minQuantity;return r===void 0?!0:ce(e)?e.availableQuantity>=r:ue(e)?e.desirableQuantity>=r:!0}},{name:"maxQuantity",label:"max",type:"number",min:0,max:Number.MAX_SAFE_INTEGER,filterPredicate:(e,n)=>{const r=n.maxQuantity;return r===void 0?!0:ce(e)?e.availableQuantity<=r:ue(e)?e.desirableQuantity<=r:!0}},{name:"minPrice",label:"min",type:"number",valueType:"float",pattern:"[0-9]+[.][0-9]{2}",min:0,max:Number.MAX_SAFE_INTEGER,step:"0.01",filterPredicate:(e,n)=>{const r=n.minPrice;return r===void 0?!0:e.price>=r}},{name:"maxPrice",label:"max",type:"number",valueType:"float",pattern:"[0-9]+[.][0-9]{2}",min:0,max:Number.MAX_SAFE_INTEGER,step:"0.01",filterPredicate:(e,n)=>{const r=n.maxPrice;return r===void 0?!0:e.price<=r}}],so="_DialogEditFormBody_359mj_1",ao="_Content_359mj_16",lo="_ErrorMessageContainer_359mj_22",uo="_ErrorMessageText_359mj_32",co="_Row_359mj_40",fo="_FieldsContainer_359mj_56",ho="_ActionButtons_359mj_91",mo="_ActionButtonsGroup_359mj_97",et={DialogEditFormBody:so,Content:ao,ErrorMessageContainer:lo,ErrorMessageText:uo,Row:co,FieldsContainer:fo,ActionButtons:ho,ActionButtonsGroup:mo},po=t=>{if(!t)return;const{minPrice:e,maxPrice:n,minQuantity:r,maxQuantity:i}=t;if(typeof e=="number"&&Number.isFinite(e)&&typeof n=="number"&&Number.isFinite(n)&&e>n)return function(){return f.jsxs(f.Fragment,{children:[f.jsx("strong",{children:"Max price"})," ","should be equal or greater then"," ",f.jsx("strong",{children:"min price"}),"."]})};if(typeof r=="number"&&Number.isFinite(r)&&typeof i=="number"&&Number.isFinite(i)&&r>i)return function(){return f.jsxs(f.Fragment,{children:[f.jsx("strong",{children:"Max quantity"})," ","should be equal or greater then"," ",f.jsx("strong",{children:"min quantity"}),"."]})}},yo=m.memo(function({filterValue:e,onSetFilterValue:n,onHide:r}){const i=m.useRef(null),o=st([gt]),s=gt(x=>x.items),a=m.useMemo(function(){return bn(o?[]:s)},[s,o]),l=m.useCallback(function(){r()},[r]),u=m.useCallback(function(_){n(_),l()},[l,n]),{handleSubmit:c,formValidationErrorMessage:d}=cr({formRef:i,onSubmit:u,formFields:a,validateFormData:po,showErrorWhenAllVisibleFieldsEmpty:!1}),h=m.useCallback(function(){c()},[c]);fr(i,a,h);const p=a.find(x=>x.name==="locationUuid"),y=e==null?void 0:e[p.name],b=a.find(x=>x.name==="minPrice"),v=e==null?void 0:e[b.name],C=a.find(x=>x.name==="maxPrice"),w=e==null?void 0:e[C.name],A=a.find(x=>x.name==="minQuantity"),L=e==null?void 0:e[A.name],T=a.find(x=>x.name==="maxQuantity"),F=e==null?void 0:e[T.name];return f.jsx(f.Fragment,{children:f.jsx("div",{style:{position:"absolute",top:0,right:0},children:f.jsx(Ii,{title:"filter orders",onHide:l,children:f.jsxs("form",{ref:i,className:et.DialogEditFormBody,onSubmit:c,children:[f.jsxs("div",{className:et.Content,children:[f.jsxs("div",{className:et.FieldsContainer,children:[f.jsx($t,{field:p,fieldValue:y}),f.jsx(mn,{name:b.name,label:"price",children:f.jsxs("div",{className:et.Row,children:[f.jsx($t,{field:b,fieldValue:v,hideFieldLabel:!0})," - ",f.jsx($t,{field:C,fieldValue:w,hideFieldLabel:!0})]})}),f.jsx(mn,{name:A.name,label:"quantity",children:f.jsxs("div",{className:et.Row,children:[f.jsx($t,{field:A,fieldValue:L,hideFieldLabel:!0})," - ",f.jsx($t,{field:T,fieldValue:F,hideFieldLabel:!0})]})})]}),d!==void 0&&f.jsx("div",{className:et.ErrorMessageContainer,children:f.jsx("span",{className:et.ErrorMessageText,children:typeof d=="function"?d():d})})]}),f.jsxs("div",{className:et.ActionButtons,children:[f.jsx("div",{className:et.ActionButtonsGroup,children:f.jsx(H,{type:"reset",children:"reset filter"})}),f.jsx("div",{className:et.ActionButtonsGroup,children:f.jsx(H,{type:"submit",primary:!0,children:"apply filter"})})]})]})})})})}),go=t=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...t},m.createElement("path",{d:"M15 20H5V7c0-.55-.45-1-1-1s-1 .45-1 1v13c0 1.1.9 2 2 2h10c.55 0 1-.45 1-1s-.45-1-1-1zm5-4V4c0-1.1-.9-2-2-2H9c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h9c1.1 0 2-.9 2-2zm-2 0H9V4h9v12z"})),xo=m.memo(go),_o="_ModalCopyingItemsFormBody_1ckjs_1",bo="_Content_1ckjs_9",vo="_ErrorMessageContainer_1ckjs_17",wo="_ErrorMessageText_1ckjs_27",Ao="_ActionButtons_1ckjs_35",So="_ActionButtonsGroup_1ckjs_41",Mt={ModalCopyingItemsFormBody:_o,Content:bo,ErrorMessageContainer:vo,ErrorMessageText:wo,ActionButtons:Ao,ActionButtonsGroup:So};function Mo(t){if(!(t!=null&&t.length))return[{type:"checkbox-group",name:"uuids",label:"selected items",defaultValue:[],items:[],disabled:!0}];const e=t.map(({uuid:r})=>({value:r,label:"unknown label"}));return[{type:"checkbox-group",name:"uuids",label:"selected items",defaultValue:e.map(({value:r})=>r),items:e}]}function Co({title:t="copy selected items",itemsToCreate:e,showResetButton:n=!1,resetButtonLabel:r,onCancel:i,cancelButtonLabel:o,saveButtonLabel:s,onBulkCreate:a}){const l="copy items",u=m.useRef(null),c=m.useMemo(()=>Mo(e),[e]);fr(u,c);const d=m.useCallback(C=>{if(!(e!=null&&e.length))return;const w=e.filter(A=>C.uuids.includes(A.uuid));a(w)},[e,a]),h=m.useCallback(()=>{},[]),{handleSubmit:p,formValidationErrorMessage:y}=cr({formRef:u,onSubmit:d,formFields:c,validateFormData:h}),b=m.useCallback(()=>{i()},[i]),v=m.useMemo(()=>{if(e)return{uuids:e.map(C=>C.uuid),entityType:"approved-items",uuid:"no-uuid"}},[e]);return f.jsx(dr,{title:t,onHide:b,children:f.jsxs("form",{ref:u,className:Mt.ModalCopyingItemsFormBody,onSubmit:p,children:[f.jsxs("div",{className:Mt.Content,children:[f.jsx(Bi,{formFields:c,item:v}),y!==void 0&&f.jsx("div",{className:Mt.ErrorMessageContainer,role:"alert",children:f.jsx("span",{className:Mt.ErrorMessageText,children:typeof y=="function"?y():y})})]}),f.jsxs("div",{className:Mt.ActionButtons,children:[f.jsx(H,{onClick:i,children:o||"cancel"}),f.jsxs("div",{className:Mt.ActionButtonsGroup,children:[n&&f.jsx(H,{size:"small",children:r||"reset form"}),f.jsx(H,{type:"submit",primary:!0,children:s||l})]})]})]})})}const No="_Message_fvh5i_1",To={Message:No};function Fr({items:t,selectedItemsUuids:e,itemTypeName:n="item",itemTypePluralName:r="items",targetTableName:i=void 0,onBulkCopyingIntoTargetTable:o,findSimilarItemInTargetTable:s}){const[a,l]=m.useState(),[u,c]=m.useState([]),{isVisible:d,show:h,hide:p}=Ht(!1),{isVisible:y,show:b,hide:v}=Ht(!1),C=m.useCallback(()=>{const N=t.filter(O=>e.includes(O.uuid)).filter(O=>!s(O));if(!N.length){b(),l(void 0);return}l(N),h()},[t,e,l,h,b,s]),w=m.useCallback(()=>{p(),l(void 0)},[p,l]),{isVisible:A,show:L,hide:T}=Ht(!1),F=m.useCallback(M=>{o(M),c(M),w(),L()},[o,c,w,L]),E=m.useCallback(()=>{const M=`copy selected ${e.length>1?r:n} ${!!i&&`into ${i}`}`;return f.jsx(f.Fragment,{children:!!(e!=null&&e.length)&&f.jsx(H,{size:"small",noPadding:!0,transparent:!0,title:M,onClick:C,children:f.jsx(xo,{})})})},[e,r,n,i,C]),P=m.useCallback(()=>f.jsx(f.Fragment,{children:d&&f.jsx(Co,{title:`copy selected items ${i?`into ${i}`:""}`,itemsToCreate:a,onCancel:w,onBulkCreate:F})}),[d,w,F,a,i]),g=m.useCallback(()=>f.jsx(f.Fragment,{children:y&&f.jsx(gn,{title:"No more items can be added",onHide:v,okButtonLabel:"ok",children:f.jsx("p",{className:To.Message,children:"there are already a duplicate item for every original item"})})}),[y,v]),x=m.useCallback(()=>{T(),c([])},[T,c]),_=m.useCallback(()=>{const M=u.length>1?"items were added:":"item was added:";return f.jsx(f.Fragment,{children:A&&f.jsx(gn,{title:M,onHide:x,okButtonLabel:"ok",children:f.jsx("ul",{style:{listStyle:"none",padding:0,textAlign:"left",margin:"1em 0",maxHeight:"90%",overflow:"auto"},children:u.map((N,O)=>f.jsxs("li",{style:{padding:0},children:["-"," ",N.entityType," ",(N==null?void 0:N.name)||""]},O))})})})},[A,x,u]);return{CopySelectedItemsButton:E,CopyingDialog:P,NothingToCopyNotification:g,ItemsWereCopiedNotification:_}}function Pr(t,e){var o;if(!e.locationUuid)return!1;if(t.locationUuid===e.locationUuid)return!0;const r=(o=Zn(t.locationUuid))==null?void 0:o.planetarySystemUuid,i=r?Jn(r):void 0;return i?i.uuid===e.locationUuid:!1}const Eo=t=>[{name:"locationUuid",label:"location",type:"select",options:t,chooseOptionLabel:"choose a location",noOptionsLabel:"no location available",allowToSelectNoValueOption:!0,filterPredicate:Pr},{name:"minQuantity",label:"min quantity",type:"number",min:0,max:Number.MAX_SAFE_INTEGER,filterPredicate:(e,n)=>n.minQuantity===void 0?!0:e.desirableQuantity>=n.minQuantity},{name:"maxQuantity",label:"max quantity",type:"number",min:0,max:Number.MAX_SAFE_INTEGER,filterPredicate:(e,n)=>n.maxQuantity===void 0?!0:e.desirableQuantity<=n.maxQuantity},{name:"minPrice",label:"min price",type:"number",valueType:"float",pattern:"[0-9]+[.][0-9]{2}",min:0,max:Number.MAX_SAFE_INTEGER,step:"0.01",filterPredicate:(e,n)=>n.minPrice===void 0?!0:e.price>=n.minPrice},{name:"maxPrice",label:"max price",type:"number",valueType:"float",pattern:"[0-9]+[.][0-9]{2}",min:0,max:Number.MAX_SAFE_INTEGER,step:"0.01",filterPredicate:(e,n)=>n.maxPrice===void 0?!0:e.price<=n.maxPrice}];function Fo(t){ce(t)?nt.getState().delete(t):ue(t)?rt.getState().delete(t):console.error("Error. Unknown type of order")}const kr=m.memo(function({itemToDelete:e,onHideModal:n,onHideParentModal:r}){const i=G([ct,Z,it,nt,rt]),o=st([ft]),s=i||o,a=m.useMemo(function(){return ce(e)?"sell":ue(e)?"buy":""},[e]),l=m.useCallback(function(){n()},[n]),u=m.useCallback(function(){r()},[r]),c=m.useCallback(function(){s||(Fo(e),tr(e.uuid),l(),u())},[e,l,u,s]),d=m.useMemo(function(){var b;const p=!s&&((b=K(e.productUuid))==null?void 0:b.name)||"(product without name)",y=!s&&It(e.locationUuid)||"(location without name)";return f.jsxs(f.Fragment,{children:["Are you sure you want"," ",f.jsx("strong",{children:"to delete"})," ","the"," ",a," ","order",f.jsx("br",{}),"for"," ",f.jsx("strong",{children:p}),f.jsx("br",{}),"in"," ",f.jsx("strong",{children:y}),"?"]})},[e,s,a]);return f.jsx(hr,{title:d,onHide:l,onConfirm:c,confirmButtonLabel:`delete ${a} order`})}),Pt=ji();function Or(){const{isHydrating:t,isHydrated:e}=Z.getState();if(t||!e)return;const n=Si();Po({productsMap:n})}Pt.setState({prepareData:Or});Z.subscribe(function(){Or()});function Po({productsMap:t}){const e=Pt.getState();e.isProcessing||(e.setIsProcessing(!0),window.setTimeout(function(){const i=Lo({productsMap:t});e.replaceAll(i),e.setIsProcessing(!1)},0))}function ko(t,e=!1,n){const r=(t==null?void 0:t.name)??"(product without name)",i=Qi([r]),o=e?Ri(r,"product"):i;return{productNameWithId:i,productNameWithIdAsLabel:o}}function Oo({productsMap:t,shouldAddSuffixLabel:e=!1}){const n=[];return Mi(t).forEach(function(o){const s=o.uuid,{productNameWithId:a,productNameWithIdAsLabel:l}=ko(o,e);n.push({uuid:s,name:a,label:l})}),n}function Lr(t){t.sort((e,n)=>e.name.localeCompare(n.name)),t.forEach(({items:e})=>Lr(e??[]))}function Ir({items:t=[],level:e=0,disableOptionsWithoutUuid:n=!0,selectOptions:r=new Array}){return t.forEach(i=>{const{label:o,items:s}=i,a=i.uuid,l=a??"";r.push({value:l,label:o,level:e,disabled:n?!a:!1}),s!=null&&s.length&&Ir({items:s,level:e+1,disableOptionsWithoutUuid:n,selectOptions:r})}),r}function Lo({productsMap:t,disableOptionsWithoutUuid:e}){const n=Oo({productsMap:t,shouldAddSuffixLabel:!1});return Lr(n),Ir({items:n,disableOptionsWithoutUuid:e})??[]}const $r="price-at-marks",Io=["uuid","entityType","orderUuid","pricesAtMarks"];ze(Io);const vn=(t,e)=>[{name:"uuid",type:"hidden"},{name:"entityType",type:"hidden"},{name:"locationUuid",label:"location",type:"select",required:!0,options:e,chooseOptionLabel:"choose a location",noOptionsLabel:"no locations available",allowToSelectNoValueOption:!0},{name:"productUuid",label:"product",type:"select",required:!0,options:t,chooseOptionLabel:"choose a product",noOptionsLabel:"no products available",allowToSelectNoValueOption:!0},{name:"desirableQuantity",label:"stock",type:"number",min:0,max:Number.MAX_SAFE_INTEGER},{name:"price",type:"number",required:!0,valueType:"float",pattern:"[0-9]+[.][0-9]{2}?",step:"0.01",min:0,max:Number.MAX_SAFE_INTEGER}],$o=m.memo(function({itemToEdit:e,filterValue:n,onHideModal:r,onShowDeleteItemConfirmation:i,onCreateItem:o,onUpdateItem:s}){const a=G([rt,it,Z,ct,ht]),l=st([gt,ft,Pt]),u=a||l,c=rt(g=>g.create),d=rt(g=>g.update),h=it(g=>g.create),p=it(g=>g.update),y=m.useCallback(g=>{h({entityType:$r,orderUuid:g.uuid,pricesAtMarks:[[g.price,g.desirableQuantity]]})},[h]),b=m.useCallback(g=>{const x=[g.price,g.desirableQuantity],_=Ke(g.uuid);if(_){if(_.pricesAtMarks.find(N=>N[0]===x[0]&&N[1]===x[1]))return;p({..._,pricesAtMarks:_.pricesAtMarks.concat([x])})}else y(g)},[p,y]),v=m.useCallback(g=>{const x=c(g);y(x),typeof o=="function"&&o(x)},[c,o,y]),C=m.useCallback(g=>{const x=d(g);x&&(b(x),typeof s=="function"&&s(x))},[d,s,b]),w=m.useCallback(()=>{r()},[r]),A=m.useCallback(g=>{if(nr(g)){const x=ae(g,Tr);C(x)}else{const x=ae(g,io);x.entityType=qt,v(x)}w()},[w,v,C]),L=m.useCallback(function(x){var M;if(u)return function(){return f.jsx("span",{children:"Loading..."})};const _=Ci(x);if(_){const N=((M=K(_.productUuid))==null?void 0:M.name)||"(product without name)",O=It(_.locationUuid)||"(location without name)";return function(){return f.jsxs("span",{children:["Buy order for"," ",f.jsx("strong",{children:N})," ","in"," ",f.jsx("strong",{children:O})," ","already exists"]})}}},[u]),T=Pt(g=>g.items),F=gt(g=>g.items),E=m.useMemo(function(){return l?vn([],[]):vn(T,F)},[T,F,l]),P=rr(E,n);return f.jsx(ir,{humanizedItemTypeName:"buy order",itemToEdit:e,formFields:P,validateFormData:L,onCancel:w,onSubmit:A,onDelete:i,deleteItemButtonLabel:"delete buy order"})});function ne(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Bo(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function en(t){let e,n,r;t.length!==2?(e=ne,n=(a,l)=>ne(t(a),l),r=(a,l)=>t(a)-l):(e=t===ne||t===Bo?t:jo,n=t,r=t);function i(a,l,u=0,c=a.length){if(u<c){if(e(l,l)!==0)return c;do{const d=u+c>>>1;n(a[d],l)<0?u=d+1:c=d}while(u<c)}return u}function o(a,l,u=0,c=a.length){if(u<c){if(e(l,l)!==0)return c;do{const d=u+c>>>1;n(a[d],l)<=0?u=d+1:c=d}while(u<c)}return u}function s(a,l,u=0,c=a.length){const d=i(a,l,u,c-1);return d>u&&r(a[d-1],l)>-r(a[d],l)?d-1:d}return{left:i,center:s,right:o}}function jo(){return 0}function Ro(t){return t===null?NaN:+t}const Do=en(ne),Uo=Do.right;en(Ro).center;function wn(t,e){let n,r;if(e===void 0)for(const i of t)i!=null&&(n===void 0?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)));else{let i=-1;for(let o of t)(o=e(o,++i,t))!=null&&(n===void 0?o>=o&&(n=r=o):(n>o&&(n=o),r<o&&(r=o)))}return[n,r]}const Ho=Math.sqrt(50),Vo=Math.sqrt(10),Xo=Math.sqrt(2);function fe(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),o=r/Math.pow(10,i),s=o>=Ho?10:o>=Vo?5:o>=Xo?2:1;let a,l,u;return i<0?(u=Math.pow(10,-i)/s,a=Math.round(t*u),l=Math.round(e*u),a/u<t&&++a,l/u>e&&--l,u=-u):(u=Math.pow(10,i)*s,a=Math.round(t/u),l=Math.round(e/u),a*u<t&&++a,l*u>e&&--l),l<a&&.5<=n&&n<2?fe(t,e,n*2):[a,l,u]}function Qo(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[i,o,s]=r?fe(e,t,n):fe(t,e,n);if(!(o>=i))return[];const a=o-i+1,l=new Array(a);if(r)if(s<0)for(let u=0;u<a;++u)l[u]=(o-u)/-s;else for(let u=0;u<a;++u)l[u]=(o-u)*s;else if(s<0)for(let u=0;u<a;++u)l[u]=(i+u)/-s;else for(let u=0;u<a;++u)l[u]=(i+u)*s;return l}function $e(t,e,n){return e=+e,t=+t,n=+n,fe(t,e,n)[2]}function Yo(t,e,n){e=+e,t=+t,n=+n;const r=e<t,i=r?$e(e,t,n):$e(t,e,n);return(r?-1:1)*(i<0?1/-i:i)}function qo(t){return t}var Pe=1,ke=2,Be=3,jt=4,An=1e-6;function Go(t){return"translate("+t+",0)"}function Wo(t){return"translate(0,"+t+")"}function zo(t){return e=>+t(e)}function Ko(t,e){return e=Math.max(0,t.bandwidth()-e*2)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function Zo(){return!this.__axis}function Br(t,e){var n=[],r=null,i=null,o=6,s=6,a=3,l=typeof window<"u"&&window.devicePixelRatio>1?0:.5,u=t===Pe||t===jt?-1:1,c=t===jt||t===ke?"x":"y",d=t===Pe||t===Be?Go:Wo;function h(p){var y=r??(e.ticks?e.ticks.apply(e,n):e.domain()),b=i??(e.tickFormat?e.tickFormat.apply(e,n):qo),v=Math.max(o,0)+a,C=e.range(),w=+C[0]+l,A=+C[C.length-1]+l,L=(e.bandwidth?Ko:zo)(e.copy(),l),T=p.selection?p.selection():p,F=T.selectAll(".domain").data([null]),E=T.selectAll(".tick").data(y,e).order(),P=E.exit(),g=E.enter().append("g").attr("class","tick"),x=E.select("line"),_=E.select("text");F=F.merge(F.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),E=E.merge(g),x=x.merge(g.append("line").attr("stroke","currentColor").attr(c+"2",u*o)),_=_.merge(g.append("text").attr("fill","currentColor").attr(c,u*v).attr("dy",t===Pe?"0em":t===Be?"0.71em":"0.32em")),p!==T&&(F=F.transition(p),E=E.transition(p),x=x.transition(p),_=_.transition(p),P=P.transition(p).attr("opacity",An).attr("transform",function(M){return isFinite(M=L(M))?d(M+l):this.getAttribute("transform")}),g.attr("opacity",An).attr("transform",function(M){var N=this.parentNode.__axis;return d((N&&isFinite(N=N(M))?N:L(M))+l)})),P.remove(),F.attr("d",t===jt||t===ke?s?"M"+u*s+","+w+"H"+l+"V"+A+"H"+u*s:"M"+l+","+w+"V"+A:s?"M"+w+","+u*s+"V"+l+"H"+A+"V"+u*s:"M"+w+","+l+"H"+A),E.attr("opacity",1).attr("transform",function(M){return d(L(M)+l)}),x.attr(c+"2",u*o),_.attr(c,u*v).text(b),T.filter(Zo).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===ke?"start":t===jt?"end":"middle"),T.each(function(){this.__axis=L})}return h.scale=function(p){return arguments.length?(e=p,h):e},h.ticks=function(){return n=Array.from(arguments),h},h.tickArguments=function(p){return arguments.length?(n=p==null?[]:Array.from(p),h):n.slice()},h.tickValues=function(p){return arguments.length?(r=p==null?null:Array.from(p),h):r&&r.slice()},h.tickFormat=function(p){return arguments.length?(i=p,h):i},h.tickSize=function(p){return arguments.length?(o=s=+p,h):o},h.tickSizeInner=function(p){return arguments.length?(o=+p,h):o},h.tickSizeOuter=function(p){return arguments.length?(s=+p,h):s},h.tickPadding=function(p){return arguments.length?(a=+p,h):a},h.offset=function(p){return arguments.length?(l=+p,h):l},h}function Jo(t){return Br(Be,t)}function ts(t){return Br(jt,t)}var es={value:()=>{}};function jr(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new re(n)}function re(t){this._=t}function ns(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}re.prototype=jr.prototype={constructor:re,on:function(t,e){var n=this._,r=ns(t+"",n),i,o=-1,s=r.length;if(arguments.length<2){for(;++o<s;)if((i=(t=r[o]).type)&&(i=rs(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<s;)if(i=(t=r[o]).type)n[i]=Sn(n[i],t.name,e);else if(e==null)for(i in n)n[i]=Sn(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new re(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,o;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=this._[t],r=0,i=o.length;r<i;++r)o[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};function rs(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function Sn(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=es,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var je="http://www.w3.org/1999/xhtml";const Mn={svg:"http://www.w3.org/2000/svg",xhtml:je,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ve(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),Mn.hasOwnProperty(e)?{space:Mn[e],local:t}:t}function is(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===je&&e.documentElement.namespaceURI===je?e.createElement(t):e.createElementNS(n,t)}}function os(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Rr(t){var e=ve(t);return(e.local?os:is)(e)}function ss(){}function nn(t){return t==null?ss:function(){return this.querySelector(t)}}function as(t){typeof t!="function"&&(t=nn(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],s=o.length,a=r[i]=new Array(s),l,u,c=0;c<s;++c)(l=o[c])&&(u=t.call(l,l.__data__,c,o))&&("__data__"in l&&(u.__data__=l.__data__),a[c]=u);return new Y(r,this._parents)}function ls(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function us(){return[]}function Dr(t){return t==null?us:function(){return this.querySelectorAll(t)}}function cs(t){return function(){return ls(t.apply(this,arguments))}}function fs(t){typeof t=="function"?t=cs(t):t=Dr(t);for(var e=this._groups,n=e.length,r=[],i=[],o=0;o<n;++o)for(var s=e[o],a=s.length,l,u=0;u<a;++u)(l=s[u])&&(r.push(t.call(l,l.__data__,u,s)),i.push(l));return new Y(r,i)}function Ur(t){return function(){return this.matches(t)}}function Hr(t){return function(e){return e.matches(t)}}var ds=Array.prototype.find;function hs(t){return function(){return ds.call(this.children,t)}}function ms(){return this.firstElementChild}function ps(t){return this.select(t==null?ms:hs(typeof t=="function"?t:Hr(t)))}var ys=Array.prototype.filter;function gs(){return Array.from(this.children)}function xs(t){return function(){return ys.call(this.children,t)}}function _s(t){return this.selectAll(t==null?gs:xs(typeof t=="function"?t:Hr(t)))}function bs(t){typeof t!="function"&&(t=Ur(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],s=o.length,a=r[i]=[],l,u=0;u<s;++u)(l=o[u])&&t.call(l,l.__data__,u,o)&&a.push(l);return new Y(r,this._parents)}function Vr(t){return new Array(t.length)}function vs(){return new Y(this._enter||this._groups.map(Vr),this._parents)}function de(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}de.prototype={constructor:de,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function ws(t){return function(){return t}}function As(t,e,n,r,i,o){for(var s=0,a,l=e.length,u=o.length;s<u;++s)(a=e[s])?(a.__data__=o[s],r[s]=a):n[s]=new de(t,o[s]);for(;s<l;++s)(a=e[s])&&(i[s]=a)}function Ss(t,e,n,r,i,o,s){var a,l,u=new Map,c=e.length,d=o.length,h=new Array(c),p;for(a=0;a<c;++a)(l=e[a])&&(h[a]=p=s.call(l,l.__data__,a,e)+"",u.has(p)?i[a]=l:u.set(p,l));for(a=0;a<d;++a)p=s.call(t,o[a],a,o)+"",(l=u.get(p))?(r[a]=l,l.__data__=o[a],u.delete(p)):n[a]=new de(t,o[a]);for(a=0;a<c;++a)(l=e[a])&&u.get(h[a])===l&&(i[a]=l)}function Ms(t){return t.__data__}function Cs(t,e){if(!arguments.length)return Array.from(this,Ms);var n=e?Ss:As,r=this._parents,i=this._groups;typeof t!="function"&&(t=ws(t));for(var o=i.length,s=new Array(o),a=new Array(o),l=new Array(o),u=0;u<o;++u){var c=r[u],d=i[u],h=d.length,p=Ns(t.call(c,c&&c.__data__,u,r)),y=p.length,b=a[u]=new Array(y),v=s[u]=new Array(y),C=l[u]=new Array(h);n(c,d,b,v,C,p,e);for(var w=0,A=0,L,T;w<y;++w)if(L=b[w]){for(w>=A&&(A=w+1);!(T=v[A])&&++A<y;);L._next=T||null}}return s=new Y(s,r),s._enter=a,s._exit=l,s}function Ns(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Ts(){return new Y(this._exit||this._groups.map(Vr),this._parents)}function Es(t,e,n){var r=this.enter(),i=this,o=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?o.remove():n(o),r&&i?r.merge(i).order():i}function Fs(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,o=r.length,s=Math.min(i,o),a=new Array(i),l=0;l<s;++l)for(var u=n[l],c=r[l],d=u.length,h=a[l]=new Array(d),p,y=0;y<d;++y)(p=u[y]||c[y])&&(h[y]=p);for(;l<i;++l)a[l]=n[l];return new Y(a,this._parents)}function Ps(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,o=r[i],s;--i>=0;)(s=r[i])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function ks(t){t||(t=Os);function e(d,h){return d&&h?t(d.__data__,h.__data__):!d-!h}for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var s=n[o],a=s.length,l=i[o]=new Array(a),u,c=0;c<a;++c)(u=s[c])&&(l[c]=u);l.sort(e)}return new Y(i,this._parents).order()}function Os(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Ls(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Is(){return Array.from(this)}function $s(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var s=r[i];if(s)return s}return null}function Bs(){let t=0;for(const e of this)++t;return t}function js(){return!this.node()}function Rs(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],o=0,s=i.length,a;o<s;++o)(a=i[o])&&t.call(a,a.__data__,o,i);return this}function Ds(t){return function(){this.removeAttribute(t)}}function Us(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Hs(t,e){return function(){this.setAttribute(t,e)}}function Vs(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Xs(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Qs(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Ys(t,e){var n=ve(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?Us:Ds:typeof e=="function"?n.local?Qs:Xs:n.local?Vs:Hs)(n,e))}function Xr(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function qs(t){return function(){this.style.removeProperty(t)}}function Gs(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Ws(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function zs(t,e,n){return arguments.length>1?this.each((e==null?qs:typeof e=="function"?Ws:Gs)(t,e,n??"")):kt(this.node(),t)}function kt(t,e){return t.style.getPropertyValue(e)||Xr(t).getComputedStyle(t,null).getPropertyValue(e)}function Ks(t){return function(){delete this[t]}}function Zs(t,e){return function(){this[t]=e}}function Js(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function ta(t,e){return arguments.length>1?this.each((e==null?Ks:typeof e=="function"?Js:Zs)(t,e)):this.node()[t]}function Qr(t){return t.trim().split(/^|\s+/)}function rn(t){return t.classList||new Yr(t)}function Yr(t){this._node=t,this._names=Qr(t.getAttribute("class")||"")}Yr.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function qr(t,e){for(var n=rn(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function Gr(t,e){for(var n=rn(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function ea(t){return function(){qr(this,t)}}function na(t){return function(){Gr(this,t)}}function ra(t,e){return function(){(e.apply(this,arguments)?qr:Gr)(this,t)}}function ia(t,e){var n=Qr(t+"");if(arguments.length<2){for(var r=rn(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?ra:e?ea:na)(n,e))}function oa(){this.textContent=""}function sa(t){return function(){this.textContent=t}}function aa(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function la(t){return arguments.length?this.each(t==null?oa:(typeof t=="function"?aa:sa)(t)):this.node().textContent}function ua(){this.innerHTML=""}function ca(t){return function(){this.innerHTML=t}}function fa(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function da(t){return arguments.length?this.each(t==null?ua:(typeof t=="function"?fa:ca)(t)):this.node().innerHTML}function ha(){this.nextSibling&&this.parentNode.appendChild(this)}function ma(){return this.each(ha)}function pa(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ya(){return this.each(pa)}function ga(t){var e=typeof t=="function"?t:Rr(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function xa(){return null}function _a(t,e){var n=typeof t=="function"?t:Rr(t),r=e==null?xa:typeof e=="function"?e:nn(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function ba(){var t=this.parentNode;t&&t.removeChild(this)}function va(){return this.each(ba)}function wa(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Aa(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Sa(t){return this.select(t?Aa:wa)}function Ma(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Ca(t){return function(e){t.call(this,e,this.__data__)}}function Na(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function Ta(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,o;n<i;++n)o=e[n],(!t.type||o.type===t.type)&&o.name===t.name?this.removeEventListener(o.type,o.listener,o.options):e[++r]=o;++r?e.length=r:delete this.__on}}}function Ea(t,e,n){return function(){var r=this.__on,i,o=Ca(e);if(r){for(var s=0,a=r.length;s<a;++s)if((i=r[s]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),i.value=e;return}}this.addEventListener(t.type,o,n),i={type:t.type,name:t.name,value:e,listener:o,options:n},r?r.push(i):this.__on=[i]}}function Fa(t,e,n){var r=Na(t+""),i,o=r.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,u=a.length,c;l<u;++l)for(i=0,c=a[l];i<o;++i)if((s=r[i]).type===c.type&&s.name===c.name)return c.value}return}for(a=e?Ea:Ta,i=0;i<o;++i)this.each(a(r[i],e,n));return this}function Wr(t,e,n){var r=Xr(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function Pa(t,e){return function(){return Wr(this,t,e)}}function ka(t,e){return function(){return Wr(this,t,e.apply(this,arguments))}}function Oa(t,e){return this.each((typeof e=="function"?ka:Pa)(t,e))}function*La(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length,s;i<o;++i)(s=r[i])&&(yield s)}var zr=[null];function Y(t,e){this._groups=t,this._parents=e}function Wt(){return new Y([[document.documentElement]],zr)}function Ia(){return this}Y.prototype=Wt.prototype={constructor:Y,select:as,selectAll:fs,selectChild:ps,selectChildren:_s,filter:bs,data:Cs,enter:vs,exit:Ts,join:Es,merge:Fs,selection:Ia,order:Ps,sort:ks,call:Ls,nodes:Is,node:$s,size:Bs,empty:js,each:Rs,attr:Ys,style:zs,property:ta,classed:ia,text:la,html:da,raise:ma,lower:ya,append:ga,insert:_a,remove:va,clone:Sa,datum:Ma,on:Fa,dispatch:Oa,[Symbol.iterator]:La};function Cn(t){return typeof t=="string"?new Y([[document.querySelector(t)]],[document.documentElement]):new Y([[t]],zr)}function $a(t){let e;for(;e=t.sourceEvent;)t=e;return t}function Ba(t,e){if(t=$a(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}function on(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Kr(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function zt(){}var Xt=.7,he=1/Xt,Ft="\\s*([+-]?\\d+)\\s*",Qt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ot="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ja=/^#([0-9a-f]{3,8})$/,Ra=new RegExp(`^rgb\\(${Ft},${Ft},${Ft}\\)$`),Da=new RegExp(`^rgb\\(${ot},${ot},${ot}\\)$`),Ua=new RegExp(`^rgba\\(${Ft},${Ft},${Ft},${Qt}\\)$`),Ha=new RegExp(`^rgba\\(${ot},${ot},${ot},${Qt}\\)$`),Va=new RegExp(`^hsl\\(${Qt},${ot},${ot}\\)$`),Xa=new RegExp(`^hsla\\(${Qt},${ot},${ot},${Qt}\\)$`),Nn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};on(zt,xt,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Tn,formatHex:Tn,formatHex8:Qa,formatHsl:Ya,formatRgb:En,toString:En});function Tn(){return this.rgb().formatHex()}function Qa(){return this.rgb().formatHex8()}function Ya(){return Zr(this).formatHsl()}function En(){return this.rgb().formatRgb()}function xt(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=ja.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Fn(e):n===3?new X(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Zt(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Zt(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Ra.exec(t))?new X(e[1],e[2],e[3],1):(e=Da.exec(t))?new X(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Ua.exec(t))?Zt(e[1],e[2],e[3],e[4]):(e=Ha.exec(t))?Zt(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Va.exec(t))?On(e[1],e[2]/100,e[3]/100,1):(e=Xa.exec(t))?On(e[1],e[2]/100,e[3]/100,e[4]):Nn.hasOwnProperty(t)?Fn(Nn[t]):t==="transparent"?new X(NaN,NaN,NaN,0):null}function Fn(t){return new X(t>>16&255,t>>8&255,t&255,1)}function Zt(t,e,n,r){return r<=0&&(t=e=n=NaN),new X(t,e,n,r)}function qa(t){return t instanceof zt||(t=xt(t)),t?(t=t.rgb(),new X(t.r,t.g,t.b,t.opacity)):new X}function Re(t,e,n,r){return arguments.length===1?qa(t):new X(t,e,n,r??1)}function X(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}on(X,Re,Kr(zt,{brighter(t){return t=t==null?he:Math.pow(he,t),new X(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Xt:Math.pow(Xt,t),new X(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new X(yt(this.r),yt(this.g),yt(this.b),me(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Pn,formatHex:Pn,formatHex8:Ga,formatRgb:kn,toString:kn}));function Pn(){return`#${pt(this.r)}${pt(this.g)}${pt(this.b)}`}function Ga(){return`#${pt(this.r)}${pt(this.g)}${pt(this.b)}${pt((isNaN(this.opacity)?1:this.opacity)*255)}`}function kn(){const t=me(this.opacity);return`${t===1?"rgb(":"rgba("}${yt(this.r)}, ${yt(this.g)}, ${yt(this.b)}${t===1?")":`, ${t})`}`}function me(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function yt(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function pt(t){return t=yt(t),(t<16?"0":"")+t.toString(16)}function On(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new z(t,e,n,r)}function Zr(t){if(t instanceof z)return new z(t.h,t.s,t.l,t.opacity);if(t instanceof zt||(t=xt(t)),!t)return new z;if(t instanceof z)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),s=NaN,a=o-i,l=(o+i)/2;return a?(e===o?s=(n-r)/a+(n<r)*6:n===o?s=(r-e)/a+2:s=(e-n)/a+4,a/=l<.5?o+i:2-o-i,s*=60):a=l>0&&l<1?0:s,new z(s,a,l,t.opacity)}function Wa(t,e,n,r){return arguments.length===1?Zr(t):new z(t,e,n,r??1)}function z(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}on(z,Wa,Kr(zt,{brighter(t){return t=t==null?he:Math.pow(he,t),new z(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Xt:Math.pow(Xt,t),new z(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new X(Oe(t>=240?t-240:t+120,i,r),Oe(t,i,r),Oe(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new z(Ln(this.h),Jt(this.s),Jt(this.l),me(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=me(this.opacity);return`${t===1?"hsl(":"hsla("}${Ln(this.h)}, ${Jt(this.s)*100}%, ${Jt(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Ln(t){return t=(t||0)%360,t<0?t+360:t}function Jt(t){return Math.max(0,Math.min(1,t||0))}function Oe(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const sn=t=>()=>t;function za(t,e){return function(n){return t+n*e}}function Ka(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function Za(t){return(t=+t)==1?Jr:function(e,n){return n-e?Ka(e,n,t):sn(isNaN(e)?n:e)}}function Jr(t,e){var n=e-t;return n?za(t,n):sn(isNaN(t)?e:t)}const pe=function t(e){var n=Za(e);function r(i,o){var s=n((i=Re(i)).r,(o=Re(o)).r),a=n(i.g,o.g),l=n(i.b,o.b),u=Jr(i.opacity,o.opacity);return function(c){return i.r=s(c),i.g=a(c),i.b=l(c),i.opacity=u(c),i+""}}return r.gamma=t,r}(1);function Ja(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),i;return function(o){for(i=0;i<n;++i)r[i]=t[i]*(1-o)+e[i]*o;return r}}function tl(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function el(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,i=new Array(r),o=new Array(n),s;for(s=0;s<r;++s)i[s]=an(t[s],e[s]);for(;s<n;++s)o[s]=e[s];return function(a){for(s=0;s<r;++s)o[s]=i[s](a);return o}}function nl(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function W(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function rl(t,e){var n={},r={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?n[i]=an(t[i],e[i]):r[i]=e[i];return function(o){for(i in n)r[i]=n[i](o);return r}}var De=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Le=new RegExp(De.source,"g");function il(t){return function(){return t}}function ol(t){return function(e){return t(e)+""}}function ti(t,e){var n=De.lastIndex=Le.lastIndex=0,r,i,o,s=-1,a=[],l=[];for(t=t+"",e=e+"";(r=De.exec(t))&&(i=Le.exec(e));)(o=i.index)>n&&(o=e.slice(n,o),a[s]?a[s]+=o:a[++s]=o),(r=r[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,l.push({i:s,x:W(r,i)})),n=Le.lastIndex;return n<e.length&&(o=e.slice(n),a[s]?a[s]+=o:a[++s]=o),a.length<2?l[0]?ol(l[0].x):il(e):(e=l.length,function(u){for(var c=0,d;c<e;++c)a[(d=l[c]).i]=d.x(u);return a.join("")})}function an(t,e){var n=typeof e,r;return e==null||n==="boolean"?sn(e):(n==="number"?W:n==="string"?(r=xt(e))?(e=r,pe):ti:e instanceof xt?pe:e instanceof Date?nl:tl(e)?Ja:Array.isArray(e)?el:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?rl:W)(t,e)}function sl(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var In=180/Math.PI,Ue={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function ei(t,e,n,r,i,o){var s,a,l;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(l=t*n+e*r)&&(n-=t*l,r-=e*l),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,l/=a),t*r<e*n&&(t=-t,e=-e,l=-l,s=-s),{translateX:i,translateY:o,rotate:Math.atan2(e,t)*In,skewX:Math.atan(l)*In,scaleX:s,scaleY:a}}var te;function al(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Ue:ei(e.a,e.b,e.c,e.d,e.e,e.f)}function ll(t){return t==null||(te||(te=document.createElementNS("http://www.w3.org/2000/svg","g")),te.setAttribute("transform",t),!(t=te.transform.baseVal.consolidate()))?Ue:(t=t.matrix,ei(t.a,t.b,t.c,t.d,t.e,t.f))}function ni(t,e,n,r){function i(u){return u.length?u.pop()+" ":""}function o(u,c,d,h,p,y){if(u!==d||c!==h){var b=p.push("translate(",null,e,null,n);y.push({i:b-4,x:W(u,d)},{i:b-2,x:W(c,h)})}else(d||h)&&p.push("translate("+d+e+h+n)}function s(u,c,d,h){u!==c?(u-c>180?c+=360:c-u>180&&(u+=360),h.push({i:d.push(i(d)+"rotate(",null,r)-2,x:W(u,c)})):c&&d.push(i(d)+"rotate("+c+r)}function a(u,c,d,h){u!==c?h.push({i:d.push(i(d)+"skewX(",null,r)-2,x:W(u,c)}):c&&d.push(i(d)+"skewX("+c+r)}function l(u,c,d,h,p,y){if(u!==d||c!==h){var b=p.push(i(p)+"scale(",null,",",null,")");y.push({i:b-4,x:W(u,d)},{i:b-2,x:W(c,h)})}else(d!==1||h!==1)&&p.push(i(p)+"scale("+d+","+h+")")}return function(u,c){var d=[],h=[];return u=t(u),c=t(c),o(u.translateX,u.translateY,c.translateX,c.translateY,d,h),s(u.rotate,c.rotate,d,h),a(u.skewX,c.skewX,d,h),l(u.scaleX,u.scaleY,c.scaleX,c.scaleY,d,h),u=c=null,function(p){for(var y=-1,b=h.length,v;++y<b;)d[(v=h[y]).i]=v.x(p);return d.join("")}}}var ul=ni(al,"px, ","px)","deg)"),cl=ni(ll,", ",")",")"),Ot=0,Rt=0,Bt=0,ri=1e3,ye,Dt,ge=0,_t=0,we=0,Yt=typeof performance=="object"&&performance.now?performance:Date,ii=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function ln(){return _t||(ii(fl),_t=Yt.now()+we)}function fl(){_t=0}function xe(){this._call=this._time=this._next=null}xe.prototype=oi.prototype={constructor:xe,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?ln():+n)+(e==null?0:+e),!this._next&&Dt!==this&&(Dt?Dt._next=this:ye=this,Dt=this),this._call=t,this._time=n,He()},stop:function(){this._call&&(this._call=null,this._time=1/0,He())}};function oi(t,e,n){var r=new xe;return r.restart(t,e,n),r}function dl(){ln(),++Ot;for(var t=ye,e;t;)(e=_t-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Ot}function $n(){_t=(ge=Yt.now())+we,Ot=Rt=0;try{dl()}finally{Ot=0,ml(),_t=0}}function hl(){var t=Yt.now(),e=t-ge;e>ri&&(we-=e,ge=t)}function ml(){for(var t,e=ye,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:ye=n);Dt=t,He(r)}function He(t){if(!Ot){Rt&&(Rt=clearTimeout(Rt));var e=t-_t;e>24?(t<1/0&&(Rt=setTimeout($n,t-Yt.now()-we)),Bt&&(Bt=clearInterval(Bt))):(Bt||(ge=Yt.now(),Bt=setInterval(hl,ri)),Ot=1,ii($n))}}function Bn(t,e,n){var r=new xe;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var pl=jr("start","end","cancel","interrupt"),yl=[],si=0,jn=1,Ve=2,ie=3,Rn=4,Xe=5,oe=6;function Ae(t,e,n,r,i,o){var s=t.__transition;if(!s)t.__transition={};else if(n in s)return;gl(t,n,{name:e,index:r,group:i,on:pl,tween:yl,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:si})}function un(t,e){var n=J(t,e);if(n.state>si)throw new Error("too late; already scheduled");return n}function at(t,e){var n=J(t,e);if(n.state>ie)throw new Error("too late; already running");return n}function J(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function gl(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=oi(o,0,n.time);function o(u){n.state=jn,n.timer.restart(s,n.delay,n.time),n.delay<=u&&s(u-n.delay)}function s(u){var c,d,h,p;if(n.state!==jn)return l();for(c in r)if(p=r[c],p.name===n.name){if(p.state===ie)return Bn(s);p.state===Rn?(p.state=oe,p.timer.stop(),p.on.call("interrupt",t,t.__data__,p.index,p.group),delete r[c]):+c<e&&(p.state=oe,p.timer.stop(),p.on.call("cancel",t,t.__data__,p.index,p.group),delete r[c])}if(Bn(function(){n.state===ie&&(n.state=Rn,n.timer.restart(a,n.delay,n.time),a(u))}),n.state=Ve,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Ve){for(n.state=ie,i=new Array(h=n.tween.length),c=0,d=-1;c<h;++c)(p=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(i[++d]=p);i.length=d+1}}function a(u){for(var c=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(l),n.state=Xe,1),d=-1,h=i.length;++d<h;)i[d].call(t,c);n.state===Xe&&(n.on.call("end",t,t.__data__,n.index,n.group),l())}function l(){n.state=oe,n.timer.stop(),delete r[e];for(var u in r)return;delete t.__transition}}function xl(t,e){var n=t.__transition,r,i,o=!0,s;if(n){e=e==null?null:e+"";for(s in n){if((r=n[s]).name!==e){o=!1;continue}i=r.state>Ve&&r.state<Xe,r.state=oe,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[s]}o&&delete t.__transition}}function _l(t){return this.each(function(){xl(this,t)})}function bl(t,e){var n,r;return function(){var i=at(this,t),o=i.tween;if(o!==n){r=n=o;for(var s=0,a=r.length;s<a;++s)if(r[s].name===e){r=r.slice(),r.splice(s,1);break}}i.tween=r}}function vl(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var o=at(this,t),s=o.tween;if(s!==r){i=(r=s).slice();for(var a={name:e,value:n},l=0,u=i.length;l<u;++l)if(i[l].name===e){i[l]=a;break}l===u&&i.push(a)}o.tween=i}}function wl(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=J(this.node(),n).tween,i=0,o=r.length,s;i<o;++i)if((s=r[i]).name===t)return s.value;return null}return this.each((e==null?bl:vl)(n,t,e))}function cn(t,e,n){var r=t._id;return t.each(function(){var i=at(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return J(i,r).value[e]}}function ai(t,e){var n;return(typeof e=="number"?W:e instanceof xt?pe:(n=xt(e))?(e=n,pe):ti)(t,e)}function Al(t){return function(){this.removeAttribute(t)}}function Sl(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Ml(t,e,n){var r,i=n+"",o;return function(){var s=this.getAttribute(t);return s===i?null:s===r?o:o=e(r=s,n)}}function Cl(t,e,n){var r,i=n+"",o;return function(){var s=this.getAttributeNS(t.space,t.local);return s===i?null:s===r?o:o=e(r=s,n)}}function Nl(t,e,n){var r,i,o;return function(){var s,a=n(this),l;return a==null?void this.removeAttribute(t):(s=this.getAttribute(t),l=a+"",s===l?null:s===r&&l===i?o:(i=l,o=e(r=s,a)))}}function Tl(t,e,n){var r,i,o;return function(){var s,a=n(this),l;return a==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),l=a+"",s===l?null:s===r&&l===i?o:(i=l,o=e(r=s,a)))}}function El(t,e){var n=ve(t),r=n==="transform"?cl:ai;return this.attrTween(t,typeof e=="function"?(n.local?Tl:Nl)(n,r,cn(this,"attr."+t,e)):e==null?(n.local?Sl:Al)(n):(n.local?Cl:Ml)(n,r,e))}function Fl(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function Pl(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function kl(t,e){var n,r;function i(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&Pl(t,o)),n}return i._value=e,i}function Ol(t,e){var n,r;function i(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&Fl(t,o)),n}return i._value=e,i}function Ll(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=ve(t);return this.tween(n,(r.local?kl:Ol)(r,e))}function Il(t,e){return function(){un(this,t).delay=+e.apply(this,arguments)}}function $l(t,e){return e=+e,function(){un(this,t).delay=e}}function Bl(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Il:$l)(e,t)):J(this.node(),e).delay}function jl(t,e){return function(){at(this,t).duration=+e.apply(this,arguments)}}function Rl(t,e){return e=+e,function(){at(this,t).duration=e}}function Dl(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?jl:Rl)(e,t)):J(this.node(),e).duration}function Ul(t,e){if(typeof e!="function")throw new Error;return function(){at(this,t).ease=e}}function Hl(t){var e=this._id;return arguments.length?this.each(Ul(e,t)):J(this.node(),e).ease}function Vl(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;at(this,t).ease=n}}function Xl(t){if(typeof t!="function")throw new Error;return this.each(Vl(this._id,t))}function Ql(t){typeof t!="function"&&(t=Ur(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],s=o.length,a=r[i]=[],l,u=0;u<s;++u)(l=o[u])&&t.call(l,l.__data__,u,o)&&a.push(l);return new ut(r,this._parents,this._name,this._id)}function Yl(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),s=new Array(r),a=0;a<o;++a)for(var l=e[a],u=n[a],c=l.length,d=s[a]=new Array(c),h,p=0;p<c;++p)(h=l[p]||u[p])&&(d[p]=h);for(;a<r;++a)s[a]=e[a];return new ut(s,this._parents,this._name,this._id)}function ql(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Gl(t,e,n){var r,i,o=ql(e)?un:at;return function(){var s=o(this,t),a=s.on;a!==r&&(i=(r=a).copy()).on(e,n),s.on=i}}function Wl(t,e){var n=this._id;return arguments.length<2?J(this.node(),n).on.on(t):this.each(Gl(n,t,e))}function zl(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function Kl(){return this.on("end.remove",zl(this._id))}function Zl(t){var e=this._name,n=this._id;typeof t!="function"&&(t=nn(t));for(var r=this._groups,i=r.length,o=new Array(i),s=0;s<i;++s)for(var a=r[s],l=a.length,u=o[s]=new Array(l),c,d,h=0;h<l;++h)(c=a[h])&&(d=t.call(c,c.__data__,h,a))&&("__data__"in c&&(d.__data__=c.__data__),u[h]=d,Ae(u[h],e,n,h,u,J(c,n)));return new ut(o,this._parents,e,n)}function Jl(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Dr(t));for(var r=this._groups,i=r.length,o=[],s=[],a=0;a<i;++a)for(var l=r[a],u=l.length,c,d=0;d<u;++d)if(c=l[d]){for(var h=t.call(c,c.__data__,d,l),p,y=J(c,n),b=0,v=h.length;b<v;++b)(p=h[b])&&Ae(p,e,n,b,h,y);o.push(h),s.push(c)}return new ut(o,s,e,n)}var tu=Wt.prototype.constructor;function eu(){return new tu(this._groups,this._parents)}function nu(t,e){var n,r,i;return function(){var o=kt(this,t),s=(this.style.removeProperty(t),kt(this,t));return o===s?null:o===n&&s===r?i:i=e(n=o,r=s)}}function li(t){return function(){this.style.removeProperty(t)}}function ru(t,e,n){var r,i=n+"",o;return function(){var s=kt(this,t);return s===i?null:s===r?o:o=e(r=s,n)}}function iu(t,e,n){var r,i,o;return function(){var s=kt(this,t),a=n(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(t),kt(this,t))),s===l?null:s===r&&l===i?o:(i=l,o=e(r=s,a))}}function ou(t,e){var n,r,i,o="style."+e,s="end."+o,a;return function(){var l=at(this,t),u=l.on,c=l.value[o]==null?a||(a=li(e)):void 0;(u!==n||i!==c)&&(r=(n=u).copy()).on(s,i=c),l.on=r}}function su(t,e,n){var r=(t+="")=="transform"?ul:ai;return e==null?this.styleTween(t,nu(t,r)).on("end.style."+t,li(t)):typeof e=="function"?this.styleTween(t,iu(t,r,cn(this,"style."+t,e))).each(ou(this._id,t)):this.styleTween(t,ru(t,r,e),n).on("end.style."+t,null)}function au(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function lu(t,e,n){var r,i;function o(){var s=e.apply(this,arguments);return s!==i&&(r=(i=s)&&au(t,s,n)),r}return o._value=e,o}function uu(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,lu(t,e,n??""))}function cu(t){return function(){this.textContent=t}}function fu(t){return function(){var e=t(this);this.textContent=e??""}}function du(t){return this.tween("text",typeof t=="function"?fu(cn(this,"text",t)):cu(t==null?"":t+""))}function hu(t){return function(e){this.textContent=t.call(this,e)}}function mu(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&hu(i)),e}return r._value=t,r}function pu(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,mu(t))}function yu(){for(var t=this._name,e=this._id,n=ui(),r=this._groups,i=r.length,o=0;o<i;++o)for(var s=r[o],a=s.length,l,u=0;u<a;++u)if(l=s[u]){var c=J(l,e);Ae(l,t,n,u,s,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new ut(r,this._parents,t,n)}function gu(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(o,s){var a={value:s},l={value:function(){--i===0&&o()}};n.each(function(){var u=at(this,r),c=u.on;c!==t&&(e=(t=c).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),u.on=e}),i===0&&o()})}var xu=0;function ut(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function ui(){return++xu}var lt=Wt.prototype;ut.prototype={constructor:ut,select:Zl,selectAll:Jl,selectChild:lt.selectChild,selectChildren:lt.selectChildren,filter:Ql,merge:Yl,selection:eu,transition:yu,call:lt.call,nodes:lt.nodes,node:lt.node,size:lt.size,empty:lt.empty,each:lt.each,on:Wl,attr:El,attrTween:Ll,style:su,styleTween:uu,text:du,textTween:pu,remove:Kl,tween:wl,delay:Bl,duration:Dl,ease:Hl,easeVarying:Xl,end:gu,[Symbol.iterator]:lt[Symbol.iterator]};function _u(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var bu={time:null,delay:0,duration:250,ease:_u};function vu(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function wu(t){var e,n;t instanceof ut?(e=t._id,t=t._name):(e=ui(),(n=bu).time=ln(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var s=r[o],a=s.length,l,u=0;u<a;++u)(l=s[u])&&Ae(l,t,e,u,s,n||vu(l,e));return new ut(r,this._parents,t,e)}Wt.prototype.interrupt=_l;Wt.prototype.transition=wu;const Qe=Math.PI,Ye=2*Qe,mt=1e-6,Au=Ye-mt;function ci(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function Su(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return ci;const n=10**e;return function(r){this._+=r[0];for(let i=1,o=r.length;i<o;++i)this._+=Math.round(arguments[i]*n)/n+r[i]}}class Mu{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?ci:Su(e)}moveTo(e,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,n){this._append`L${this._x1=+e},${this._y1=+n}`}quadraticCurveTo(e,n,r,i){this._append`Q${+e},${+n},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(e,n,r,i,o,s){this._append`C${+e},${+n},${+r},${+i},${this._x1=+o},${this._y1=+s}`}arcTo(e,n,r,i,o){if(e=+e,n=+n,r=+r,i=+i,o=+o,o<0)throw new Error(`negative radius: ${o}`);let s=this._x1,a=this._y1,l=r-e,u=i-n,c=s-e,d=a-n,h=c*c+d*d;if(this._x1===null)this._append`M${this._x1=e},${this._y1=n}`;else if(h>mt)if(!(Math.abs(d*l-u*c)>mt)||!o)this._append`L${this._x1=e},${this._y1=n}`;else{let p=r-s,y=i-a,b=l*l+u*u,v=p*p+y*y,C=Math.sqrt(b),w=Math.sqrt(h),A=o*Math.tan((Qe-Math.acos((b+h-v)/(2*C*w)))/2),L=A/w,T=A/C;Math.abs(L-1)>mt&&this._append`L${e+L*c},${n+L*d}`,this._append`A${o},${o},0,0,${+(d*p>c*y)},${this._x1=e+T*l},${this._y1=n+T*u}`}}arc(e,n,r,i,o,s){if(e=+e,n=+n,r=+r,s=!!s,r<0)throw new Error(`negative radius: ${r}`);let a=r*Math.cos(i),l=r*Math.sin(i),u=e+a,c=n+l,d=1^s,h=s?i-o:o-i;this._x1===null?this._append`M${u},${c}`:(Math.abs(this._x1-u)>mt||Math.abs(this._y1-c)>mt)&&this._append`L${u},${c}`,r&&(h<0&&(h=h%Ye+Ye),h>Au?this._append`A${r},${r},0,1,${d},${e-a},${n-l}A${r},${r},0,1,${d},${this._x1=u},${this._y1=c}`:h>mt&&this._append`A${r},${r},0,${+(h>=Qe)},${d},${this._x1=e+r*Math.cos(o)},${this._y1=n+r*Math.sin(o)}`)}rect(e,n,r,i){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${r=+r}v${+i}h${-r}Z`}toString(){return this._}}function Cu(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function _e(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Lt(t){return t=_e(Math.abs(t)),t?t[1]:NaN}function Nu(t,e){return function(n,r){for(var i=n.length,o=[],s=0,a=t[0],l=0;i>0&&a>0&&(l+a+1>r&&(a=Math.max(1,r-l)),o.push(n.substring(i-=a,i+a)),!((l+=a+1)>r));)a=t[s=(s+1)%t.length];return o.reverse().join(e)}}function Tu(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var Eu=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function be(t){if(!(e=Eu.exec(t)))throw new Error("invalid format: "+t);var e;return new fn({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}be.prototype=fn.prototype;function fn(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}fn.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Fu(t){t:for(var e=t.length,n=1,r=-1,i;n<e;++n)switch(t[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+t[n])break t;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(i+1):t}var fi;function Pu(t,e){var n=_e(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(fi=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,s=r.length;return o===s?r:o>s?r+new Array(o-s+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+_e(t,Math.max(0,e+o-1))[0]}function Dn(t,e){var n=_e(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const Un={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Cu,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Dn(t*100,e),r:Dn,s:Pu,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Hn(t){return t}var Vn=Array.prototype.map,Xn=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function ku(t){var e=t.grouping===void 0||t.thousands===void 0?Hn:Nu(Vn.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",o=t.numerals===void 0?Hn:Tu(Vn.call(t.numerals,String)),s=t.percent===void 0?"%":t.percent+"",a=t.minus===void 0?"−":t.minus+"",l=t.nan===void 0?"NaN":t.nan+"";function u(d){d=be(d);var h=d.fill,p=d.align,y=d.sign,b=d.symbol,v=d.zero,C=d.width,w=d.comma,A=d.precision,L=d.trim,T=d.type;T==="n"?(w=!0,T="g"):Un[T]||(A===void 0&&(A=12),L=!0,T="g"),(v||h==="0"&&p==="=")&&(v=!0,h="0",p="=");var F=b==="$"?n:b==="#"&&/[boxX]/.test(T)?"0"+T.toLowerCase():"",E=b==="$"?r:/[%p]/.test(T)?s:"",P=Un[T],g=/[defgprs%]/.test(T);A=A===void 0?6:/[gprs]/.test(T)?Math.max(1,Math.min(21,A)):Math.max(0,Math.min(20,A));function x(_){var M=F,N=E,O,q,V;if(T==="c")N=P(_)+N,_="";else{_=+_;var I=_<0||1/_<0;if(_=isNaN(_)?l:P(Math.abs(_),A),L&&(_=Fu(_)),I&&+_==0&&y!=="+"&&(I=!1),M=(I?y==="("?y:a:y==="-"||y==="("?"":y)+M,N=(T==="s"?Xn[8+fi/3]:"")+N+(I&&y==="("?")":""),g){for(O=-1,q=_.length;++O<q;)if(V=_.charCodeAt(O),48>V||V>57){N=(V===46?i+_.slice(O+1):_.slice(O))+N,_=_.slice(0,O);break}}}w&&!v&&(_=e(_,1/0));var k=M.length+_.length+N.length,B=k<C?new Array(C-k+1).join(h):"";switch(w&&v&&(_=e(B+_,B.length?C-N.length:1/0),B=""),p){case"<":_=M+_+N+B;break;case"=":_=M+B+_+N;break;case"^":_=B.slice(0,k=B.length>>1)+M+_+N+B.slice(k);break;default:_=B+M+_+N;break}return o(_)}return x.toString=function(){return d+""},x}function c(d,h){var p=u((d=be(d),d.type="f",d)),y=Math.max(-8,Math.min(8,Math.floor(Lt(h)/3)))*3,b=Math.pow(10,-y),v=Xn[8+y/3];return function(C){return p(b*C)+v}}return{format:u,formatPrefix:c}}var ee,Se,di;Ou({thousands:",",grouping:[3],currency:["$",""]});function Ou(t){return ee=ku(t),Se=ee.format,di=ee.formatPrefix,ee}function Lu(t){return Math.max(0,-Lt(Math.abs(t)))}function Iu(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Lt(e)/3)))*3-Lt(Math.abs(t)))}function $u(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Lt(e)-Lt(t))+1}function Bu(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function ju(t){return function(){return t}}function Ru(t){return+t}var Qn=[0,1];function Et(t){return t}function qe(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:ju(isNaN(e)?NaN:.5)}function Du(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function Uu(t,e,n){var r=t[0],i=t[1],o=e[0],s=e[1];return i<r?(r=qe(i,r),o=n(s,o)):(r=qe(r,i),o=n(o,s)),function(a){return o(r(a))}}function Hu(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),o=new Array(r),s=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<r;)i[s]=qe(t[s],t[s+1]),o[s]=n(e[s],e[s+1]);return function(a){var l=Uo(t,a,1,r)-1;return o[l](i[l](a))}}function Vu(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Xu(){var t=Qn,e=Qn,n=an,r,i,o,s=Et,a,l,u;function c(){var h=Math.min(t.length,e.length);return s!==Et&&(s=Du(t[0],t[h-1])),a=h>2?Hu:Uu,l=u=null,d}function d(h){return h==null||isNaN(h=+h)?o:(l||(l=a(t.map(r),e,n)))(r(s(h)))}return d.invert=function(h){return s(i((u||(u=a(e,t.map(r),W)))(h)))},d.domain=function(h){return arguments.length?(t=Array.from(h,Ru),c()):t.slice()},d.range=function(h){return arguments.length?(e=Array.from(h),c()):e.slice()},d.rangeRound=function(h){return e=Array.from(h),n=sl,c()},d.clamp=function(h){return arguments.length?(s=h?!0:Et,c()):s!==Et},d.interpolate=function(h){return arguments.length?(n=h,c()):n},d.unknown=function(h){return arguments.length?(o=h,d):o},function(h,p){return r=h,i=p,c()}}function Qu(){return Xu()(Et,Et)}function Yu(t,e,n,r){var i=Yo(t,e,n),o;switch(r=be(r??",f"),r.type){case"s":{var s=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(o=Iu(i,s))&&(r.precision=o),di(r,s)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(o=$u(i,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=o-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(o=Lu(i))&&(r.precision=o-(r.type==="%")*2);break}}return Se(r)}function qu(t){var e=t.domain;return t.ticks=function(n){var r=e();return Qo(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var i=e();return Yu(i[0],i[i.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),i=0,o=r.length-1,s=r[i],a=r[o],l,u,c=10;for(a<s&&(u=s,s=a,a=u,u=i,i=o,o=u);c-- >0;){if(u=$e(s,a,n),u===l)return r[i]=s,r[o]=a,e(r);if(u>0)s=Math.floor(s/u)*u,a=Math.ceil(a/u)*u;else if(u<0)s=Math.ceil(s*u)/u,a=Math.floor(a*u)/u;else break;l=u}return t},t}function Ge(){var t=Qu();return t.copy=function(){return Vu(t,Ge())},Bu.apply(t,arguments),qu(t)}function Ct(t){return function(){return t}}function Gu(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(n==null)e=null;else{const r=Math.floor(n);if(!(r>=0))throw new RangeError(`invalid digits: ${n}`);e=r}return t},()=>new Mu(e)}function Wu(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function hi(t){this._context=t}hi.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function zu(t){return new hi(t)}function Ku(t){return t[0]}function Zu(t){return t[1]}function Ju(t,e){var n=Ct(!0),r=null,i=zu,o=null,s=Gu(a);t=typeof t=="function"?t:t===void 0?Ku:Ct(t),e=typeof e=="function"?e:e===void 0?Zu:Ct(e);function a(l){var u,c=(l=Wu(l)).length,d,h=!1,p;for(r==null&&(o=i(p=s())),u=0;u<=c;++u)!(u<c&&n(d=l[u],u,l))===h&&((h=!h)?o.lineStart():o.lineEnd()),h&&o.point(+t(d,u,l),+e(d,u,l));if(p)return o=null,p+""||null}return a.x=function(l){return arguments.length?(t=typeof l=="function"?l:Ct(+l),a):t},a.y=function(l){return arguments.length?(e=typeof l=="function"?l:Ct(+l),a):e},a.defined=function(l){return arguments.length?(n=typeof l=="function"?l:Ct(!!l),a):n},a.curve=function(l){return arguments.length?(i=l,r!=null&&(o=i(r)),a):i},a.context=function(l){return arguments.length?(l==null?r=o=null:o=i(r=l),a):r},a}function Ut(t,e,n){this.k=t,this.x=e,this.y=n}Ut.prototype={constructor:Ut,scale:function(t){return t===1?this:new Ut(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Ut(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Ut.prototype;function Yn(t){return+t.toFixed(3)}const tc="_PointAnchorContainer_1lvdx_1",ec="_PointAnchor_1lvdx_1",nc="_LabelAnchor_1lvdx_30",rc="_FloatingLabel_1lvdx_40",ic="_FloatingLabelContent_1lvdx_52",oc="_PointingLine_1lvdx_60",Nt={PointAnchorContainer:tc,PointAnchor:ec,LabelAnchor:nc,FloatingLabel:rc,FloatingLabelContent:ic,PointingLine:oc};function sc(t,e,n){let r=e.x,i=e.y;return r<t.x?(r=t.x,i<t.y?i=t.y:i+e.height>t.y+t.height&&(i=t.y+t.height-e.height)):r>=t.x&&r+e.width<=t.x+t.width?i<t.y?i=t.y:i+e.height>t.y+t.height&&(i=t.y+t.height-e.height):r+e.width>t.x+t.width&&(r=t.x+t.width-e.width,i<t.y?i=t.y:i+e.height>t.y+t.height&&(i=t.y+t.height-e.height)),r>=t.x+t.width-e.width&&n.x>=t.x+t.width-e.width&&(r=r-e.width),i>=t.y+t.height-e.height&&n.y>=t.y+t.height-e.height&&(i=i-e.height),{x:r,y:i}}const ac=m.memo(function({targetPoint:e,showTargetPointMarker:n=!1,elementWithTargetPointRef:r,children:i}){const o=m.useRef(null),s=m.useRef(null),[a,l]=m.useState(void 0),[u,c]=m.useState(void 0),[d,h]=m.useState(void 0),[p,y]=m.useState(void 0);return m.useEffect(function(){const v=o==null?void 0:o.current,C=s.current;if(!v||!C){y(void 0);return}const w=v.getBoundingClientRect(),A=C.getBoundingClientRect();y({xOffset:A.x-w.x,yOffset:A.y-w.y})},[r,s,y]),m.useEffect(function(){function v(){l(void 0),c(void 0),h(void 0)}const C=r==null?void 0:r.current;if(!C||!e){v();return}const w=C.getBoundingClientRect(),A=Math.min(Math.max(0,e.x),w.width),L=Math.min(Math.max(0,e.y),w.height);l({x:A,y:L});const T=o.current;if(!T){v();return}const F=w,E=T.getBoundingClientRect(),P=A+w.x,g=L+w.y,x={x:P,y:g,width:E.width,height:E.height},_={x:A+w.x,y:L+w.y},M=sc(F,x,_),N={x:M.x-w.x,y:M.y-w.y};if(c(N),!!p)return h({x:N.x+p.xOffset,y:N.y+p.yOffset}),function(){v()}},[e,r,l,c,h,o,p]),f.jsxs("div",{className:Nt.PointAnchorContainer,children:[!!a&&!!d&&f.jsx("svg",{className:Nt.PointingLine,id:"line-between-target-point-and-tooltip",xmlns:"http://www.w3.org/2000/svg",children:f.jsx("line",{x1:a.x,y1:a.y,x2:d.x,y2:d.y})}),n&&!!a&&f.jsx("div",{className:Nt.PointAnchor,style:{left:a==null?void 0:a.x,top:a==null?void 0:a.y}}),f.jsx("div",{ref:o,className:er([Nt.LabelAnchor]),style:{left:(u==null?void 0:u.x)||-1e3,top:(u==null?void 0:u.y)||-1e3},children:f.jsx("div",{className:Nt.FloatingLabel,children:f.jsx("div",{ref:s,className:Nt.FloatingLabelContent,children:i})})})]})}),lc="_PlotContainer_1vc97_1",uc="_IsVisible_1vc97_9",cc="_XAxis_1vc97_13",fc="_YAxis_1vc97_14",dc="_XAxisTitle_1vc97_18",hc="_YAxisTitle_1vc97_19",mc="_LineWithMissingData_1vc97_23",pc="_Line_1vc97_23",yc="_DotGroupOnLine_1vc97_32",gc="_DotOnLine_1vc97_36",xc="_PointerDot_1vc97_41",_c="_PriceLineTooltipContentGrid_1vc97_45",U={PlotContainer:lc,IsVisible:uc,XAxis:cc,YAxis:fc,XAxisTitle:dc,YAxisTitle:hc,LineWithMissingData:mc,Line:pc,DotGroupOnLine:yc,DotOnLine:gc,PointerDot:xc,PriceLineTooltipContentGrid:_c};function qn(t,e,n=5){const r=t.getBoundingClientRect(),i=e.getBoundingClientRect(),o=t.getScreenCTM();let s=t.createSVGPoint(),a=t.createSVGPoint();s.x=i.x,s.y=i.y,a.x=r.x,a.y=r.y,s=s.matrixTransform(o==null?void 0:o.inverse()),a=a.matrixTransform(o==null?void 0:o.inverse());let l=s.x-a.x,u=s.y-a.y;return l<=n&&(l=0),u<=n&&(u=0),{x:l,y:u}}const bc=Se(".3~s"),vc=Se(".3~s"),Gn="+";function Tt(t,e=!1){const n=Math.abs(t.valueOf());return!e&&n>.001&&n<1e3?`${+t.valueOf().toFixed(3)}`:`${bc(t)}`}function Wn(t,e=!1){const n=Math.abs(t.valueOf());return!e&&n>.001&&n<1e3?`${Gn}${+t.valueOf().toFixed(3)}`:`${Gn}${vc(t)}`}const wc=m.memo(function({preparedData:e,width:n=500,height:r=250,marginTop:i=18,marginRight:o=0,marginBottom:s=20,marginLeft:a=60,innerTickLength:l=6,outerTickLength:u=12,xAxisTitleMarginBottom:c=-5,yAxisTitleMarginTop:d=10,priceAxisName:h="price",markAxisName:p="quantity",pointRef:y,setMarkValueOfSelectedPoint:b,adjustedMarginLeft:v,setAdjustedMarginLeft:C,setIsAdjustedMarginLeft:w,adjustedMarginBottom:A,setAdjustedMarginBottom:L,setIsAdjustedMarginBottom:T,xScale:F,yScale:E}){const P=m.useMemo(()=>Ju().defined(I=>Number.isFinite(I[0])&&Number.isFinite(I[1])).x(I=>F(I[1])).y(I=>E(I[0])),[F,E]),g=m.useRef(null),x=m.useRef(null),_=m.useRef(null);m.useEffect(function(){const k=_.current;if(!k)return;const B=F.domain(),R=F.ticks().length>1&&Tt(B[0])===Tt(B[1]);Cn(k).attr("class",U.XAxis).call(Jo(F).tickFormat(function(j,tt){return R&&tt!==0?Wn(j.valueOf()-B[0]):Tt(j)})).call(S=>S.select(".domain").remove()).call(S=>S.selectAll(".cloned").remove()).call(S=>S.selectAll(".tick text").append("title").text(j=>`${j}`)).call(S=>S.selectAll(".tick line").clone().attr("y1",-r+i+A).attr("stroke-opacity",.1).attr("stroke-dasharray","0.25em").attr("class","cloned")).call(S=>S.select(`.${U.XAxisTitle}`).remove()).call(S=>S.append("text").attr("class",U.XAxisTitle).attr("x",n).attr("y",A+c).attr("fill","currentColor").attr("text-anchor","end").text(`${p} ${R?"Δ":""} →`))},[_,F,l,u,r,n,A,i,c,p]),m.useEffect(function(){const k=x.current;if(!k)return;const B=E.domain(),R=E.ticks().length>1&&Tt(B[0])===Tt(B[1]);Cn(k).attr("class",U.YAxis).call(ts(E).tickFormat(function(j,tt){return R&&tt!==0?Wn(j.valueOf()-B[0]):Tt(j)})).call(S=>S.select(".domain").remove()).call(S=>S.selectAll(".cloned").remove()).call(S=>S.selectAll(".tick text").append("title").text(j=>`${j}`)).call(S=>S.selectAll(".tick line").clone().attr("x2",n-v-o).attr("stroke-opacity",.1).attr("stroke-dasharray","0.25em").attr("class","cloned")).call(S=>S.select(`.${U.YAxisTitle}`).remove()).call(S=>S.append("text").attr("class",U.YAxisTitle).attr("x",0).attr("y",d).attr("fill","currentColor").attr("text-anchor","end").text(`↑ ${h} ${R?"Δ":""}`))},[x,E,l,u,v,o,n,d,h]),m.useEffect(function(){const k=g.current,B=x.current;if(!k||!B)return;const R=qn(k,B).x;Math.abs(R)>0&&C(a-R),w(!0)},[g,x,C,a,w]),m.useEffect(function(){const k=g.current,B=_.current;if(!k||!B)return;const R=qn(k,B).y;Math.abs(R)>0&&L(s+R),T(!0)},[g,_,L,s,T]);const M=m.useMemo(()=>P(e.filter(I=>Number.isFinite(I[0])&&Number.isFinite(I[1])))||void 0,[e,P]),N=m.useMemo(()=>P(e)||void 0,[e,P]),O=m.useMemo(()=>en(I=>I[1]).center,[]),q=m.useCallback(function(k){if(!e.length||!F||!E)return;const B=O(e,F.invert(Ba(k)[0]));b(B)},[O,e,F,E,b]),V=m.useCallback(function(){b(void 0)},[b]);return f.jsxs("svg",{ref:g,width:"100%",viewBox:`0 0 ${n} ${r}`,style:{maxWidth:"100%",height:"intrinsic"},onMouseMove:q,onMouseLeave:V,role:"application",children:[f.jsx("g",{ref:_,className:U.XAxis,transform:`translate(0,${r-A})`}),f.jsx("g",{ref:x,className:U.YAxis,transform:`translate(${v},0)`}),!!M&&f.jsx("path",{fill:"none",stroke:"gray",strokeWidth:"1",d:M,className:U.LineWithMissingData}),!!N&&f.jsx("path",{fill:"none",stroke:"lightgray",strokeWidth:"1",d:N,className:U.Line}),f.jsx("g",{fill:"white",stroke:"currentColor",strokeWidth:"1",className:U.DotGroupOnLine,children:e.map((I,k)=>f.jsx("circle",{cx:F(I[1]),cy:E(I[0]),r:"1.5",className:U.DotOnLine},k))}),f.jsx("g",{ref:y,transform:"translate(-1000,-1000)",className:U.PointerDot,children:f.jsx("circle",{x:"0",y:"0",stroke:"currentColor",strokeWidth:"1",r:"2.5",fill:"currentColor"})})]})}),Ac=m.memo(function({data:e,width:n=500,height:r=250,marginTop:i=18,marginRight:o=0,marginBottom:s=20,marginLeft:a=60,plotDomainPadding:l=10,innerTickLength:u=6,outerTickLength:c=12,xAxisTitleMarginBottom:d=-5,yAxisTitleMarginTop:h=10,priceAxisName:p="price",markAxisName:y="quantity"}){const[b,v]=m.useState(a),[C,w]=m.useState(s),[A,L]=m.useState(!1),[T,F]=m.useState(!1),E=A&&T,P=m.useMemo(()=>e.filter(S=>Number.isFinite(S[1])).sort((S,j)=>S[1]-j[1]),[e]),g=m.useMemo(()=>{let S=wn(P,j=>j[1]);return(S[0]===void 0||S[1]===void 0)&&(S=[0,1]),S},[P]),x=m.useMemo(()=>{let S=wn(P,j=>j[0]);return(S[0]===void 0||S[1]===void 0)&&(S=[0,1]),S},[P]),_=m.useMemo(()=>Ge().domain(g).nice().rangeRound([b+l,n-o-l]),[g,b,o,l,n]),M=m.useMemo(()=>Ge().domain(x).nice().rangeRound([r-C-l,i+l]),[x,i,C,l,r]),N=m.useRef(null),[O,q]=m.useState(void 0),V=m.useRef(null),[I,k]=m.useState(void 0),B=m.useMemo(()=>{var S;return O!==void 0?(S=P[O])==null?void 0:S[0]:void 0},[P,O]),R=m.useMemo(()=>{var S;return O!==void 0?(S=P[O])==null?void 0:S[1]:void 0},[P,O]);return m.useEffect(function(){const j=N.current;if(!j){k(void 0);return}if(O===void 0){k(void 0);return}const tt=P[O];if(!tt){k(void 0);return}const[bt,vt]=tt,wt={x:dn(vt)?Yn(_(vt)):0,y:dn(bt)?Yn(M(bt)):0};j.setAttribute("transform",`translate(${wt.x},${wt.y})`);const At=V.current;if(!At){k(void 0);return}const St=At.getBoundingClientRect(),dt=j.getBoundingClientRect();return k({x:dt.x+dt.width/2-St.x,y:dt.y+dt.height/2-St.y}),function(){j.setAttribute("transform","translate(-1000,-1000)")}},[O,P,_,M]),f.jsxs("div",{ref:V,className:er([U.PlotContainer,E&&U.IsVisible]),children:[f.jsx(wc,{preparedData:P,width:n,height:r,marginTop:i,marginRight:o,marginBottom:s,marginLeft:a,innerTickLength:u,outerTickLength:c,xAxisTitleMarginBottom:d,yAxisTitleMarginTop:h,priceAxisName:p,markAxisName:y,pointRef:N,setMarkValueOfSelectedPoint:q,adjustedMarginLeft:b,setAdjustedMarginLeft:v,setIsAdjustedMarginLeft:L,adjustedMarginBottom:C,setAdjustedMarginBottom:w,setIsAdjustedMarginBottom:F,xScale:_,yScale:M}),R!==void 0&&f.jsx(ac,{elementWithTargetPointRef:V,targetPoint:I,children:f.jsxs("div",{className:U.PriceLineTooltipContentGrid,children:[f.jsx("span",{children:"Price:"}),f.jsx("span",{children:B}),f.jsx("span",{children:"Quantity:"}),f.jsx("span",{children:R})]})})]})}),Sc="_ModalBody_tz1ce_1",Mc="_Content_tz1ce_11",Cc="_NoData_tz1ce_19",Nc="_TitleWithButton_tz1ce_27",se={ModalBody:Sc,Content:Mc,NoData:Cc,TitleWithButton:Nc},Tc=m.memo(function({order:e,onHideModal:n,onHideParentModal:r}){const i=G([it,Z,ct,ht]),o=st([ft]),s=i||o,a=m.useCallback(function(){n()},[n]),l=m.useCallback(function(){tr(e.uuid),a(),r()},[e,a,r]),u=m.useMemo(function(){var y;const d=!s&&((y=K(e.productUuid))==null?void 0:y.name)||"(product without name)",h=!s&&It(e.locationUuid)||"(location without name)";let p="";return e.entityType===Gt?p="sell":e.entityType===qt&&(p="buy"),f.jsxs(f.Fragment,{children:["Are you sure you want"," ",f.jsx("strong",{children:"to delete"})," ",f.jsx("strong",{children:"price history"}),f.jsx("br",{}),"of the"," ",p," ","order for"," ",f.jsx("strong",{children:d}),f.jsx("br",{}),"in"," ",f.jsx("strong",{children:h})," ","?"]})},[e,s]);return f.jsx(hr,{title:u,onHide:a,onConfirm:l,confirmButtonLabel:"delete price history"})}),Ec=m.memo(function({formTitle:e,hasEnoughDataForPlot:n,handleShowDeletePriceAtMarksConfirmation:r,deleteItemButtonLabel:i}){return f.jsxs("div",{className:se.TitleWithButton,children:[e,n&&f.jsx(H,{size:"small",noPadding:!0,transparent:!0,onClick:r,title:i,children:f.jsx(Di,{})})]})}),mi=m.memo(function({order:e,deleteItemButtonLabel:n="delete price records",onHideModal:r}){const i=G([it,Z,ct,ht]),o=st([ft]),s=i||o,a=m.useMemo(function(){if(s)return;const v=Ke(e.uuid);if(v)return v},[e,s]),l=m.useMemo(function(){return(a==null?void 0:a.pricesAtMarks)??[]},[a]),u=m.useCallback(function(){r()},[r]),c=m.useMemo(function(){var A;const v=(l==null?void 0:l.length)||0,C=!s&&((A=K(e.productUuid))==null?void 0:A.name)||"(product without name)",w=!s&&It(e.locationUuid)||"(location without name)";return f.jsxs(f.Fragment,{children:[e.entityType==="sell-order"&&"sell"||e.entityType==="buy-order"&&"buy"," ","order for"," ",f.jsx("strong",{children:C}),f.jsx("br",{}),"at"," ",f.jsx("strong",{children:w}),f.jsx("br",{}),"( total"," ",v," ","record",v>1?"s":""," ",v>=hn&&`max ${hn} records`," ",")"]})},[e,l,s]),{isVisible:d,show:h,hide:p}=Ht(!1),y=Ni(a);return f.jsxs(f.Fragment,{children:[f.jsx(dr,{title:f.jsx(Ec,{formTitle:"Price dynamic",deleteItemButtonLabel:n,handleShowDeletePriceAtMarksConfirmation:h,hasEnoughDataForPlot:y}),subTitle:c,onHide:u,size:"small",children:f.jsx("div",{className:se.ModalBody,children:f.jsx("div",{className:se.Content,children:y?f.jsx(Ac,{data:l}):f.jsx("div",{className:se.NoData,children:"No data"})})})}),d&&f.jsx(Tc,{onHideModal:p,onHideParentModal:u,order:e})]})});function pi({value:t}){return f.jsx(f.Fragment,{children:typeof t=="number"?t.toFixed(2):0 .toFixed(2)})}function yi({value:t}){const n=G([Z])||!le(t)?void 0:K(t);return n!=null&&n.name?f.jsx(f.Fragment,{children:n.name}):f.jsx(pr,{children:"(no data)"})}function gi({value:t}){return f.jsx(f.Fragment,{children:typeof t=="number"&&t>0?t:f.jsx(pr,{children:"0"})})}function xi({item:t}){const e=G([ct,ht]),n=e?void 0:Zn(t.locationUuid),r=!e&&(n!=null&&n.planetarySystemUuid)?Jn(n==null?void 0:n.planetarySystemUuid):void 0,i=Yi({locationId:n==null?void 0:n.id,locationName:n==null?void 0:n.name,planetarySystemName:r==null?void 0:r.name}),o=qi({locationId:n==null?void 0:n.id,locationName:n==null?void 0:n.name,planetarySystemName:r==null?void 0:r.name}),s=r&&Cr({locationId:n==null?void 0:n.id,locationName:n==null?void 0:n.name,planetarySystemName:r==null?void 0:r.name});return f.jsxs(f.Fragment,{children:[i?f.jsx(Vt,{href:i,title:"show location info",children:f.jsx(Mr,{})}):f.jsx(H,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no location data",children:f.jsx(Zi,{})}),o?f.jsx(Vt,{href:o,title:"show location on map",children:f.jsx(Gi,{})}):f.jsx(H,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no position data",children:f.jsx(Ji,{})}),s?f.jsx(Vt,{href:s,title:"search by location in market",children:f.jsx(Nr,{})}):f.jsx(H,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no data for search in market",children:f.jsx(Ie,{})})]})}const Fc=t=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",...t},m.createElement("path",{d:"M73-889 889-73l-57 57-104-104H200q-33 0-56.5-23.5T120-200v-528L16-832l57-57Zm287 447L200-282v82h448L544-304l-22 24-162-162ZM200-648v252l126-126-126-126Zm36-192h524q33 0 56.5 23.5T840-760v524l-80-80v-234L650-426l-57-57 167-187v-90H316l-80-80Zm357 357Zm-158 70ZM326-522Zm34 80Zm176-98Z"})),Pc=m.memo(Fc),kc=t=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",...t},m.createElement("path",{d:"M120-120v-80l80-80v160h-80Zm160 0v-240l80-80v320h-80Zm160 0v-320l80 81v239h-80Zm160 0v-239l80-80v319h-80Zm160 0v-400l80-80v480h-80ZM120-327v-113l280-280 160 160 280-280v113L560-447 400-607 120-327Z"})),Oc=m.memo(kc);function _i({item:t,setOrderForPriceChart:e}){const n=G([it]),r=m.useCallback(function(){e(t)},[t,e]),i=!n&&Ti(t.uuid);return f.jsx(f.Fragment,{children:i?f.jsx(H,{transparent:!0,noPadding:!0,noBorder:!0,isAlwaysVisible:!0,onClick:r,title:"show price chart",children:f.jsx(Oc,{})}):f.jsx(H,{transparent:!0,noPadding:!0,noBorder:!0,isStaticBehaviour:!0,title:"no price data",disabled:!0,children:f.jsx(Pc,{})})})}function bi({item:t}){var o;const n=G([Z])||(o=K(t.productUuid))==null?void 0:o.name,r=Cr({productName:n}),i=to({productName:n});return f.jsxs(f.Fragment,{children:[i?f.jsx(Vt,{href:i,title:"show product info",children:f.jsx(Mr,{})}):f.jsx(H,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no data for search in products",children:f.jsx(Ie,{})}),r?f.jsx(Vt,{href:r,title:"search by product name in market",children:f.jsx(Nr,{})}):f.jsx(H,{disabled:!0,noBorder:!0,noPadding:!0,transparent:!0,title:"no data for search in market",children:f.jsx(Ie,{})})]})}function Lc({name:t,label:e,value:n}){const r=st([ft]);if(!n)return;const i=r||!le(n)?void 0:It(n);return i?{label:e??(t==null?void 0:t.toString()),value:i}:{label:e??(t==null?void 0:t.toString()),value:"(location without name)"}}function Ic({filterValue:t}){if(!t)return;let e="",n="";const r=t.minPrice,i=t.maxPrice;if(!(!r&&!i))return r&&i?(e="price",n=`${r} - ${i}`):r?(e="min price",n=`${r}`):i&&(e="max price",n=`${i}`),{label:e,value:n}}function $c({filterValue:t}){if(!t)return;const e=t.minQuantity,n=t.maxQuantity;if(!e&&!n)return;let r="",i="";return e&&n?(r="quantity",i=`${e} - ${n}`):e?(r="min quantity",i=`${e}`):n&&(r="max quantity",i=`${n}`),{label:r,value:i}}function vi(){return[{name:"locationUuid",label:"location",formatLabelAndValue:Lc},{name:"quantity",groupNames:["minQuantity","maxQuantity"],formatLabelAndValue:$c},{name:"price",groupNames:["minPrice","maxPrice"],formatLabelAndValue:Ic}]}function wi(t,e){var o,s;if(Ei())return 0;const r=le(t)&&((o=K(t))==null?void 0:o.name)||"",i=le(e)&&((s=K(e))==null?void 0:s.name)||"";return r.localeCompare(i)}const Bc=["productUuid","desirableQuantity","price","locationUuid"];function jc(t){return[{name:"uuid",isCheckbox:!0},{name:"productUuid",label:"product",asLinkToEditItem:!0,isSortable:!0,alignLabel:"left",formatValue:yi,actionButtons:bi,sortFn:wi},{name:"desirableQuantity",label:"stock",type:"number",isSortable:!0,formatValue:gi},{name:"price",type:"number",isSortable:!0,sort:"desc",formatValue:pi,actionButtons:({item:e})=>f.jsx(_i,{item:e,setOrderForPriceChart:t})},{name:"locationUuid",label:"location",alignLabel:"right",isSortable:!0,formatValue:Sr,actionButtons:xi,sortFn:Ar}]}const Rc=m.memo(function({searchFieldValue:e,buyOrderFilterValue:n,setBuyOrderFilterValue:r,resetSearchFieldValue:i}){const[o,s]=m.useState(!1),[a,l]=m.useState(),[u,c]=m.useState(),d=rt(mr($=>$.items())),h=G([nt,rt,Z,ct,ht]),p=st([ft]),y=h||p,b=rt($=>$.deleteMultiple),v=nt($=>$.createMultiple),C=m.useCallback(()=>{r(void 0)},[r]),w=m.useCallback(()=>{s(!0)},[s]),A=m.useCallback(()=>{l(void 0),s(!1)},[l,s]),L=m.useCallback($=>{c($)},[c]),T=m.useCallback(()=>{c(void 0)},[c]),[F,E]=m.useState(void 0),P=m.useCallback($=>{E($)},[E]),g=m.useCallback(()=>{E(void 0)},[E]),x=m.useMemo(function(){return e?d.filter(({productUuid:D})=>{const Q=K(D);return Q?Q.name.includes(e):!1}):d},[e,d,y]),_=m.useMemo(function(){return Eo([])},[]),{isAppliedFilter:M,enableFilter:N,disableFilter:O}=or(n),q=sr(x,_,M?n:void 0),V=m.useMemo(function(){return vi()},[y]),I=m.useMemo(function(){return jc(P)},[P,y]),{sortedItems:k,columnsToSortBy:B,handleColumnSortClick:R}=ar(q,I,Bc),{selectedItemsUuids:S,handleResetSelectedItems:j,handleSelectAllItems:tt,handleSelectItem:bt,handleShowDeleteMultipleSelectedItemsConfirmation:vt,DeleteSelectedItemsConfirmation:wt}=lr({itemTypeNamePlural:"buy orders",items:k,searchFieldValue:e,filterValue:n,deleteItemsByUuids:b,setItemToDelete:c}),{lastCreatedOrUpdatedItem:At,onCreateItem:St,onUpdateItem:dt}=ur({itemEntityType:qt,items:k,searchFieldValue:e,filterValue:n,resetFilterValue:C,resetSearchFieldValue:i}),Kt=m.useCallback(function(D){return Fi(D)?D:void 0},[]),Me=m.useCallback($=>{const D=$.map(Q=>({entityType:Gt,productUuid:Q.productUuid,locationUuid:Q.locationUuid,price:Q.price,availableQuantity:0}));v(D)},[v]),{CopySelectedItemsButton:Ce,CopyingDialog:Ne,ItemsWereCopiedNotification:Te,NothingToCopyNotification:Ee}=Fr({items:k,selectedItemsUuids:S,onBulkCopyingIntoTargetTable:Me,findSimilarItemInTargetTable:Kt,targetTableName:"sell orders table"});return f.jsxs(f.Fragment,{children:[f.jsx(yr,{tableTitle:"buy orders",tableColumns:I,items:k,noItemsLabel:"no buy orders",isLoading:y,showCreateItemModalButtonLabel:"add buy order",onShowCreateItemModal:w,columnsToSortBy:B,onColumnHeaderClick:R,selectedItemsUuids:S,onResetSelectedItems:j,onSelectAllItems:tt,onDeleteSelectedItems:vt,searchFieldValue:e,filterValue:n,isAppliedFilter:M,onEnableFilter:N,onDisableFilter:O,filterInfoFields:V,CopySelectedItemsButton:Ce,children:f.jsx(gr,{items:k,columns:I,selectedItemsUuids:S,onEditItem:l,onSelectItem:bt,lastCreatedOrUpdatedItem:At})}),(o||!!a)&&f.jsx($o,{itemToEdit:a,filterValue:n,onHideModal:A,onShowDeleteItemConfirmation:L,onCreateItem:St,onUpdateItem:dt}),!!u&&f.jsx(kr,{onHideModal:T,onHideParentModal:A,itemToDelete:u}),f.jsx(wt,{}),f.jsx(Ne,{}),Te(),Ee(),!!F&&f.jsx(mi,{order:F,onHideModal:g})]})}),Dc=t=>[{name:"locationUuid",label:"location",type:"select",options:t,chooseOptionLabel:"choose a location",noOptionsLabel:"no location available",allowToSelectNoValueOption:!0,filterPredicate:Pr},{name:"minQuantity",label:"min quantity",type:"number",min:0,max:Number.MAX_SAFE_INTEGER,filterPredicate:(e,n)=>n.minQuantity===void 0?!0:e.availableQuantity>=n.minQuantity},{name:"maxQuantity",label:"max quantity",type:"number",min:0,max:Number.MAX_SAFE_INTEGER,filterPredicate:(e,n)=>n.maxQuantity===void 0?!0:e.availableQuantity<=n.maxQuantity},{name:"minPrice",label:"min price",type:"number",valueType:"float",pattern:"[0-9]+[.][0-9]{2}",min:0,max:Number.MAX_SAFE_INTEGER,step:"0.01",filterPredicate:(e,n)=>n.minPrice===void 0?!0:e.price>=n.minPrice},{name:"maxPrice",label:"max price",type:"number",valueType:"float",pattern:"[0-9]+[.][0-9]{2}",min:0,max:Number.MAX_SAFE_INTEGER,step:"0.01",filterPredicate:(e,n)=>n.maxPrice===void 0?!0:e.price<=n.maxPrice}],zn=(t,e)=>[{name:"uuid",type:"hidden"},{name:"entityType",type:"hidden"},{name:"locationUuid",label:"location",type:"select",required:!0,options:e,chooseOptionLabel:"choose a location",noOptionsLabel:"no locations available",allowToSelectNoValueOption:!0},{name:"productUuid",label:"product",type:"select",required:!0,options:t,chooseOptionLabel:"choose a product",noOptionsLabel:"no products available",allowToSelectNoValueOption:!0},{name:"availableQuantity",label:"stock",type:"number",required:!0,min:0,max:Number.MAX_SAFE_INTEGER},{name:"price",type:"number",required:!0,valueType:"float",pattern:"[0-9]+[.][0-9]{2}",step:"0.01",min:0,max:Number.MAX_SAFE_INTEGER}],Uc=m.memo(function({itemToEdit:e,filterValue:n,onHideModal:r,onShowDeleteItemConfirmation:i,onCreateItem:o,onUpdateItem:s}){const a=G([nt,it,Z,ct,ht]),l=st([gt,ft,Pt]),u=a||l,c=nt(g=>g.create),d=nt(g=>g.update),h=it(g=>g.create),p=it(g=>g.update),y=m.useCallback(g=>{h({entityType:$r,orderUuid:g.uuid,pricesAtMarks:[[g.price,g.availableQuantity]]})},[h]),b=m.useCallback(function(x){const _=[x.price,x.availableQuantity],M=Ke(x.uuid);if(M){if(M.pricesAtMarks.find(O=>O[0]===_[0]&&O[1]===_[1]))return;p({...M,pricesAtMarks:M.pricesAtMarks.concat([_])})}else y(x)},[p,y]),v=m.useCallback(g=>{const x=c(g);y(x),typeof o=="function"&&o(x)},[c,o,y]),C=m.useCallback(g=>{const x=d(g);x&&(b(x),typeof s=="function"&&s(x))},[d,s,b]),w=m.useCallback(()=>{r()},[r]),A=m.useCallback(g=>{if(nr(g)){const x=ae(g,Er);C(x)}else{const x=ae(g,oo);x.entityType=Gt,v(x)}w()},[v,C,w]),L=m.useCallback(function(x){var M;if(u)return function(){return f.jsx("span",{children:"Loading..."})};const _=Pi(x);if(_){const N=((M=K(_.productUuid))==null?void 0:M.name)||"(product without name)",O=It(_.locationUuid)||"(location without name)";return function(){return f.jsxs("span",{children:["Sell order for"," ",f.jsx("strong",{children:N})," ","in"," ",f.jsx("strong",{children:O})," ","already exists"]})}}},[u]),T=Pt(g=>g.items),F=gt(g=>g.items),E=m.useMemo(function(){return l?zn([],[]):zn(T,F)},[T,F,l]),P=rr(E,n);return f.jsx(ir,{humanizedItemTypeName:"sell order",itemToEdit:e,formFields:P,validateFormData:L,onCancel:w,onSubmit:A,onDelete:i,deleteItemButtonLabel:"delete sell order"})}),Hc=["productUuid","availableQuantity","price","locationUuid"];function Vc(t){return[{name:"uuid",isCheckbox:!0},{name:"productUuid",label:"product",asLinkToEditItem:!0,isSortable:!0,alignLabel:"left",formatValue:yi,actionButtons:bi,sortFn:wi},{name:"availableQuantity",label:"stock",type:"number",isSortable:!0,formatValue:gi},{name:"price",type:"number",isSortable:!0,sort:"asc",formatValue:pi,actionButtons:({item:e})=>f.jsx(_i,{item:e,setOrderForPriceChart:t})},{name:"locationUuid",label:"location",alignLabel:"right",isSortable:!0,formatValue:Sr,actionButtons:xi,sortFn:Ar}]}const Xc=m.memo(function({searchFieldValue:e,sellOrderFilterValue:n,setSellOrderFilterValue:r,resetSearchFieldValue:i}){const[o,s]=m.useState(!1),[a,l]=m.useState(),[u,c]=m.useState(),d=nt(mr($=>$.items())),h=G([nt,rt,Z,ct,ht]),p=st([ft]),y=h||p,b=nt($=>$.deleteMultiple),v=rt($=>$.createMultiple),C=m.useCallback(function(){r(void 0)},[r]),w=m.useCallback(function(){s(!0)},[s]),A=m.useCallback(function(){l(void 0),s(!1)},[l,s]),L=m.useCallback(function(D){c(D)},[c]),T=m.useCallback(function(){c(void 0)},[c]),[F,E]=m.useState(void 0),P=m.useCallback(function(D){E(D)},[E]),g=m.useCallback(function(){E(void 0)},[E]),x=m.useMemo(function(){return e?d.filter(({productUuid:D})=>{const Q=K(D);return Q?Q.name.includes(e):!1}):d},[e,d,y]),_=m.useMemo(function(){return Dc([])},[y]),{isAppliedFilter:M,enableFilter:N,disableFilter:O}=or(n),q=sr(x,_,M?n:void 0),V=m.useMemo(function(){return vi()},[y]),I=m.useMemo(function(){return Vc(P)},[P,y]),{sortedItems:k,columnsToSortBy:B,handleColumnSortClick:R}=ar(q,I,Hc),{selectedItemsUuids:S,handleResetSelectedItems:j,handleSelectAllItems:tt,handleSelectItem:bt,handleShowDeleteMultipleSelectedItemsConfirmation:vt,DeleteSelectedItemsConfirmation:wt}=lr({itemTypeNamePlural:"sell orders",items:k,searchFieldValue:e,filterValue:n,deleteItemsByUuids:b,setItemToDelete:c}),{lastCreatedOrUpdatedItem:At,onCreateItem:St,onUpdateItem:dt}=ur({itemEntityType:Gt,items:k,searchFieldValue:e,filterValue:n,resetFilterValue:C,resetSearchFieldValue:i}),Kt=m.useCallback(function(D){return ki(D)?D:void 0},[]),Me=m.useCallback(function(D){const Q=D.map(Fe=>({entityType:qt,productUuid:Fe.productUuid,locationUuid:Fe.locationUuid,price:Fe.price,desirableQuantity:0}));v(Q)},[v]),{CopySelectedItemsButton:Ce,CopyingDialog:Ne,ItemsWereCopiedNotification:Te,NothingToCopyNotification:Ee}=Fr({items:k,selectedItemsUuids:S,onBulkCopyingIntoTargetTable:Me,findSimilarItemInTargetTable:Kt,targetTableName:"buy orders table"});return f.jsxs(f.Fragment,{children:[f.jsx(yr,{tableTitle:"sell orders",tableColumns:I,items:k,noItemsLabel:"no sell orders",isLoading:y,showCreateItemModalButtonLabel:"add sell order",onShowCreateItemModal:w,columnsToSortBy:B,onColumnHeaderClick:R,selectedItemsUuids:S,onResetSelectedItems:j,onSelectAllItems:tt,onDeleteSelectedItems:vt,searchFieldValue:e,filterValue:n,isAppliedFilter:M,onEnableFilter:N,onDisableFilter:O,filterInfoFields:V,CopySelectedItemsButton:Ce,children:f.jsx(gr,{items:k,columns:I,selectedItemsUuids:S,onEditItem:l,onSelectItem:bt,lastCreatedOrUpdatedItem:At})}),(o||!!a)&&f.jsx(Uc,{itemToEdit:a,filterValue:n,onHideModal:A,onShowDeleteItemConfirmation:L,onCreateItem:St,onUpdateItem:dt}),!!u&&f.jsx(kr,{onHideModal:T,onHideParentModal:A,itemToDelete:u}),f.jsx(wt,{}),f.jsx(Ne,{}),Te(),Ee(),!!F&&f.jsx(mi,{order:F,onHideModal:g})]})}),Kn=[xr,_r,br,vr],Qc=[Ze,Je,tn];function We(t){const e={locationId:t.get(Ze)||void 0,locationName:t.get(Je)||void 0,planetarySystemName:t.get(tn)||void 0,minPrice:+(t.get(xr)||0)||void 0,maxPrice:+(t.get(_r)||0)||void 0,minQuantity:+(t.get(br)||0)||void 0,maxQuantity:+(t.get(vr)||0)||void 0};return Ui(e)}function Yc({filterValue:t}){var s,a;if(!t)return;const{locationId:e,locationName:n,planetarySystemName:r,...i}=t;let o;return e||n?o=(s=Oi({id:e,name:n,planetarySystemName:r}))==null?void 0:s.uuid:r&&(o=(a=Li(r))==null?void 0:a.uuid),{...i,locationUuid:o}}function qc({urlSearchParams:t,setUrlSearchParams:e}){const n=G([ct,ht]),r=st([gt,ft]),i=n||r,o=m.useRef(void 0),s=m.useMemo(function(){const u=We(t),c=Yc({filterValue:u}),d=o.current;return pn(d,c)?(o.current=c,c):d},[t,o,i]),a=m.useCallback(function(u){let c;if(typeof u=="function")throw new Error("MarketValue as setState(prev=>newState) function not supported");u&&Object.keys(u).length>0&&(c=u),e(d=>{const h=We(d);if(pn(h,c)){if(!c)return Kn.forEach(b=>{d.delete(b)}),Qc.forEach(b=>{d.delete(b)}),d;Kn.forEach(b=>{c[b]?d.set(b,`${c[b]}`):d.delete(b)});const y=c.locationUuid;Ki({urlSearchParams:d,locationUuid:y,planetarySystemUuid:y,locationIdUrlSearchParamsKeyName:Ze,locationNameUrlSearchParamsKeyName:Je,planetarySystemNameUrlSearchParamsKeyName:tn})}return d})},[e]);return{marketFilterValue:s,setMarketFilterValueToUrlSearchParams:a}}function Gc({urlSearchParams:t,setUrlSearchParams:e}){return Hi({urlSearchParams:t,setUrlSearchParams:e,getSearchValueFromUrlSearchParams:wr,searchValueKeyInUrlSearchParams:yn,searchFieldNameInSearchForm:yn,searchFieldPlaceholderTextInSearchForm:"Start typing to search a product by name..."})}function Wc(t){const e=m.useMemo(()=>{const i=We(t);return Wi({id:i==null?void 0:i.locationId,name:i==null?void 0:i.locationName,planetarySystemName:i==null?void 0:i.planetarySystemName})},[t]),n=m.useMemo(()=>wr(t),[t]);return m.useMemo(function(){return Xi(eo({productName:n,locationName:e}))},[n,e])}const zc=m.memo(function(){const{urlSearchParams:e,setUrlSearchParams:n}=Vi(),r=Wc(e),{marketFilterValue:i,setMarketFilterValueToUrlSearchParams:o}=qc({urlSearchParams:e,setUrlSearchParams:n}),{searchFieldValue:s,SearchForm:a,resetSearchFieldValue:l}=Gc({urlSearchParams:e,setUrlSearchParams:n}),{isVisible:u,show:c,hide:d}=Ht(!1);return m.useEffect(function(){(i||!i)&&d()},[i,d]),f.jsxs(f.Fragment,{children:[f.jsx("title",{children:r}),f.jsxs(zi,{children:[f.jsxs("div",{className:_n.SearchAndFilterFormContainer,children:[a,f.jsxs(H,{onClick:c,title:"show filter form",children:[f.jsx($i,{}),f.jsx("span",{children:"filter"})]}),u&&f.jsx(yo,{filterValue:i,onSetFilterValue:o,onHide:d})]}),f.jsxs("div",{className:_n.Container,children:[f.jsx(Xc,{searchFieldValue:s,sellOrderFilterValue:i,setSellOrderFilterValue:o,resetSearchFieldValue:l}),f.jsx(Rc,{searchFieldValue:s,buyOrderFilterValue:i,setBuyOrderFilterValue:o,resetSearchFieldValue:l})]})]})]})}),yf=Ai(function(){return f.jsx(zc,{})});export{yf as default};
